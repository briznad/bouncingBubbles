var geoip2=function(){function Lookup(successCallback,errorCallback,options,type){this.successCallback=successCallback,this.errorCallback=errorCallback,this.timeout=options&&void 0!==options.timeout?2000>options.timeout?2000:options.timeout:10000,this.w3c_geolocation_disabled=options?options.w3c_geolocation_disabled:!1,this.geolocation=options&&options.hasOwnProperty("geolocation")?options.geolocation:navigator.geolocation,this.type=type;
}var exports={};Lookup.prototype.returnSuccess=function(location){this.successCallback&&"function"==typeof this.successCallback&&this.successCallback(this.fillInObject(this.objectFromJSON(location)));
},Lookup.prototype.returnError=function(error){this.errorCallback&&"function"==typeof this.errorCallback&&(error||(error={error:"Unknown error"}),this.errorCallback(error));
},Lookup.prototype.objectFromJSON=function(json){return window.JSON!==void 0&&"function"==typeof window.JSON.parse?window.JSON.parse(json):eval("("+json+")");
};var fillIns={country:[["continent",{},"names",{}],["country",{},"names",{}],["registered_country",{},"names",{}],["represented_country",{},"names",{}],["traits",{}]],city:[["city",{},"names",{}],["continent",{},"names",{}],["country",{},"names",{}],["location",{}],["postal",{}],["registered_country",{},"names",{}],["represented_country",{},"names",{}],["subdivisions",[],0,{},"names",{}],["traits",{}]]};
return Lookup.prototype.fillInObject=function(obj){for(var fill="country"==this.type?fillIns.country:fillIns.city,i=0;fill.length>i;i++){for(var path=fill[i],o=obj,j=0;
path.length>j;j+=2){var key=path[j];o[key]||(o[key]=path[j+1]),o=o[key];}}return obj;},Lookup.prototype.geoipLookup=function(http_params){var param,request,that=this,uri="//geoip.maxmind.com/geoip/v2.0/"+this.type+"/me?";
if(!this.alreadyRan){this.alreadyRan=1,"Microsoft Internet Explorer"===navigator.appName&&window.XDomainRequest&&-1==navigator.appVersion.indexOf("MSIE 1")?(request=new XDomainRequest,http_params.referrer=document.URL,uri=window.location.protocol+uri):(request=new window.XMLHttpRequest,uri="https:"+uri);
for(param in http_params){http_params.hasOwnProperty(param)&&http_params[param]&&(uri+=param+"="+encodeURIComponent(http_params[param])+"&");}uri=uri.substring(0,uri.length-1),request.open("GET",uri,!0),request.onload=function(){request.status===void 0||200===request.status?that.returnSuccess(request.responseText):that.returnError(that.objectFromJSON(request.responseText));
},request.ontimeout=function(){that.returnError({code:"HTTP_TIMEOUT",error:"The request to the GeoIP2 web service timed out."});},request.onerror=function(){that.returnError({code:"HTTP_ERROR",error:"There was an error making the request to the GeoIP2 web service."});
},request.send(null);}},Lookup.prototype.getGeoIPResult=function(){var that=this,w3c_options={enableHighAccuracy:!0};return w3c_options.timeout=this.timeout-1000,this.w3c_geolocation_disabled?(that.geoipLookup({geolocation_status:"DISABLED"}),void 0):(this.geolocation?(setTimeout(function(){that.geoipLookup({geolocation_status:"API_TIMEOUT"});
},this.timeout),this.geolocation.getCurrentPosition(function(position){that.geoipLookup(position.coords);},function(error){var error_strs=["PERMISSION_DENIED","POSITION_UNAVAILABLE","TIMEOUT"];
that.geoipLookup({geolocation_status:error_strs[error.code-1]});},w3c_options)):that.geoipLookup({geolocation_status:"UNSUPPORTED"}),void 0);},exports.country=function(successCallback,errorCallback,options){var l=new Lookup(successCallback,errorCallback,options,"country");
l.getGeoIPResult();},exports.city=function(successCallback,errorCallback,options){var l=new Lookup(successCallback,errorCallback,options,"city");l.getGeoIPResult();
},exports.cityISPOrg=function(successCallback,errorCallback,options){var l=new Lookup(successCallback,errorCallback,options,"city_isp_org");l.getGeoIPResult();
},exports.omni=function(successCallback,errorCallback,options){var l=new Lookup(successCallback,errorCallback,options,"omni");l.getGeoIPResult();},exports;
}();(function(f,e,c,g){var j={};(function(l,k){function i(){}if(!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function){Object.defineProperty=function(o,n,m){m.get instanceof Function&&o.__defineGetter__(n,m.get);
m.set instanceof Function&&o.__defineSetter__(n,m.set);};}l.inherit=function(n,m){i.prototype=m.prototype;n.prototype=new i;n.prototype.constructor=n;};
l.generateCallback=function(n,m){return function(){m.apply(n,arguments);};};l.NVector=function(o){if(o===k){o=0;}for(var n=Array(o||0),m=0;m<o;++m){n[m]=0;
}return n;};l.is=function(n,m){if(n===null){return false;}if(m instanceof Function&&n instanceof m){return true;}if(n.constructor.__implements!=k&&n.constructor.__implements[m]){return true;
}return false;};l.parseUInt=function(m){return Math.abs(parseInt(m));};})(j);var b=Array,a=j.NVector;if(typeof j==="undefined"){j={};}if(typeof j.Collision==="undefined"){j.Collision={};
}if(typeof j.Collision.Shapes==="undefined"){j.Collision.Shapes={};}if(typeof j.Common==="undefined"){j.Common={};}if(typeof j.Common.Math==="undefined"){j.Common.Math={};
}if(typeof j.Dynamics==="undefined"){j.Dynamics={};}if(typeof j.Dynamics.Contacts==="undefined"){j.Dynamics.Contacts={};}if(typeof j.Dynamics.Controllers==="undefined"){j.Dynamics.Controllers={};
}if(typeof j.Dynamics.Joints==="undefined"){j.Dynamics.Joints={};}(function(){function bo(){bo.b2AABB.apply(this,arguments);}function bn(){bn.b2Bound.apply(this,arguments);
}function bh(){bh.b2BoundValues.apply(this,arguments);this.constructor===bh&&this.b2BoundValues.apply(this,arguments);}function at(){at.b2Collision.apply(this,arguments);
}function aw(){aw.b2ContactID.apply(this,arguments);this.constructor===aw&&this.b2ContactID.apply(this,arguments);}function bv(){bv.b2ContactPoint.apply(this,arguments);
}function a5(){a5.b2Distance.apply(this,arguments);}function aD(){aD.b2DistanceInput.apply(this,arguments);}function bu(){bu.b2DistanceOutput.apply(this,arguments);
}function a9(){a9.b2DistanceProxy.apply(this,arguments);}function a4(){a4.b2DynamicTree.apply(this,arguments);this.constructor===a4&&this.b2DynamicTree.apply(this,arguments);
}function bf(){bf.b2DynamicTreeBroadPhase.apply(this,arguments);}function bg(){bg.b2DynamicTreeNode.apply(this,arguments);}function bl(){bl.b2DynamicTreePair.apply(this,arguments);
}function a3(){a3.b2Manifold.apply(this,arguments);this.constructor===a3&&this.b2Manifold.apply(this,arguments);}function a1(){a1.b2ManifoldPoint.apply(this,arguments);
this.constructor===a1&&this.b2ManifoldPoint.apply(this,arguments);}function aJ(){aJ.b2Point.apply(this,arguments);}function ar(){ar.b2RayCastInput.apply(this,arguments);
this.constructor===ar&&this.b2RayCastInput.apply(this,arguments);}function ay(){ay.b2RayCastOutput.apply(this,arguments);}function br(){br.b2Segment.apply(this,arguments);
}function bm(){bm.b2SeparationFunction.apply(this,arguments);}function bd(){bd.b2Simplex.apply(this,arguments);this.constructor===bd&&this.b2Simplex.apply(this,arguments);
}function bq(){bq.b2SimplexCache.apply(this,arguments);}function a8(){a8.b2SimplexVertex.apply(this,arguments);}function be(){be.b2TimeOfImpact.apply(this,arguments);
}function a7(){a7.b2TOIInput.apply(this,arguments);}function bA(){bA.b2WorldManifold.apply(this,arguments);this.constructor===bA&&this.b2WorldManifold.apply(this,arguments);
}function aZ(){aZ.ClipVertex.apply(this,arguments);}function aS(){aS.Features.apply(this,arguments);}function aN(){aN.b2CircleShape.apply(this,arguments);
this.constructor===aN&&this.b2CircleShape.apply(this,arguments);}function aI(){aI.b2EdgeChainDef.apply(this,arguments);this.constructor===aI&&this.b2EdgeChainDef.apply(this,arguments);
}function aK(){aK.b2EdgeShape.apply(this,arguments);this.constructor===aK&&this.b2EdgeShape.apply(this,arguments);}function aE(){aE.b2MassData.apply(this,arguments);
}function aC(){aC.b2PolygonShape.apply(this,arguments);this.constructor===aC&&this.b2PolygonShape.apply(this,arguments);}function aF(){aF.b2Shape.apply(this,arguments);
this.constructor===aF&&this.b2Shape.apply(this,arguments);}function aW(){aW.b2Color.apply(this,arguments);this.constructor===aW&&this.b2Color.apply(this,arguments);
}function aT(){aT.b2Settings.apply(this,arguments);}function aO(){aO.b2Mat22.apply(this,arguments);this.constructor===aO&&this.b2Mat22.apply(this,arguments);
}function aV(){aV.b2Mat33.apply(this,arguments);this.constructor===aV&&this.b2Mat33.apply(this,arguments);}function aQ(){aQ.b2Math.apply(this,arguments);
}function aP(){aP.b2Sweep.apply(this,arguments);}function aH(){aH.b2Transform.apply(this,arguments);this.constructor===aH&&this.b2Transform.apply(this,arguments);
}function aB(){aB.b2Vec2.apply(this,arguments);this.constructor===aB&&this.b2Vec2.apply(this,arguments);}function aA(){aA.b2Vec3.apply(this,arguments);
this.constructor===aA&&this.b2Vec3.apply(this,arguments);}function ax(){ax.b2Body.apply(this,arguments);this.constructor===ax&&this.b2Body.apply(this,arguments);
}function az(){az.b2BodyDef.apply(this,arguments);this.constructor===az&&this.b2BodyDef.apply(this,arguments);}function av(){av.b2ContactFilter.apply(this,arguments);
}function bt(){bt.b2ContactImpulse.apply(this,arguments);}function bi(){bi.b2ContactListener.apply(this,arguments);}function a6(){a6.b2ContactManager.apply(this,arguments);
this.constructor===a6&&this.b2ContactManager.apply(this,arguments);}function bb(){bb.b2DebugDraw.apply(this,arguments);this.constructor===bb&&this.b2DebugDraw.apply(this,arguments);
}function a2(){a2.b2DestructionListener.apply(this,arguments);}function bF(){bF.b2FilterData.apply(this,arguments);}function bc(){bc.b2Fixture.apply(this,arguments);
this.constructor===bc&&this.b2Fixture.apply(this,arguments);}function aG(){aG.b2FixtureDef.apply(this,arguments);this.constructor===aG&&this.b2FixtureDef.apply(this,arguments);
}function ak(){ak.b2Island.apply(this,arguments);this.constructor===ak&&this.b2Island.apply(this,arguments);}function ae(){ae.b2TimeStep.apply(this,arguments);
}function ac(){ac.b2World.apply(this,arguments);this.constructor===ac&&this.b2World.apply(this,arguments);}function bN(){bN.b2CircleContact.apply(this,arguments);
}function bK(){bK.b2Contact.apply(this,arguments);this.constructor===bK&&this.b2Contact.apply(this,arguments);}function bB(){bB.b2ContactConstraint.apply(this,arguments);
this.constructor===bB&&this.b2ContactConstraint.apply(this,arguments);}function bE(){bE.b2ContactConstraintPoint.apply(this,arguments);}function bs(){bs.b2ContactEdge.apply(this,arguments);
}function bj(){bj.b2ContactFactory.apply(this,arguments);this.constructor===bj&&this.b2ContactFactory.apply(this,arguments);}function aU(){aU.b2ContactRegister.apply(this,arguments);
}function ao(){ao.b2ContactResult.apply(this,arguments);}function aL(){aL.b2ContactSolver.apply(this,arguments);this.constructor===aL&&this.b2ContactSolver.apply(this,arguments);
}function ag(){ag.b2EdgeAndCircleContact.apply(this,arguments);}function al(){al.b2NullContact.apply(this,arguments);this.constructor===al&&this.b2NullContact.apply(this,arguments);
}function bP(){bP.b2PolyAndCircleContact.apply(this,arguments);}function bH(){bH.b2PolyAndEdgeContact.apply(this,arguments);}function bx(){bx.b2PolygonContact.apply(this,arguments);
}function ad(){ad.b2PositionSolverManifold.apply(this,arguments);this.constructor===ad&&this.b2PositionSolverManifold.apply(this,arguments);}function aY(){aY.b2BuoyancyController.apply(this,arguments);
}function aq(){aq.b2ConstantAccelController.apply(this,arguments);}function ai(){ai.b2ConstantForceController.apply(this,arguments);}function ab(){ab.b2Controller.apply(this,arguments);
}function bJ(){bJ.b2ControllerEdge.apply(this,arguments);}function bz(){bz.b2GravityController.apply(this,arguments);}function a0(){a0.b2TensorDampingController.apply(this,arguments);
}function bM(){bM.b2DistanceJoint.apply(this,arguments);this.constructor===bM&&this.b2DistanceJoint.apply(this,arguments);}function bD(){bD.b2DistanceJointDef.apply(this,arguments);
this.constructor===bD&&this.b2DistanceJointDef.apply(this,arguments);}function bp(){bp.b2FrictionJoint.apply(this,arguments);this.constructor===bp&&this.b2FrictionJoint.apply(this,arguments);
}function aR(){aR.b2FrictionJointDef.apply(this,arguments);this.constructor===aR&&this.b2FrictionJointDef.apply(this,arguments);}function an(){an.b2GearJoint.apply(this,arguments);
this.constructor===an&&this.b2GearJoint.apply(this,arguments);}function af(){af.b2GearJointDef.apply(this,arguments);this.constructor===af&&this.b2GearJointDef.apply(this,arguments);
}function au(){au.b2Jacobian.apply(this,arguments);}function bO(){bO.b2Joint.apply(this,arguments);this.constructor===bO&&this.b2Joint.apply(this,arguments);
}function bG(){bG.b2JointDef.apply(this,arguments);this.constructor===bG&&this.b2JointDef.apply(this,arguments);}function aj(){aj.b2JointEdge.apply(this,arguments);
}function bw(){bw.b2LineJoint.apply(this,arguments);this.constructor===bw&&this.b2LineJoint.apply(this,arguments);}function aX(){aX.b2LineJointDef.apply(this,arguments);
this.constructor===aX&&this.b2LineJointDef.apply(this,arguments);}function ap(){ap.b2MouseJoint.apply(this,arguments);this.constructor===ap&&this.b2MouseJoint.apply(this,arguments);
}function ah(){ah.b2MouseJointDef.apply(this,arguments);this.constructor===ah&&this.b2MouseJointDef.apply(this,arguments);}function i(){i.b2PrismaticJoint.apply(this,arguments);
this.constructor===i&&this.b2PrismaticJoint.apply(this,arguments);}function bI(){bI.b2PrismaticJointDef.apply(this,arguments);this.constructor===bI&&this.b2PrismaticJointDef.apply(this,arguments);
}function by(){by.b2PulleyJoint.apply(this,arguments);this.constructor===by&&this.b2PulleyJoint.apply(this,arguments);}function bL(){bL.b2PulleyJointDef.apply(this,arguments);
this.constructor===bL&&this.b2PulleyJointDef.apply(this,arguments);}function bC(){bC.b2RevoluteJoint.apply(this,arguments);this.constructor===bC&&this.b2RevoluteJoint.apply(this,arguments);
}function bk(){bk.b2RevoluteJointDef.apply(this,arguments);this.constructor===bk&&this.b2RevoluteJointDef.apply(this,arguments);}function aM(){aM.b2WeldJoint.apply(this,arguments);
this.constructor===aM&&this.b2WeldJoint.apply(this,arguments);}function am(){am.b2WeldJointDef.apply(this,arguments);this.constructor===am&&this.b2WeldJointDef.apply(this,arguments);
}j.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";j.Collision.b2AABB=bo;j.Collision.b2Bound=bn;j.Collision.b2BoundValues=bh;j.Collision.b2Collision=at;
j.Collision.b2ContactID=aw;j.Collision.b2ContactPoint=bv;j.Collision.b2Distance=a5;j.Collision.b2DistanceInput=aD;j.Collision.b2DistanceOutput=bu;j.Collision.b2DistanceProxy=a9;
j.Collision.b2DynamicTree=a4;j.Collision.b2DynamicTreeBroadPhase=bf;j.Collision.b2DynamicTreeNode=bg;j.Collision.b2DynamicTreePair=bl;j.Collision.b2Manifold=a3;
j.Collision.b2ManifoldPoint=a1;j.Collision.b2Point=aJ;j.Collision.b2RayCastInput=ar;j.Collision.b2RayCastOutput=ay;j.Collision.b2Segment=br;j.Collision.b2SeparationFunction=bm;
j.Collision.b2Simplex=bd;j.Collision.b2SimplexCache=bq;j.Collision.b2SimplexVertex=a8;j.Collision.b2TimeOfImpact=be;j.Collision.b2TOIInput=a7;j.Collision.b2WorldManifold=bA;
j.Collision.ClipVertex=aZ;j.Collision.Features=aS;j.Collision.Shapes.b2CircleShape=aN;j.Collision.Shapes.b2EdgeChainDef=aI;j.Collision.Shapes.b2EdgeShape=aK;
j.Collision.Shapes.b2MassData=aE;j.Collision.Shapes.b2PolygonShape=aC;j.Collision.Shapes.b2Shape=aF;j.Common.b2internal="Box2D.Common.b2internal";j.Common.b2Color=aW;
j.Common.b2Settings=aT;j.Common.Math.b2Mat22=aO;j.Common.Math.b2Mat33=aV;j.Common.Math.b2Math=aQ;j.Common.Math.b2Sweep=aP;j.Common.Math.b2Transform=aH;
j.Common.Math.b2Vec2=aB;j.Common.Math.b2Vec3=aA;j.Dynamics.b2Body=ax;j.Dynamics.b2BodyDef=az;j.Dynamics.b2ContactFilter=av;j.Dynamics.b2ContactImpulse=bt;
j.Dynamics.b2ContactListener=bi;j.Dynamics.b2ContactManager=a6;j.Dynamics.b2DebugDraw=bb;j.Dynamics.b2DestructionListener=a2;j.Dynamics.b2FilterData=bF;
j.Dynamics.b2Fixture=bc;j.Dynamics.b2FixtureDef=aG;j.Dynamics.b2Island=ak;j.Dynamics.b2TimeStep=ae;j.Dynamics.b2World=ac;j.Dynamics.Contacts.b2CircleContact=bN;
j.Dynamics.Contacts.b2Contact=bK;j.Dynamics.Contacts.b2ContactConstraint=bB;j.Dynamics.Contacts.b2ContactConstraintPoint=bE;j.Dynamics.Contacts.b2ContactEdge=bs;
j.Dynamics.Contacts.b2ContactFactory=bj;j.Dynamics.Contacts.b2ContactRegister=aU;j.Dynamics.Contacts.b2ContactResult=ao;j.Dynamics.Contacts.b2ContactSolver=aL;
j.Dynamics.Contacts.b2EdgeAndCircleContact=ag;j.Dynamics.Contacts.b2NullContact=al;j.Dynamics.Contacts.b2PolyAndCircleContact=bP;j.Dynamics.Contacts.b2PolyAndEdgeContact=bH;
j.Dynamics.Contacts.b2PolygonContact=bx;j.Dynamics.Contacts.b2PositionSolverManifold=ad;j.Dynamics.Controllers.b2BuoyancyController=aY;j.Dynamics.Controllers.b2ConstantAccelController=aq;
j.Dynamics.Controllers.b2ConstantForceController=ai;j.Dynamics.Controllers.b2Controller=ab;j.Dynamics.Controllers.b2ControllerEdge=bJ;j.Dynamics.Controllers.b2GravityController=bz;
j.Dynamics.Controllers.b2TensorDampingController=a0;j.Dynamics.Joints.b2DistanceJoint=bM;j.Dynamics.Joints.b2DistanceJointDef=bD;j.Dynamics.Joints.b2FrictionJoint=bp;
j.Dynamics.Joints.b2FrictionJointDef=aR;j.Dynamics.Joints.b2GearJoint=an;j.Dynamics.Joints.b2GearJointDef=af;j.Dynamics.Joints.b2Jacobian=au;j.Dynamics.Joints.b2Joint=bO;
j.Dynamics.Joints.b2JointDef=bG;j.Dynamics.Joints.b2JointEdge=aj;j.Dynamics.Joints.b2LineJoint=bw;j.Dynamics.Joints.b2LineJointDef=aX;j.Dynamics.Joints.b2MouseJoint=ap;
j.Dynamics.Joints.b2MouseJointDef=ah;j.Dynamics.Joints.b2PrismaticJoint=i;j.Dynamics.Joints.b2PrismaticJointDef=bI;j.Dynamics.Joints.b2PulleyJoint=by;j.Dynamics.Joints.b2PulleyJointDef=bL;
j.Dynamics.Joints.b2RevoluteJoint=bC;j.Dynamics.Joints.b2RevoluteJointDef=bk;j.Dynamics.Joints.b2WeldJoint=aM;j.Dynamics.Joints.b2WeldJointDef=am;})();
j.postDefs=[];(function(){var af=j.Collision.Shapes.b2CircleShape,ae=j.Collision.Shapes.b2PolygonShape,ab=j.Collision.Shapes.b2Shape,am=j.Common.b2Settings,an=j.Common.Math.b2Math,aj=j.Common.Math.b2Sweep,t=j.Common.Math.b2Transform,aq=j.Common.Math.b2Vec2,ai=j.Collision.b2AABB,C=j.Collision.b2Bound,s=j.Collision.b2BoundValues,T=j.Collision.b2Collision,X=j.Collision.b2ContactID,ac=j.Collision.b2ContactPoint,r=j.Collision.b2Distance,m=j.Collision.b2DistanceInput,av=j.Collision.b2DistanceOutput,al=j.Collision.b2DistanceProxy,ao=j.Collision.b2DynamicTree,ah=j.Collision.b2DynamicTreeBroadPhase,ad=j.Collision.b2DynamicTreeNode,J=j.Collision.b2DynamicTreePair,ag=j.Collision.b2Manifold,x=j.Collision.b2ManifoldPoint,P=j.Collision.b2Point,v=j.Collision.b2RayCastInput,ak=j.Collision.b2RayCastOutput,i=j.Collision.b2Segment,az=j.Collision.b2SeparationFunction,ax=j.Collision.b2Simplex,au=j.Collision.b2SimplexCache,aw=j.Collision.b2SimplexVertex,ar=j.Collision.b2TimeOfImpact,ap=j.Collision.b2TOIInput,at=j.Collision.b2WorldManifold,aB=j.Collision.ClipVertex,aA=j.Collision.Features,ay=j.Collision.IBroadPhase;
ai.b2AABB=function(){this.lowerBound=new aq;this.upperBound=new aq;};ai.prototype.IsValid=function(){var k=this.upperBound.y-this.lowerBound.y;return k=(k=this.upperBound.x-this.lowerBound.x>=0&&k>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid();
};ai.prototype.GetCenter=function(){return new aq((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2);};ai.prototype.GetExtents=function(){return new aq((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2);
};ai.prototype.Contains=function(k){var l=true;return l=(l=(l=(l=l&&this.lowerBound.x<=k.lowerBound.x)&&this.lowerBound.y<=k.lowerBound.y)&&k.upperBound.x<=this.upperBound.x)&&k.upperBound.y<=this.upperBound.y;
};ai.prototype.RayCast=function(y,u){var q=-Number.MAX_VALUE,n=Number.MAX_VALUE,k=u.p1.x,E=u.p1.y,B=u.p2.x-u.p1.x,D=u.p2.y-u.p1.y,A=Math.abs(D),l=y.normal,z=0,o=0,p=z=0;
p=0;if(Math.abs(B)<Number.MIN_VALUE){if(k<this.lowerBound.x||this.upperBound.x<k){return false;}}else{z=1/B;o=(this.lowerBound.x-k)*z;z=(this.upperBound.x-k)*z;
p=-1;if(o>z){p=o;o=z;z=p;p=1;}if(o>q){l.x=p;l.y=0;q=o;}n=Math.min(n,z);if(q>n){return false;}}if(A<Number.MIN_VALUE){if(E<this.lowerBound.y||this.upperBound.y<E){return false;
}}else{z=1/D;o=(this.lowerBound.y-E)*z;z=(this.upperBound.y-E)*z;p=-1;if(o>z){p=o;o=z;z=p;p=1;}if(o>q){l.y=p;l.x=0;q=o;}n=Math.min(n,z);if(q>n){return false;
}}y.fraction=q;return true;};ai.prototype.TestOverlap=function(k){var n=k.lowerBound.y-this.upperBound.y,l=this.lowerBound.y-k.upperBound.y;if(k.lowerBound.x-this.upperBound.x>0||n>0){return false;
}if(this.lowerBound.x-k.upperBound.x>0||l>0){return false;}return true;};ai.Combine=function(k,n){var l=new ai;l.Combine(k,n);return l;};ai.prototype.Combine=function(k,l){this.lowerBound.x=Math.min(k.lowerBound.x,l.lowerBound.x);
this.lowerBound.y=Math.min(k.lowerBound.y,l.lowerBound.y);this.upperBound.x=Math.max(k.upperBound.x,l.upperBound.x);this.upperBound.y=Math.max(k.upperBound.y,l.upperBound.y);
};C.b2Bound=function(){};C.prototype.IsLower=function(){return(this.value&1)==0;};C.prototype.IsUpper=function(){return(this.value&1)==1;};C.prototype.Swap=function(l){var o=this.value,n=this.proxy,k=this.stabbingCount;
this.value=l.value;this.proxy=l.proxy;this.stabbingCount=l.stabbingCount;l.value=o;l.proxy=n;l.stabbingCount=k;};s.b2BoundValues=function(){};s.prototype.b2BoundValues=function(){this.lowerValues=new a;
this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new a;this.upperValues[0]=0;this.upperValues[1]=0;};T.b2Collision=function(){};T.ClipSegmentToLine=function(p,o,n,l){if(l===g){l=0;
}var k,z=0;k=o[0];var u=k.v;k=o[1];var y=k.v,q=n.x*u.x+n.y*u.y-l;k=n.x*y.x+n.y*y.y-l;q<=0&&p[z++].Set(o[0]);k<=0&&p[z++].Set(o[1]);if(q*k<0){n=q/(q-k);
k=p[z];k=k.v;k.x=u.x+n*(y.x-u.x);k.y=u.y+n*(y.y-u.y);k=p[z];k.id=(q>0?o[0]:o[1]).id;++z;}return z;};T.EdgeSeparation=function(z,y,u,o,k){if(u===g){u=0;
}parseInt(z.m_vertexCount);var F=z.m_vertices;z=z.m_normals;var D=parseInt(o.m_vertexCount),E=o.m_vertices,B,l;B=y.R;l=z[u];z=B.col1.x*l.x+B.col2.x*l.y;
o=B.col1.y*l.x+B.col2.y*l.y;B=k.R;var A=B.col1.x*z+B.col1.y*o;B=B.col2.x*z+B.col2.y*o;for(var p=0,q=Number.MAX_VALUE,n=0;n<D;++n){l=E[n];l=l.x*A+l.y*B;
if(l<q){q=l;p=n;}}l=F[u];B=y.R;u=y.position.x+(B.col1.x*l.x+B.col2.x*l.y);y=y.position.y+(B.col1.y*l.x+B.col2.y*l.y);l=E[p];B=k.R;F=k.position.x+(B.col1.x*l.x+B.col2.x*l.y);
k=k.position.y+(B.col1.y*l.x+B.col2.y*l.y);F-=u;k-=y;return F*z+k*o;};T.FindMaxSeparation=function(A,z,y,o,k){var G=parseInt(z.m_vertexCount),E=z.m_normals,F,D;
D=k.R;F=o.m_centroid;var l=k.position.x+(D.col1.x*F.x+D.col2.x*F.y),B=k.position.y+(D.col1.y*F.x+D.col2.y*F.y);D=y.R;F=z.m_centroid;l-=y.position.x+(D.col1.x*F.x+D.col2.x*F.y);
B-=y.position.y+(D.col1.y*F.x+D.col2.y*F.y);D=l*y.R.col1.x+B*y.R.col1.y;B=l*y.R.col2.x+B*y.R.col2.y;l=0;for(var p=-Number.MAX_VALUE,u=0;u<G;++u){F=E[u];
F=F.x*D+F.y*B;if(F>p){p=F;l=u;}}E=T.EdgeSeparation(z,y,l,o,k);F=parseInt(l-1>=0?l-1:G-1);D=T.EdgeSeparation(z,y,F,o,k);B=parseInt(l+1<G?l+1:0);p=T.EdgeSeparation(z,y,B,o,k);
var n=u=0,q=0;if(D>E&&D>p){q=-1;u=F;n=D;}else{if(p>E){q=1;u=B;n=p;}else{A[0]=l;return E;}}for(;;){l=q==-1?u-1>=0?u-1:G-1:u+1<G?u+1:0;E=T.EdgeSeparation(z,y,l,o,k);
if(E>n){u=l;n=E;}else{break;}}A[0]=u;return n;};T.FindIncidentEdge=function(u,q,p,n,k,D){if(n===g){n=0;}parseInt(q.m_vertexCount);var A=q.m_normals,B=parseInt(k.m_vertexCount);
q=k.m_vertices;k=k.m_normals;var z;z=p.R;p=A[n];A=z.col1.x*p.x+z.col2.x*p.y;var l=z.col1.y*p.x+z.col2.y*p.y;z=D.R;p=z.col1.x*A+z.col1.y*l;l=z.col2.x*A+z.col2.y*l;
A=p;z=0;for(var y=Number.MAX_VALUE,o=0;o<B;++o){p=k[o];p=A*p.x+l*p.y;if(p<y){y=p;z=o;}}k=parseInt(z);A=parseInt(k+1<B?k+1:0);B=u[0];p=q[k];z=D.R;B.v.x=D.position.x+(z.col1.x*p.x+z.col2.x*p.y);
B.v.y=D.position.y+(z.col1.y*p.x+z.col2.y*p.y);B.id.features.referenceEdge=n;B.id.features.incidentEdge=k;B.id.features.incidentVertex=0;B=u[1];p=q[A];
z=D.R;B.v.x=D.position.x+(z.col1.x*p.x+z.col2.x*p.y);B.v.y=D.position.y+(z.col1.y*p.x+z.col2.y*p.y);B.id.features.referenceEdge=n;B.id.features.incidentEdge=A;
B.id.features.incidentVertex=1;};T.MakeClipPointVector=function(){var k=new b(2);k[0]=new aB;k[1]=new aB;return k;};T.CollidePolygons=function(B,z,y,o,k){var H;
B.m_pointCount=0;var F=z.m_radius+o.m_radius;H=0;T.s_edgeAO[0]=H;var G=T.FindMaxSeparation(T.s_edgeAO,z,y,o,k);H=T.s_edgeAO[0];if(!(G>F)){var E=0;T.s_edgeBO[0]=E;
var l=T.FindMaxSeparation(T.s_edgeBO,o,k,z,y);E=T.s_edgeBO[0];if(!(l>F)){var D=0,p=0;if(l>0.98*G+0.001){G=o;o=z;z=k;y=y;D=E;B.m_type=ag.e_faceB;p=1;}else{G=z;
o=o;z=y;y=k;D=H;B.m_type=ag.e_faceA;p=0;}H=T.s_incidentEdge;T.FindIncidentEdge(H,G,z,D,o,y);E=parseInt(G.m_vertexCount);k=G.m_vertices;G=k[D];var u;u=D+1<E?k[parseInt(D+1)]:k[0];
D=T.s_localTangent;D.Set(u.x-G.x,u.y-G.y);D.Normalize();k=T.s_localNormal;k.x=D.y;k.y=-D.x;o=T.s_planePoint;o.Set(0.5*(G.x+u.x),0.5*(G.y+u.y));l=T.s_tangent;
E=z.R;l.x=E.col1.x*D.x+E.col2.x*D.y;l.y=E.col1.y*D.x+E.col2.y*D.y;var n=T.s_tangent2;n.x=-l.x;n.y=-l.y;D=T.s_normal;D.x=l.y;D.y=-l.x;var q=T.s_v11,A=T.s_v12;
q.x=z.position.x+(E.col1.x*G.x+E.col2.x*G.y);q.y=z.position.y+(E.col1.y*G.x+E.col2.y*G.y);A.x=z.position.x+(E.col1.x*u.x+E.col2.x*u.y);A.y=z.position.y+(E.col1.y*u.x+E.col2.y*u.y);
z=D.x*q.x+D.y*q.y;E=l.x*A.x+l.y*A.y+F;u=T.s_clipPoints1;G=T.s_clipPoints2;A=0;A=T.ClipSegmentToLine(u,H,n,-l.x*q.x-l.y*q.y+F);if(!(A<2)){A=T.ClipSegmentToLine(G,u,l,E);
if(!(A<2)){B.m_localPlaneNormal.SetV(k);B.m_localPoint.SetV(o);for(o=k=0;o<am.b2_maxManifoldPoints;++o){H=G[o];if(D.x*H.v.x+D.y*H.v.y-z<=F){l=B.m_points[k];
E=y.R;n=H.v.x-y.position.x;q=H.v.y-y.position.y;l.m_localPoint.x=n*E.col1.x+q*E.col1.y;l.m_localPoint.y=n*E.col2.x+q*E.col2.y;l.m_id.Set(H.id);l.m_id.features.flip=p;
++k;}}B.m_pointCount=k;}}}}};T.CollideCircles=function(l,y,u,k,q){l.m_pointCount=0;var p,n;p=u.R;n=y.m_p;var o=u.position.x+(p.col1.x*n.x+p.col2.x*n.y);
u=u.position.y+(p.col1.y*n.x+p.col2.y*n.y);p=q.R;n=k.m_p;o=q.position.x+(p.col1.x*n.x+p.col2.x*n.y)-o;q=q.position.y+(p.col1.y*n.x+p.col2.y*n.y)-u;p=y.m_radius+k.m_radius;
if(!(o*o+q*q>p*p)){l.m_type=ag.e_circles;l.m_localPoint.SetV(y.m_p);l.m_localPlaneNormal.SetZero();l.m_pointCount=1;l.m_points[0].m_localPoint.SetV(k.m_p);
l.m_points[0].m_id.key=0;}};T.CollidePolygonAndCircle=function(z,y,u,o,k){var F=z.m_pointCount=0,D=0,E,B;B=k.R;E=o.m_p;var l=k.position.y+(B.col1.y*E.x+B.col2.y*E.y);
F=k.position.x+(B.col1.x*E.x+B.col2.x*E.y)-u.position.x;D=l-u.position.y;B=u.R;u=F*B.col1.x+D*B.col1.y;B=F*B.col2.x+D*B.col2.y;var A=0;l=-Number.MAX_VALUE;
k=y.m_radius+o.m_radius;var p=parseInt(y.m_vertexCount),q=y.m_vertices;y=y.m_normals;for(var n=0;n<p;++n){E=q[n];F=u-E.x;D=B-E.y;E=y[n];F=E.x*F+E.y*D;if(F>k){return;
}if(F>l){l=F;A=n;}}F=parseInt(A);D=parseInt(F+1<p?F+1:0);E=q[F];q=q[D];if(l<Number.MIN_VALUE){z.m_pointCount=1;z.m_type=ag.e_faceA;z.m_localPlaneNormal.SetV(y[A]);
z.m_localPoint.x=0.5*(E.x+q.x);z.m_localPoint.y=0.5*(E.y+q.y);}else{l=(u-q.x)*(E.x-q.x)+(B-q.y)*(E.y-q.y);if((u-E.x)*(q.x-E.x)+(B-E.y)*(q.y-E.y)<=0){if((u-E.x)*(u-E.x)+(B-E.y)*(B-E.y)>k*k){return;
}z.m_pointCount=1;z.m_type=ag.e_faceA;z.m_localPlaneNormal.x=u-E.x;z.m_localPlaneNormal.y=B-E.y;z.m_localPlaneNormal.Normalize();z.m_localPoint.SetV(E);
}else{if(l<=0){if((u-q.x)*(u-q.x)+(B-q.y)*(B-q.y)>k*k){return;}z.m_pointCount=1;z.m_type=ag.e_faceA;z.m_localPlaneNormal.x=u-q.x;z.m_localPlaneNormal.y=B-q.y;
z.m_localPlaneNormal.Normalize();z.m_localPoint.SetV(q);}else{A=0.5*(E.x+q.x);E=0.5*(E.y+q.y);l=(u-A)*y[F].x+(B-E)*y[F].y;if(l>k){return;}z.m_pointCount=1;
z.m_type=ag.e_faceA;z.m_localPlaneNormal.x=y[F].x;z.m_localPlaneNormal.y=y[F].y;z.m_localPlaneNormal.Normalize();z.m_localPoint.Set(A,E);}}}z.m_points[0].m_localPoint.SetV(o.m_p);
z.m_points[0].m_id.key=0;};T.TestOverlap=function(l,u){var q=u.lowerBound,k=l.upperBound,p=q.x-k.x,o=q.y-k.y;q=l.lowerBound;k=u.upperBound;var n=q.y-k.y;
if(p>0||o>0){return false;}if(q.x-k.x>0||n>0){return false;}return true;};j.postDefs.push(function(){j.Collision.b2Collision.s_incidentEdge=T.MakeClipPointVector();
j.Collision.b2Collision.s_clipPoints1=T.MakeClipPointVector();j.Collision.b2Collision.s_clipPoints2=T.MakeClipPointVector();j.Collision.b2Collision.s_edgeAO=new a(1);
j.Collision.b2Collision.s_edgeBO=new a(1);j.Collision.b2Collision.s_localTangent=new aq;j.Collision.b2Collision.s_localNormal=new aq;j.Collision.b2Collision.s_planePoint=new aq;
j.Collision.b2Collision.s_normal=new aq;j.Collision.b2Collision.s_tangent=new aq;j.Collision.b2Collision.s_tangent2=new aq;j.Collision.b2Collision.s_v11=new aq;
j.Collision.b2Collision.s_v12=new aq;j.Collision.b2Collision.b2CollidePolyTempVec=new aq;j.Collision.b2Collision.b2_nullFeature=255;});X.b2ContactID=function(){this.features=new aA;
};X.prototype.b2ContactID=function(){this.features._m_id=this;};X.prototype.Set=function(k){this.key=k._key;};X.prototype.Copy=function(){var k=new X;k.key=this.key;
return k;};Object.defineProperty(X.prototype,"key",{enumerable:false,configurable:true,get:function(){return this._key;}});Object.defineProperty(X.prototype,"key",{enumerable:false,configurable:true,set:function(k){if(k===g){k=0;
}this._key=k;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;
this.features._flip=(this._key&4278190080)>>24&255;}});ac.b2ContactPoint=function(){this.position=new aq;this.velocity=new aq;this.normal=new aq;this.id=new X;
};r.b2Distance=function(){};r.Distance=function(B,z,y){++r.b2_gjkCalls;var o=y.proxyA,k=y.proxyB,H=y.transformA,F=y.transformB,G=r.s_simplex;G.ReadCache(z,o,H,k,F);
var E=G.m_vertices,l=r.s_saveA,D=r.s_saveB,p=0;G.GetClosestPoint().LengthSquared();for(var u=0,n,q=0;q<20;){p=G.m_count;for(u=0;u<p;u++){l[u]=E[u].indexA;
D[u]=E[u].indexB;}switch(G.m_count){case 1:break;case 2:G.Solve2();break;case 3:G.Solve3();break;default:am.b2Assert(false);}if(G.m_count==3){break;}n=G.GetClosestPoint();
n.LengthSquared();u=G.GetSearchDirection();if(u.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE){break;}n=E[G.m_count];n.indexA=o.GetSupport(an.MulTMV(H.R,u.GetNegative()));
n.wA=an.MulX(H,o.GetVertex(n.indexA));n.indexB=k.GetSupport(an.MulTMV(F.R,u));n.wB=an.MulX(F,k.GetVertex(n.indexB));n.w=an.SubtractVV(n.wB,n.wA);++q;++r.b2_gjkIters;
var A=false;for(u=0;u<p;u++){if(n.indexA==l[u]&&n.indexB==D[u]){A=true;break;}}if(A){break;}++G.m_count;}r.b2_gjkMaxIters=an.Max(r.b2_gjkMaxIters,q);G.GetWitnessPoints(B.pointA,B.pointB);
B.distance=an.SubtractVV(B.pointA,B.pointB).Length();B.iterations=q;G.WriteCache(z);if(y.useRadii){z=o.m_radius;k=k.m_radius;if(B.distance>z+k&&B.distance>Number.MIN_VALUE){B.distance-=z+k;
y=an.SubtractVV(B.pointB,B.pointA);y.Normalize();B.pointA.x+=z*y.x;B.pointA.y+=z*y.y;B.pointB.x-=k*y.x;B.pointB.y-=k*y.y;}else{n=new aq;n.x=0.5*(B.pointA.x+B.pointB.x);
n.y=0.5*(B.pointA.y+B.pointB.y);B.pointA.x=B.pointB.x=n.x;B.pointA.y=B.pointB.y=n.y;B.distance=0;}}};j.postDefs.push(function(){j.Collision.b2Distance.s_simplex=new ax;
j.Collision.b2Distance.s_saveA=new a(3);j.Collision.b2Distance.s_saveB=new a(3);});m.b2DistanceInput=function(){};av.b2DistanceOutput=function(){this.pointA=new aq;
this.pointB=new aq;};al.b2DistanceProxy=function(){};al.prototype.Set=function(k){switch(k.GetType()){case ab.e_circleShape:k=k instanceof af?k:null;this.m_vertices=new b(1,true);
this.m_vertices[0]=k.m_p;this.m_count=1;this.m_radius=k.m_radius;break;case ab.e_polygonShape:k=k instanceof ae?k:null;this.m_vertices=k.m_vertices;this.m_count=k.m_vertexCount;
this.m_radius=k.m_radius;break;default:am.b2Assert(false);}};al.prototype.GetSupport=function(l){for(var p=0,o=this.m_vertices[0].x*l.x+this.m_vertices[0].y*l.y,k=1;
k<this.m_count;++k){var n=this.m_vertices[k].x*l.x+this.m_vertices[k].y*l.y;if(n>o){p=k;o=n;}}return p;};al.prototype.GetSupportVertex=function(l){for(var p=0,o=this.m_vertices[0].x*l.x+this.m_vertices[0].y*l.y,k=1;
k<this.m_count;++k){var n=this.m_vertices[k].x*l.x+this.m_vertices[k].y*l.y;if(n>o){p=k;o=n;}}return this.m_vertices[p];};al.prototype.GetVertexCount=function(){return this.m_count;
};al.prototype.GetVertex=function(k){if(k===g){k=0;}am.b2Assert(0<=k&&k<this.m_count);return this.m_vertices[k];};ao.b2DynamicTree=function(){};ao.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null;
this.m_insertionCount=this.m_path=0;};ao.prototype.CreateProxy=function(l,p){var o=this.AllocateNode(),k=am.b2_aabbExtension,n=am.b2_aabbExtension;o.aabb.lowerBound.x=l.lowerBound.x-k;
o.aabb.lowerBound.y=l.lowerBound.y-n;o.aabb.upperBound.x=l.upperBound.x+k;o.aabb.upperBound.y=l.upperBound.y+n;o.userData=p;this.InsertLeaf(o);return o;
};ao.prototype.DestroyProxy=function(k){this.RemoveLeaf(k);this.FreeNode(k);};ao.prototype.MoveProxy=function(l,o,n){am.b2Assert(l.IsLeaf());if(l.aabb.Contains(o)){return false;
}this.RemoveLeaf(l);var k=am.b2_aabbExtension+am.b2_aabbMultiplier*(n.x>0?n.x:-n.x);n=am.b2_aabbExtension+am.b2_aabbMultiplier*(n.y>0?n.y:-n.y);l.aabb.lowerBound.x=o.lowerBound.x-k;
l.aabb.lowerBound.y=o.lowerBound.y-n;l.aabb.upperBound.x=o.upperBound.x+k;l.aabb.upperBound.y=o.upperBound.y+n;this.InsertLeaf(l);return true;};ao.prototype.Rebalance=function(l){if(l===g){l=0;
}if(this.m_root!=null){for(var o=0;o<l;o++){for(var n=this.m_root,k=0;n.IsLeaf()==false;){n=this.m_path>>k&1?n.child2:n.child1;k=k+1&31;}++this.m_path;
this.RemoveLeaf(n);this.InsertLeaf(n);}}};ao.prototype.GetFatAABB=function(k){return k.aabb;};ao.prototype.GetUserData=function(k){return k.userData;};
ao.prototype.Query=function(l,p){if(this.m_root!=null){var o=new b,k=0;for(o[k++]=this.m_root;k>0;){var n=o[--k];if(n.aabb.TestOverlap(p)){if(n.IsLeaf()){if(!l(n)){break;
}}else{o[k++]=n.child1;o[k++]=n.child2;}}}}};ao.prototype.RayCast=function(u,q){if(this.m_root!=null){var p=q.p1,n=q.p2,k=an.SubtractVV(p,n);k.Normalize();
k=an.CrossFV(1,k);var D=an.AbsV(k),A=q.maxFraction,B=new ai,z=0,l=0;z=p.x+A*(n.x-p.x);l=p.y+A*(n.y-p.y);B.lowerBound.x=Math.min(p.x,z);B.lowerBound.y=Math.min(p.y,l);
B.upperBound.x=Math.max(p.x,z);B.upperBound.y=Math.max(p.y,l);var y=new b,o=0;for(y[o++]=this.m_root;o>0;){A=y[--o];if(A.aabb.TestOverlap(B)!=false){z=A.aabb.GetCenter();
l=A.aabb.GetExtents();if(!(Math.abs(k.x*(p.x-z.x)+k.y*(p.y-z.y))-D.x*l.x-D.y*l.y>0)){if(A.IsLeaf()){z=new v;z.p1=q.p1;z.p2=q.p2;z.maxFraction=q.maxFraction;
A=u(z,A);if(A==0){break;}if(A>0){z=p.x+A*(n.x-p.x);l=p.y+A*(n.y-p.y);B.lowerBound.x=Math.min(p.x,z);B.lowerBound.y=Math.min(p.y,l);B.upperBound.x=Math.max(p.x,z);
B.upperBound.y=Math.max(p.y,l);}}else{y[o++]=A.child1;y[o++]=A.child2;}}}}}};ao.prototype.AllocateNode=function(){if(this.m_freeList){var k=this.m_freeList;
this.m_freeList=k.parent;k.parent=null;k.child1=null;k.child2=null;return k;}return new ad;};ao.prototype.FreeNode=function(k){k.parent=this.m_freeList;
this.m_freeList=k;};ao.prototype.InsertLeaf=function(l){++this.m_insertionCount;if(this.m_root==null){this.m_root=l;this.m_root.parent=null;}else{var o=l.aabb.GetCenter(),n=this.m_root;
if(n.IsLeaf()==false){do{var k=n.child1;n=n.child2;n=Math.abs((k.aabb.lowerBound.x+k.aabb.upperBound.x)/2-o.x)+Math.abs((k.aabb.lowerBound.y+k.aabb.upperBound.y)/2-o.y)<Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-o.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-o.y)?k:n;
}while(n.IsLeaf()==false);}o=n.parent;k=this.AllocateNode();k.parent=o;k.userData=null;k.aabb.Combine(l.aabb,n.aabb);if(o){if(n.parent.child1==n){o.child1=k;
}else{o.child2=k;}k.child1=n;k.child2=l;n.parent=k;l.parent=k;do{if(o.aabb.Contains(k.aabb)){break;}o.aabb.Combine(o.child1.aabb,o.child2.aabb);k=o;o=o.parent;
}while(o);}else{k.child1=n;k.child2=l;n.parent=k;this.m_root=l.parent=k;}}};ao.prototype.RemoveLeaf=function(k){if(k==this.m_root){this.m_root=null;}else{var n=k.parent,l=n.parent;
k=n.child1==k?n.child2:n.child1;if(l){if(l.child1==n){l.child1=k;}else{l.child2=k;}k.parent=l;for(this.FreeNode(n);l;){n=l.aabb;l.aabb=ai.Combine(l.child1.aabb,l.child2.aabb);
if(n.Contains(l.aabb)){break;}l=l.parent;}}else{this.m_root=k;k.parent=null;this.FreeNode(n);}}};ah.b2DynamicTreeBroadPhase=function(){this.m_tree=new ao;
this.m_moveBuffer=new b;this.m_pairBuffer=new b;this.m_pairCount=0;};ah.prototype.CreateProxy=function(k,n){var l=this.m_tree.CreateProxy(k,n);++this.m_proxyCount;
this.BufferMove(l);return l;};ah.prototype.DestroyProxy=function(k){this.UnBufferMove(k);--this.m_proxyCount;this.m_tree.DestroyProxy(k);};ah.prototype.MoveProxy=function(k,n,l){this.m_tree.MoveProxy(k,n,l)&&this.BufferMove(k);
};ah.prototype.TestOverlap=function(l,o){var n=this.m_tree.GetFatAABB(l),k=this.m_tree.GetFatAABB(o);return n.TestOverlap(k);};ah.prototype.GetUserData=function(k){return this.m_tree.GetUserData(k);
};ah.prototype.GetFatAABB=function(k){return this.m_tree.GetFatAABB(k);};ah.prototype.GetProxyCount=function(){return this.m_proxyCount;};ah.prototype.UpdatePairs=function(l){var u=this;
var q=u.m_pairCount=0,k;for(q=0;q<u.m_moveBuffer.length;++q){k=u.m_moveBuffer[q];var p=u.m_tree.GetFatAABB(k);u.m_tree.Query(function(z){if(z==k){return true;
}if(u.m_pairCount==u.m_pairBuffer.length){u.m_pairBuffer[u.m_pairCount]=new J;}var y=u.m_pairBuffer[u.m_pairCount];y.proxyA=z<k?z:k;y.proxyB=z>=k?z:k;++u.m_pairCount;
return true;},p);}for(q=u.m_moveBuffer.length=0;q<u.m_pairCount;){p=u.m_pairBuffer[q];var o=u.m_tree.GetUserData(p.proxyA),n=u.m_tree.GetUserData(p.proxyB);
l(o,n);for(++q;q<u.m_pairCount;){o=u.m_pairBuffer[q];if(o.proxyA!=p.proxyA||o.proxyB!=p.proxyB){break;}++q;}}};ah.prototype.Query=function(k,l){this.m_tree.Query(k,l);
};ah.prototype.RayCast=function(k,l){this.m_tree.RayCast(k,l);};ah.prototype.Validate=function(){};ah.prototype.Rebalance=function(k){if(k===g){k=0;}this.m_tree.Rebalance(k);
};ah.prototype.BufferMove=function(k){this.m_moveBuffer[this.m_moveBuffer.length]=k;};ah.prototype.UnBufferMove=function(k){this.m_moveBuffer.splice(parseInt(this.m_moveBuffer.indexOf(k)),1);
};ah.prototype.ComparePairs=function(){return 0;};ah.__implements={};ah.__implements[ay]=true;ad.b2DynamicTreeNode=function(){this.aabb=new ai;};ad.prototype.IsLeaf=function(){return this.child1==null;
};J.b2DynamicTreePair=function(){};ag.b2Manifold=function(){this.m_pointCount=0;};ag.prototype.b2Manifold=function(){this.m_points=new b(am.b2_maxManifoldPoints);
for(var k=0;k<am.b2_maxManifoldPoints;k++){this.m_points[k]=new x;}this.m_localPlaneNormal=new aq;this.m_localPoint=new aq;};ag.prototype.Reset=function(){for(var k=0;
k<am.b2_maxManifoldPoints;k++){(this.m_points[k] instanceof x?this.m_points[k]:null).Reset();}this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();
this.m_pointCount=this.m_type=0;};ag.prototype.Set=function(k){this.m_pointCount=k.m_pointCount;for(var l=0;l<am.b2_maxManifoldPoints;l++){(this.m_points[l] instanceof x?this.m_points[l]:null).Set(k.m_points[l]);
}this.m_localPlaneNormal.SetV(k.m_localPlaneNormal);this.m_localPoint.SetV(k.m_localPoint);this.m_type=k.m_type;};ag.prototype.Copy=function(){var k=new ag;
k.Set(this);return k;};j.postDefs.push(function(){j.Collision.b2Manifold.e_circles=1;j.Collision.b2Manifold.e_faceA=2;j.Collision.b2Manifold.e_faceB=4;
});x.b2ManifoldPoint=function(){this.m_localPoint=new aq;this.m_id=new X;};x.prototype.b2ManifoldPoint=function(){this.Reset();};x.prototype.Reset=function(){this.m_localPoint.SetZero();
this.m_tangentImpulse=this.m_normalImpulse=0;this.m_id.key=0;};x.prototype.Set=function(k){this.m_localPoint.SetV(k.m_localPoint);this.m_normalImpulse=k.m_normalImpulse;
this.m_tangentImpulse=k.m_tangentImpulse;this.m_id.Set(k.m_id);};P.b2Point=function(){this.p=new aq;};P.prototype.Support=function(){return this.p;};P.prototype.GetFirstVertex=function(){return this.p;
};v.b2RayCastInput=function(){this.p1=new aq;this.p2=new aq;};v.prototype.b2RayCastInput=function(k,n,l){if(k===g){k=null;}if(n===g){n=null;}if(l===g){l=1;
}k&&this.p1.SetV(k);n&&this.p2.SetV(n);this.maxFraction=l;};ak.b2RayCastOutput=function(){this.normal=new aq;};i.b2Segment=function(){this.p1=new aq;this.p2=new aq;
};i.prototype.TestSegment=function(u,q,p,n){if(n===g){n=0;}var k=p.p1,D=p.p2.x-k.x,A=p.p2.y-k.y;p=this.p2.y-this.p1.y;var B=-(this.p2.x-this.p1.x),z=100*Number.MIN_VALUE,l=-(D*p+A*B);
if(l>z){var y=k.x-this.p1.x,o=k.y-this.p1.y;k=y*p+o*B;if(0<=k&&k<=n*l){n=-D*o+A*y;if(-z*l<=n&&n<=l*(1+z)){k/=l;n=Math.sqrt(p*p+B*B);p/=n;B/=n;u[0]=k;q.Set(p,B);
return true;}}}return false;};i.prototype.Extend=function(k){this.ExtendForward(k);this.ExtendBackward(k);};i.prototype.ExtendForward=function(k){var n=this.p2.x-this.p1.x,l=this.p2.y-this.p1.y;
k=Math.min(n>0?(k.upperBound.x-this.p1.x)/n:n<0?(k.lowerBound.x-this.p1.x)/n:Number.POSITIVE_INFINITY,l>0?(k.upperBound.y-this.p1.y)/l:l<0?(k.lowerBound.y-this.p1.y)/l:Number.POSITIVE_INFINITY);
this.p2.x=this.p1.x+n*k;this.p2.y=this.p1.y+l*k;};i.prototype.ExtendBackward=function(k){var n=-this.p2.x+this.p1.x,l=-this.p2.y+this.p1.y;k=Math.min(n>0?(k.upperBound.x-this.p2.x)/n:n<0?(k.lowerBound.x-this.p2.x)/n:Number.POSITIVE_INFINITY,l>0?(k.upperBound.y-this.p2.y)/l:l<0?(k.lowerBound.y-this.p2.y)/l:Number.POSITIVE_INFINITY);
this.p1.x=this.p2.x+n*k;this.p1.y=this.p2.y+l*k;};az.b2SeparationFunction=function(){this.m_localPoint=new aq;this.m_axis=new aq;};az.prototype.Initialize=function(u,q,p,n,k){this.m_proxyA=q;
this.m_proxyB=n;var D=parseInt(u.count);am.b2Assert(0<D&&D<3);var A,B,z,l,y=l=z=n=q=0,o=0;y=0;if(D==1){this.m_type=az.e_points;A=this.m_proxyA.GetVertex(u.indexA[0]);
B=this.m_proxyB.GetVertex(u.indexB[0]);D=A;u=p.R;q=p.position.x+(u.col1.x*D.x+u.col2.x*D.y);n=p.position.y+(u.col1.y*D.x+u.col2.y*D.y);D=B;u=k.R;z=k.position.x+(u.col1.x*D.x+u.col2.x*D.y);
l=k.position.y+(u.col1.y*D.x+u.col2.y*D.y);this.m_axis.x=z-q;this.m_axis.y=l-n;this.m_axis.Normalize();}else{if(u.indexB[0]==u.indexB[1]){this.m_type=az.e_faceA;
q=this.m_proxyA.GetVertex(u.indexA[0]);n=this.m_proxyA.GetVertex(u.indexA[1]);B=this.m_proxyB.GetVertex(u.indexB[0]);this.m_localPoint.x=0.5*(q.x+n.x);
this.m_localPoint.y=0.5*(q.y+n.y);this.m_axis=an.CrossVF(an.SubtractVV(n,q),1);this.m_axis.Normalize();D=this.m_axis;u=p.R;y=u.col1.x*D.x+u.col2.x*D.y;
o=u.col1.y*D.x+u.col2.y*D.y;D=this.m_localPoint;u=p.R;q=p.position.x+(u.col1.x*D.x+u.col2.x*D.y);n=p.position.y+(u.col1.y*D.x+u.col2.y*D.y);D=B;u=k.R;z=k.position.x+(u.col1.x*D.x+u.col2.x*D.y);
l=k.position.y+(u.col1.y*D.x+u.col2.y*D.y);y=(z-q)*y+(l-n)*o;}else{if(u.indexA[0]==u.indexA[0]){this.m_type=az.e_faceB;z=this.m_proxyB.GetVertex(u.indexB[0]);
l=this.m_proxyB.GetVertex(u.indexB[1]);A=this.m_proxyA.GetVertex(u.indexA[0]);this.m_localPoint.x=0.5*(z.x+l.x);this.m_localPoint.y=0.5*(z.y+l.y);this.m_axis=an.CrossVF(an.SubtractVV(l,z),1);
this.m_axis.Normalize();D=this.m_axis;u=k.R;y=u.col1.x*D.x+u.col2.x*D.y;o=u.col1.y*D.x+u.col2.y*D.y;D=this.m_localPoint;u=k.R;z=k.position.x+(u.col1.x*D.x+u.col2.x*D.y);
l=k.position.y+(u.col1.y*D.x+u.col2.y*D.y);D=A;u=p.R;q=p.position.x+(u.col1.x*D.x+u.col2.x*D.y);n=p.position.y+(u.col1.y*D.x+u.col2.y*D.y);y=(q-z)*y+(n-l)*o;
}else{q=this.m_proxyA.GetVertex(u.indexA[0]);n=this.m_proxyA.GetVertex(u.indexA[1]);z=this.m_proxyB.GetVertex(u.indexB[0]);l=this.m_proxyB.GetVertex(u.indexB[1]);
an.MulX(p,A);A=an.MulMV(p.R,an.SubtractVV(n,q));an.MulX(k,B);y=an.MulMV(k.R,an.SubtractVV(l,z));k=A.x*A.x+A.y*A.y;B=y.x*y.x+y.y*y.y;u=an.SubtractVV(y,A);
p=A.x*u.x+A.y*u.y;u=y.x*u.x+y.y*u.y;A=A.x*y.x+A.y*y.y;o=k*B-A*A;y=0;if(o!=0){y=an.Clamp((A*u-p*B)/o,0,1);}if((A*y+u)/B<0){y=an.Clamp((A-p)/k,0,1);}A=new aq;
A.x=q.x+y*(n.x-q.x);A.y=q.y+y*(n.y-q.y);B=new aq;B.x=z.x+y*(l.x-z.x);B.y=z.y+y*(l.y-z.y);if(y==0||y==1){this.m_type=az.e_faceB;this.m_axis=an.CrossVF(an.SubtractVV(l,z),1);
this.m_axis.Normalize();this.m_localPoint=B;}else{this.m_type=az.e_faceA;this.m_axis=an.CrossVF(an.SubtractVV(n,q),1);this.m_localPoint=A;}}}y<0&&this.m_axis.NegativeSelf();
}};az.prototype.Evaluate=function(l,p){var o,k,n=0;switch(this.m_type){case az.e_points:o=an.MulTMV(l.R,this.m_axis);k=an.MulTMV(p.R,this.m_axis.GetNegative());
o=this.m_proxyA.GetSupportVertex(o);k=this.m_proxyB.GetSupportVertex(k);o=an.MulX(l,o);k=an.MulX(p,k);return n=(k.x-o.x)*this.m_axis.x+(k.y-o.y)*this.m_axis.y;
case az.e_faceA:n=an.MulMV(l.R,this.m_axis);o=an.MulX(l,this.m_localPoint);k=an.MulTMV(p.R,n.GetNegative());k=this.m_proxyB.GetSupportVertex(k);k=an.MulX(p,k);
return n=(k.x-o.x)*n.x+(k.y-o.y)*n.y;case az.e_faceB:n=an.MulMV(p.R,this.m_axis);k=an.MulX(p,this.m_localPoint);o=an.MulTMV(l.R,n.GetNegative());o=this.m_proxyA.GetSupportVertex(o);
o=an.MulX(l,o);return n=(o.x-k.x)*n.x+(o.y-k.y)*n.y;default:am.b2Assert(false);return 0;}};j.postDefs.push(function(){j.Collision.b2SeparationFunction.e_points=1;
j.Collision.b2SeparationFunction.e_faceA=2;j.Collision.b2SeparationFunction.e_faceB=4;});ax.b2Simplex=function(){this.m_v1=new aw;this.m_v2=new aw;this.m_v3=new aw;
this.m_vertices=new b(3);};ax.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3;};ax.prototype.ReadCache=function(q,p,o,n,k){am.b2Assert(0<=q.count&&q.count<=3);
var A,y;this.m_count=q.count;for(var z=this.m_vertices,u=0;u<this.m_count;u++){var l=z[u];l.indexA=q.indexA[u];l.indexB=q.indexB[u];A=p.GetVertex(l.indexA);
y=n.GetVertex(l.indexB);l.wA=an.MulX(o,A);l.wB=an.MulX(k,y);l.w=an.SubtractVV(l.wB,l.wA);l.a=0;}if(this.m_count>1){q=q.metric;A=this.GetMetric();if(A<0.5*q||2*q<A||A<Number.MIN_VALUE){this.m_count=0;
}}if(this.m_count==0){l=z[0];l.indexA=0;l.indexB=0;A=p.GetVertex(0);y=n.GetVertex(0);l.wA=an.MulX(o,A);l.wB=an.MulX(k,y);l.w=an.SubtractVV(l.wB,l.wA);this.m_count=1;
}};ax.prototype.WriteCache=function(k){k.metric=this.GetMetric();k.count=j.parseUInt(this.m_count);for(var n=this.m_vertices,l=0;l<this.m_count;l++){k.indexA[l]=j.parseUInt(n[l].indexA);
k.indexB[l]=j.parseUInt(n[l].indexB);}};ax.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var k=an.SubtractVV(this.m_v2.w,this.m_v1.w);
return an.CrossVV(k,this.m_v1.w.GetNegative())>0?an.CrossFV(1,k):an.CrossVF(k,1);default:am.b2Assert(false);return new aq;}};ax.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:am.b2Assert(false);
return new aq;case 1:return this.m_v1.w;case 2:return new aq(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);
default:am.b2Assert(false);return new aq;}};ax.prototype.GetWitnessPoints=function(k,l){switch(this.m_count){case 0:am.b2Assert(false);break;case 1:k.SetV(this.m_v1.wA);
l.SetV(this.m_v1.wB);break;case 2:k.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;k.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;l.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;
l.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:l.x=k.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;
l.y=k.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:am.b2Assert(false);}};ax.prototype.GetMetric=function(){switch(this.m_count){case 0:am.b2Assert(false);
return 0;case 1:return 0;case 2:return an.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return an.CrossVV(an.SubtractVV(this.m_v2.w,this.m_v1.w),an.SubtractVV(this.m_v3.w,this.m_v1.w));
default:am.b2Assert(false);return 0;}};ax.prototype.Solve2=function(){var k=this.m_v1.w,n=this.m_v2.w,l=an.SubtractVV(n,k);k=-(k.x*l.x+k.y*l.y);if(k<=0){this.m_count=this.m_v1.a=1;
}else{n=n.x*l.x+n.y*l.y;if(n<=0){this.m_count=this.m_v2.a=1;this.m_v1.Set(this.m_v2);}else{l=1/(n+k);this.m_v1.a=n*l;this.m_v2.a=k*l;this.m_count=2;}}};
ax.prototype.Solve3=function(){var q=this.m_v1.w,p=this.m_v2.w,o=this.m_v3.w,n=an.SubtractVV(p,q),k=an.Dot(q,n),B=an.Dot(p,n);k=-k;var z=an.SubtractVV(o,q),A=an.Dot(q,z),y=an.Dot(o,z);
A=-A;var l=an.SubtractVV(o,p),u=an.Dot(p,l);l=an.Dot(o,l);u=-u;z=an.CrossVV(n,z);n=z*an.CrossVV(p,o);o=z*an.CrossVV(o,q);q=z*an.CrossVV(q,p);if(k<=0&&A<=0){this.m_count=this.m_v1.a=1;
}else{if(B>0&&k>0&&q<=0){y=1/(B+k);this.m_v1.a=B*y;this.m_v2.a=k*y;this.m_count=2;}else{if(y>0&&A>0&&o<=0){B=1/(y+A);this.m_v1.a=y*B;this.m_v3.a=A*B;this.m_count=2;
this.m_v2.Set(this.m_v3);}else{if(B<=0&&u<=0){this.m_count=this.m_v2.a=1;this.m_v1.Set(this.m_v2);}else{if(y<=0&&l<=0){this.m_count=this.m_v3.a=1;this.m_v1.Set(this.m_v3);
}else{if(l>0&&u>0&&n<=0){B=1/(l+u);this.m_v2.a=l*B;this.m_v3.a=u*B;this.m_count=2;this.m_v1.Set(this.m_v3);}else{B=1/(n+o+q);this.m_v1.a=n*B;this.m_v2.a=o*B;
this.m_v3.a=q*B;this.m_count=3;}}}}}}};au.b2SimplexCache=function(){this.indexA=new a(3);this.indexB=new a(3);};aw.b2SimplexVertex=function(){};aw.prototype.Set=function(k){this.wA.SetV(k.wA);
this.wB.SetV(k.wB);this.w.SetV(k.w);this.a=k.a;this.indexA=k.indexA;this.indexB=k.indexB;};ar.b2TimeOfImpact=function(){};ar.TimeOfImpact=function(D){++ar.b2_toiCalls;
var A=D.proxyA,z=D.proxyB,o=D.sweepA,k=D.sweepB;am.b2Assert(o.t0==k.t0);am.b2Assert(1-o.t0>Number.MIN_VALUE);var I=A.m_radius+z.m_radius;D=D.tolerance;
var G=0,H=0,F=0;ar.s_cache.count=0;for(ar.s_distanceInput.useRadii=false;;){o.GetTransform(ar.s_xfA,G);k.GetTransform(ar.s_xfB,G);ar.s_distanceInput.proxyA=A;
ar.s_distanceInput.proxyB=z;ar.s_distanceInput.transformA=ar.s_xfA;ar.s_distanceInput.transformB=ar.s_xfB;r.Distance(ar.s_distanceOutput,ar.s_cache,ar.s_distanceInput);
if(ar.s_distanceOutput.distance<=0){G=1;break;}ar.s_fcn.Initialize(ar.s_cache,A,ar.s_xfA,z,ar.s_xfB);var l=ar.s_fcn.Evaluate(ar.s_xfA,ar.s_xfB);if(l<=0){G=1;
break;}if(H==0){F=l>I?an.Max(I-D,0.75*I):an.Max(l-D,0.02*I);}if(l-F<0.5*D){if(H==0){G=1;break;}break;}var E=G,q=G,y=1;l=l;o.GetTransform(ar.s_xfA,y);k.GetTransform(ar.s_xfB,y);
var n=ar.s_fcn.Evaluate(ar.s_xfA,ar.s_xfB);if(n>=F){G=1;break;}for(var u=0;;){var B=0;B=u&1?q+(F-l)*(y-q)/(n-l):0.5*(q+y);o.GetTransform(ar.s_xfA,B);k.GetTransform(ar.s_xfB,B);
var p=ar.s_fcn.Evaluate(ar.s_xfA,ar.s_xfB);if(an.Abs(p-F)<0.025*D){E=B;break;}if(p>F){q=B;l=p;}else{y=B;n=p;}++u;++ar.b2_toiRootIters;if(u==50){break;}}ar.b2_toiMaxRootIters=an.Max(ar.b2_toiMaxRootIters,u);
if(E<(1+100*Number.MIN_VALUE)*G){break;}G=E;H++;++ar.b2_toiIters;if(H==1000){break;}}ar.b2_toiMaxIters=an.Max(ar.b2_toiMaxIters,H);return G;};j.postDefs.push(function(){j.Collision.b2TimeOfImpact.b2_toiCalls=0;
j.Collision.b2TimeOfImpact.b2_toiIters=0;j.Collision.b2TimeOfImpact.b2_toiMaxIters=0;j.Collision.b2TimeOfImpact.b2_toiRootIters=0;j.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;
j.Collision.b2TimeOfImpact.s_cache=new au;j.Collision.b2TimeOfImpact.s_distanceInput=new m;j.Collision.b2TimeOfImpact.s_xfA=new t;j.Collision.b2TimeOfImpact.s_xfB=new t;
j.Collision.b2TimeOfImpact.s_fcn=new az;j.Collision.b2TimeOfImpact.s_distanceOutput=new av;});ap.b2TOIInput=function(){this.proxyA=new al;this.proxyB=new al;
this.sweepA=new aj;this.sweepB=new aj;};at.b2WorldManifold=function(){this.m_normal=new aq;};at.prototype.b2WorldManifold=function(){this.m_points=new b(am.b2_maxManifoldPoints);
for(var k=0;k<am.b2_maxManifoldPoints;k++){this.m_points[k]=new aq;}};at.prototype.Initialize=function(y,u,q,n,k){if(q===g){q=0;}if(k===g){k=0;}if(y.m_pointCount!=0){var E=0,B,D,A=0,l=0,z=0,o=0,p=0;
B=0;switch(y.m_type){case ag.e_circles:D=u.R;B=y.m_localPoint;E=u.position.x+D.col1.x*B.x+D.col2.x*B.y;u=u.position.y+D.col1.y*B.x+D.col2.y*B.y;D=n.R;B=y.m_points[0].m_localPoint;
y=n.position.x+D.col1.x*B.x+D.col2.x*B.y;n=n.position.y+D.col1.y*B.x+D.col2.y*B.y;B=y-E;D=n-u;A=B*B+D*D;if(A>Number.MIN_VALUE*Number.MIN_VALUE){A=Math.sqrt(A);
this.m_normal.x=B/A;this.m_normal.y=D/A;}else{this.m_normal.x=1;this.m_normal.y=0;}B=u+q*this.m_normal.y;n=n-k*this.m_normal.y;this.m_points[0].x=0.5*(E+q*this.m_normal.x+(y-k*this.m_normal.x));
this.m_points[0].y=0.5*(B+n);break;case ag.e_faceA:D=u.R;B=y.m_localPlaneNormal;A=D.col1.x*B.x+D.col2.x*B.y;l=D.col1.y*B.x+D.col2.y*B.y;D=u.R;B=y.m_localPoint;
z=u.position.x+D.col1.x*B.x+D.col2.x*B.y;o=u.position.y+D.col1.y*B.x+D.col2.y*B.y;this.m_normal.x=A;this.m_normal.y=l;for(E=0;E<y.m_pointCount;E++){D=n.R;
B=y.m_points[E].m_localPoint;p=n.position.x+D.col1.x*B.x+D.col2.x*B.y;B=n.position.y+D.col1.y*B.x+D.col2.y*B.y;this.m_points[E].x=p+0.5*(q-(p-z)*A-(B-o)*l-k)*A;
this.m_points[E].y=B+0.5*(q-(p-z)*A-(B-o)*l-k)*l;}break;case ag.e_faceB:D=n.R;B=y.m_localPlaneNormal;A=D.col1.x*B.x+D.col2.x*B.y;l=D.col1.y*B.x+D.col2.y*B.y;
D=n.R;B=y.m_localPoint;z=n.position.x+D.col1.x*B.x+D.col2.x*B.y;o=n.position.y+D.col1.y*B.x+D.col2.y*B.y;this.m_normal.x=-A;this.m_normal.y=-l;for(E=0;
E<y.m_pointCount;E++){D=u.R;B=y.m_points[E].m_localPoint;p=u.position.x+D.col1.x*B.x+D.col2.x*B.y;B=u.position.y+D.col1.y*B.x+D.col2.y*B.y;this.m_points[E].x=p+0.5*(k-(p-z)*A-(B-o)*l-q)*A;
this.m_points[E].y=B+0.5*(k-(p-z)*A-(B-o)*l-q)*l;}}}};aB.ClipVertex=function(){this.v=new aq;this.id=new X;};aB.prototype.Set=function(k){this.v.SetV(k.v);
this.id.Set(k.id);};aA.Features=function(){};Object.defineProperty(aA.prototype,"referenceEdge",{enumerable:false,configurable:true,get:function(){return this._referenceEdge;
}});Object.defineProperty(aA.prototype,"referenceEdge",{enumerable:false,configurable:true,set:function(k){if(k===g){k=0;}this._referenceEdge=k;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255;
}});Object.defineProperty(aA.prototype,"incidentEdge",{enumerable:false,configurable:true,get:function(){return this._incidentEdge;}});Object.defineProperty(aA.prototype,"incidentEdge",{enumerable:false,configurable:true,set:function(k){if(k===g){k=0;
}this._incidentEdge=k;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280;}});Object.defineProperty(aA.prototype,"incidentVertex",{enumerable:false,configurable:true,get:function(){return this._incidentVertex;
}});Object.defineProperty(aA.prototype,"incidentVertex",{enumerable:false,configurable:true,set:function(k){if(k===g){k=0;}this._incidentVertex=k;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680;
}});Object.defineProperty(aA.prototype,"flip",{enumerable:false,configurable:true,get:function(){return this._flip;}});Object.defineProperty(aA.prototype,"flip",{enumerable:false,configurable:true,set:function(k){if(k===g){k=0;
}this._flip=k;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080;}});})();(function(){var D=j.Common.b2Settings,C=j.Collision.Shapes.b2CircleShape,v=j.Collision.Shapes.b2EdgeChainDef,u=j.Collision.Shapes.b2EdgeShape,z=j.Collision.Shapes.b2MassData,m=j.Collision.Shapes.b2PolygonShape,q=j.Collision.Shapes.b2Shape,l=j.Common.Math.b2Mat22,k=j.Common.Math.b2Math,r=j.Common.Math.b2Transform,o=j.Common.Math.b2Vec2,s=j.Collision.b2Distance,t=j.Collision.b2DistanceInput,x=j.Collision.b2DistanceOutput,n=j.Collision.b2DistanceProxy,i=j.Collision.b2SimplexCache;
j.inherit(C,j.Collision.Shapes.b2Shape);C.prototype.__super=j.Collision.Shapes.b2Shape.prototype;C.b2CircleShape=function(){j.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);
this.m_p=new o;};C.prototype.Copy=function(){var p=new C;p.Set(this);return p;};C.prototype.Set=function(p){this.__super.Set.call(this,p);if(j.is(p,C)){this.m_p.SetV((p instanceof C?p:null).m_p);
}};C.prototype.TestPoint=function(p,B){var y=p.R,A=p.position.x+(y.col1.x*this.m_p.x+y.col2.x*this.m_p.y);y=p.position.y+(y.col1.y*this.m_p.x+y.col2.y*this.m_p.y);
A=B.x-A;y=B.y-y;return A*A+y*y<=this.m_radius*this.m_radius;};C.prototype.RayCast=function(y,G,J){var p=J.R,I=G.p1.x-(J.position.x+(p.col1.x*this.m_p.x+p.col2.x*this.m_p.y));
J=G.p1.y-(J.position.y+(p.col1.y*this.m_p.x+p.col2.y*this.m_p.y));p=G.p2.x-G.p1.x;var B=G.p2.y-G.p1.y,K=I*p+J*B,A=p*p+B*B,F=K*K-A*(I*I+J*J-this.m_radius*this.m_radius);
if(F<0||A<Number.MIN_VALUE){return false;}K=-(K+Math.sqrt(F));if(0<=K&&K<=G.maxFraction*A){K/=A;y.fraction=K;y.normal.x=I+K*p;y.normal.y=J+K*B;y.normal.Normalize();
return true;}return false;};C.prototype.ComputeAABB=function(p,B){var y=B.R,A=B.position.x+(y.col1.x*this.m_p.x+y.col2.x*this.m_p.y);y=B.position.y+(y.col1.y*this.m_p.x+y.col2.y*this.m_p.y);
p.lowerBound.Set(A-this.m_radius,y-this.m_radius);p.upperBound.Set(A+this.m_radius,y+this.m_radius);};C.prototype.ComputeMass=function(p,y){if(y===g){y=0;
}p.mass=y*D.b2_pi*this.m_radius*this.m_radius;p.center.SetV(this.m_p);p.I=p.mass*(0.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y));
};C.prototype.ComputeSubmergedArea=function(p,F,y,E){if(F===g){F=0;}y=k.MulX(y,this.m_p);var A=-(k.Dot(p,y)-F);if(A<-this.m_radius+Number.MIN_VALUE){return 0;
}if(A>this.m_radius){E.SetV(y);return Math.PI*this.m_radius*this.m_radius;}F=this.m_radius*this.m_radius;var B=A*A;A=F*(Math.asin(A/this.m_radius)+Math.PI/2)+A*Math.sqrt(F-B);
F=-2/3*Math.pow(F-B,1.5)/A;E.x=y.x+p.x*F;E.y=y.y+p.y*F;return A;};C.prototype.GetLocalPosition=function(){return this.m_p;};C.prototype.SetLocalPosition=function(p){this.m_p.SetV(p);
};C.prototype.GetRadius=function(){return this.m_radius;};C.prototype.SetRadius=function(p){if(p===g){p=0;}this.m_radius=p;};C.prototype.b2CircleShape=function(p){if(p===g){p=0;
}this.__super.b2Shape.call(this);this.m_type=q.e_circleShape;this.m_radius=p;};v.b2EdgeChainDef=function(){};v.prototype.b2EdgeChainDef=function(){this.vertexCount=0;
this.isALoop=true;this.vertices=[];};j.inherit(u,j.Collision.Shapes.b2Shape);u.prototype.__super=j.Collision.Shapes.b2Shape.prototype;u.b2EdgeShape=function(){j.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);
this.s_supportVec=new o;this.m_v1=new o;this.m_v2=new o;this.m_coreV1=new o;this.m_coreV2=new o;this.m_normal=new o;this.m_direction=new o;this.m_cornerDir1=new o;
this.m_cornerDir2=new o;};u.prototype.TestPoint=function(){return false;};u.prototype.RayCast=function(A,J,L){var y,K=J.p2.x-J.p1.x,G=J.p2.y-J.p1.y;y=L.R;
var M=L.position.x+(y.col1.x*this.m_v1.x+y.col2.x*this.m_v1.y),F=L.position.y+(y.col1.y*this.m_v1.x+y.col2.y*this.m_v1.y),I=L.position.y+(y.col1.y*this.m_v2.x+y.col2.y*this.m_v2.y)-F;
L=-(L.position.x+(y.col1.x*this.m_v2.x+y.col2.x*this.m_v2.y)-M);y=100*Number.MIN_VALUE;var B=-(K*I+G*L);if(B>y){M=J.p1.x-M;var p=J.p1.y-F;F=M*I+p*L;if(0<=F&&F<=J.maxFraction*B){J=-K*p+G*M;
if(-y*B<=J&&J<=B*(1+y)){F/=B;A.fraction=F;J=Math.sqrt(I*I+L*L);A.normal.x=I/J;A.normal.y=L/J;return true;}}}return false;};u.prototype.ComputeAABB=function(p,F){var y=F.R,E=F.position.x+(y.col1.x*this.m_v1.x+y.col2.x*this.m_v1.y),A=F.position.y+(y.col1.y*this.m_v1.x+y.col2.y*this.m_v1.y),B=F.position.x+(y.col1.x*this.m_v2.x+y.col2.x*this.m_v2.y);
y=F.position.y+(y.col1.y*this.m_v2.x+y.col2.y*this.m_v2.y);if(E<B){p.lowerBound.x=E;p.upperBound.x=B;}else{p.lowerBound.x=B;p.upperBound.x=E;}if(A<y){p.lowerBound.y=A;
p.upperBound.y=y;}else{p.lowerBound.y=y;p.upperBound.y=A;}};u.prototype.ComputeMass=function(p){p.mass=0;p.center.SetV(this.m_v1);p.I=0;};u.prototype.ComputeSubmergedArea=function(p,I,y,G){if(I===g){I=0;
}var A=new o(p.x*I,p.y*I),F=k.MulX(y,this.m_v1);y=k.MulX(y,this.m_v2);var B=k.Dot(p,F)-I;p=k.Dot(p,y)-I;if(B>0){if(p>0){return 0;}else{F.x=-p/(B-p)*F.x+B/(B-p)*y.x;
F.y=-p/(B-p)*F.y+B/(B-p)*y.y;}}else{if(p>0){y.x=-p/(B-p)*F.x+B/(B-p)*y.x;y.y=-p/(B-p)*F.y+B/(B-p)*y.y;}}G.x=(A.x+F.x+y.x)/3;G.y=(A.y+F.y+y.y)/3;return 0.5*((F.x-A.x)*(y.y-A.y)-(F.y-A.y)*(y.x-A.x));
};u.prototype.GetLength=function(){return this.m_length;};u.prototype.GetVertex1=function(){return this.m_v1;};u.prototype.GetVertex2=function(){return this.m_v2;
};u.prototype.GetCoreVertex1=function(){return this.m_coreV1;};u.prototype.GetCoreVertex2=function(){return this.m_coreV2;};u.prototype.GetNormalVector=function(){return this.m_normal;
};u.prototype.GetDirectionVector=function(){return this.m_direction;};u.prototype.GetCorner1Vector=function(){return this.m_cornerDir1;};u.prototype.GetCorner2Vector=function(){return this.m_cornerDir2;
};u.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1;};u.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2;};u.prototype.GetFirstVertex=function(p){var y=p.R;
return new o(p.position.x+(y.col1.x*this.m_coreV1.x+y.col2.x*this.m_coreV1.y),p.position.y+(y.col1.y*this.m_coreV1.x+y.col2.y*this.m_coreV1.y));};u.prototype.GetNextEdge=function(){return this.m_nextEdge;
};u.prototype.GetPrevEdge=function(){return this.m_prevEdge;};u.prototype.Support=function(p,I,y){if(I===g){I=0;}if(y===g){y=0;}var G=p.R,A=p.position.x+(G.col1.x*this.m_coreV1.x+G.col2.x*this.m_coreV1.y),F=p.position.y+(G.col1.y*this.m_coreV1.x+G.col2.y*this.m_coreV1.y),B=p.position.x+(G.col1.x*this.m_coreV2.x+G.col2.x*this.m_coreV2.y);
p=p.position.y+(G.col1.y*this.m_coreV2.x+G.col2.y*this.m_coreV2.y);if(A*I+F*y>B*I+p*y){this.s_supportVec.x=A;this.s_supportVec.y=F;}else{this.s_supportVec.x=B;
this.s_supportVec.y=p;}return this.s_supportVec;};u.prototype.b2EdgeShape=function(p,y){this.__super.b2Shape.call(this);this.m_type=q.e_edgeShape;this.m_nextEdge=this.m_prevEdge=null;
this.m_v1=p;this.m_v2=y;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);
this.m_coreV1.Set(-D.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-D.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-D.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-D.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);
this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y);};u.prototype.SetPrevEdge=function(p,B,y,A){this.m_prevEdge=p;
this.m_coreV1=B;this.m_cornerDir1=y;this.m_cornerConvex1=A;};u.prototype.SetNextEdge=function(p,B,y,A){this.m_nextEdge=p;this.m_coreV2=B;this.m_cornerDir2=y;
this.m_cornerConvex2=A;};z.b2MassData=function(){this.mass=0;this.center=new o(0,0);this.I=0;};j.inherit(m,j.Collision.Shapes.b2Shape);m.prototype.__super=j.Collision.Shapes.b2Shape.prototype;
m.b2PolygonShape=function(){j.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);};m.prototype.Copy=function(){var p=new m;p.Set(this);return p;};m.prototype.Set=function(p){this.__super.Set.call(this,p);
if(j.is(p,m)){p=p instanceof m?p:null;this.m_centroid.SetV(p.m_centroid);this.m_vertexCount=p.m_vertexCount;this.Reserve(this.m_vertexCount);for(var y=0;
y<this.m_vertexCount;y++){this.m_vertices[y].SetV(p.m_vertices[y]);this.m_normals[y].SetV(p.m_normals[y]);}}};m.prototype.SetAsArray=function(p,E){if(E===g){E=0;
}var y=new b,B=0,A;for(B=0;B<p.length;++B){A=p[B];y.push(A);}this.SetAsVector(y,E);};m.AsArray=function(p,A){if(A===g){A=0;}var y=new m;y.SetAsArray(p,A);
return y;};m.prototype.SetAsVector=function(p,E){if(E===g){E=0;}if(E==0){E=p.length;}D.b2Assert(2<=E);this.m_vertexCount=E;this.Reserve(E);var y=0;for(y=0;
y<this.m_vertexCount;y++){this.m_vertices[y].SetV(p[y]);}for(y=0;y<this.m_vertexCount;++y){var B=parseInt(y),A=parseInt(y+1<this.m_vertexCount?y+1:0);B=k.SubtractVV(this.m_vertices[A],this.m_vertices[B]);
D.b2Assert(B.LengthSquared()>Number.MIN_VALUE);this.m_normals[y].SetV(k.CrossVF(B,1));this.m_normals[y].Normalize();}this.m_centroid=m.ComputeCentroid(this.m_vertices,this.m_vertexCount);
};m.AsVector=function(p,A){if(A===g){A=0;}var y=new m;y.SetAsVector(p,A);return y;};m.prototype.SetAsBox=function(p,y){if(p===g){p=0;}if(y===g){y=0;}this.m_vertexCount=4;
this.Reserve(4);this.m_vertices[0].Set(-p,-y);this.m_vertices[1].Set(p,-y);this.m_vertices[2].Set(p,y);this.m_vertices[3].Set(-p,y);this.m_normals[0].Set(0,-1);
this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero();};m.AsBox=function(p,A){if(p===g){p=0;}if(A===g){A=0;
}var y=new m;y.SetAsBox(p,A);return y;};m.prototype.SetAsOrientedBox=function(p,B,y,A){if(p===g){p=0;}if(B===g){B=0;}if(y===g){y=null;}if(A===g){A=0;}this.m_vertexCount=4;
this.Reserve(4);this.m_vertices[0].Set(-p,-B);this.m_vertices[1].Set(p,-B);this.m_vertices[2].Set(p,B);this.m_vertices[3].Set(-p,B);this.m_normals[0].Set(0,-1);
this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=y;p=new r;p.position=y;p.R.Set(A);for(y=0;y<this.m_vertexCount;
++y){this.m_vertices[y]=k.MulX(p,this.m_vertices[y]);this.m_normals[y]=k.MulMV(p.R,this.m_normals[y]);}};m.AsOrientedBox=function(p,E,y,B){if(p===g){p=0;
}if(E===g){E=0;}if(y===g){y=null;}if(B===g){B=0;}var A=new m;A.SetAsOrientedBox(p,E,y,B);return A;};m.prototype.SetAsEdge=function(p,y){this.m_vertexCount=2;
this.Reserve(2);this.m_vertices[0].SetV(p);this.m_vertices[1].SetV(y);this.m_centroid.x=0.5*(p.x+y.x);this.m_centroid.y=0.5*(p.y+y.y);this.m_normals[0]=k.CrossVF(k.SubtractVV(y,p),1);
this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y;};m.AsEdge=function(p,A){var y=new m;y.SetAsEdge(p,A);
return y;};m.prototype.TestPoint=function(p,J){var y;y=p.R;for(var I=J.x-p.position.x,A=J.y-p.position.y,G=I*y.col1.x+A*y.col1.y,F=I*y.col2.x+A*y.col2.y,B=0;
B<this.m_vertexCount;++B){y=this.m_vertices[B];I=G-y.x;A=F-y.y;y=this.m_normals[B];if(y.x*I+y.y*A>0){return false;}}return true;};m.prototype.RayCast=function(B,L,P){var y=0,M=L.maxFraction,I=0,Q=0,G,J;
I=L.p1.x-P.position.x;Q=L.p1.y-P.position.y;G=P.R;var F=I*G.col1.x+Q*G.col1.y,p=I*G.col2.x+Q*G.col2.y;I=L.p2.x-P.position.x;Q=L.p2.y-P.position.y;G=P.R;
L=I*G.col1.x+Q*G.col1.y-F;G=I*G.col2.x+Q*G.col2.y-p;for(var A=parseInt(-1),K=0;K<this.m_vertexCount;++K){J=this.m_vertices[K];I=J.x-F;Q=J.y-p;J=this.m_normals[K];
I=J.x*I+J.y*Q;Q=J.x*L+J.y*G;if(Q==0){if(I<0){return false;}}else{if(Q<0&&I<y*Q){y=I/Q;A=K;}else{if(Q>0&&I<M*Q){M=I/Q;}}}if(M<y-Number.MIN_VALUE){return false;
}}if(A>=0){B.fraction=y;G=P.R;J=this.m_normals[A];B.normal.x=G.col1.x*J.x+G.col2.x*J.y;B.normal.y=G.col1.y*J.x+G.col2.y*J.y;return true;}return false;};
m.prototype.ComputeAABB=function(y,I){for(var K=I.R,p=this.m_vertices[0],J=I.position.x+(K.col1.x*p.x+K.col2.x*p.y),F=I.position.y+(K.col1.y*p.x+K.col2.y*p.y),L=J,B=F,G=1;
G<this.m_vertexCount;++G){p=this.m_vertices[G];var A=I.position.x+(K.col1.x*p.x+K.col2.x*p.y);p=I.position.y+(K.col1.y*p.x+K.col2.y*p.y);J=J<A?J:A;F=F<p?F:p;
L=L>A?L:A;B=B>p?B:p;}y.lowerBound.x=J-this.m_radius;y.lowerBound.y=F-this.m_radius;y.upperBound.x=L+this.m_radius;y.upperBound.y=B+this.m_radius;};m.prototype.ComputeMass=function(F,Q){if(Q===g){Q=0;
}if(this.m_vertexCount==2){F.center.x=0.5*(this.m_vertices[0].x+this.m_vertices[1].x);F.center.y=0.5*(this.m_vertices[0].y+this.m_vertices[1].y);F.mass=0;
F.I=0;}else{for(var U=0,y=0,T=0,L=0,V=1/3,J=0;J<this.m_vertexCount;++J){var M=this.m_vertices[J],I=J+1<this.m_vertexCount?this.m_vertices[parseInt(J+1)]:this.m_vertices[0],p=M.x-0,A=M.y-0,P=I.x-0,K=I.y-0,B=p*K-A*P,G=0.5*B;
T+=G;U+=G*V*(0+M.x+I.x);y+=G*V*(0+M.y+I.y);M=p;A=A;P=P;K=K;L+=B*(V*(0.25*(M*M+P*M+P*P)+(0*M+0*P))+0+(V*(0.25*(A*A+K*A+K*K)+(0*A+0*K))+0));}F.mass=Q*T;U*=1/T;
y*=1/T;F.center.Set(U,y);F.I=Q*L;}};m.prototype.ComputeSubmergedArea=function(A,J,L,y){if(J===g){J=0;}var K=k.MulTMV(L.R,A),G=J-k.Dot(A,L.position),M=new a,F=0,I=parseInt(-1);
J=parseInt(-1);var B=false;for(A=A=0;A<this.m_vertexCount;++A){M[A]=k.Dot(K,this.m_vertices[A])-G;var p=M[A]<-Number.MIN_VALUE;if(A>0){if(p){if(!B){I=A-1;
F++;}}else{if(B){J=A-1;F++;}}}B=p;}switch(F){case 0:if(B){A=new z;this.ComputeMass(A,1);y.SetV(k.MulX(L,A.center));return A.mass;}else{return 0;}case 1:if(I==-1){I=this.m_vertexCount-1;
}else{J=this.m_vertexCount-1;}}A=parseInt((I+1)%this.m_vertexCount);K=parseInt((J+1)%this.m_vertexCount);G=(0-M[I])/(M[A]-M[I]);M=(0-M[J])/(M[K]-M[J]);
I=new o(this.m_vertices[I].x*(1-G)+this.m_vertices[A].x*G,this.m_vertices[I].y*(1-G)+this.m_vertices[A].y*G);J=new o(this.m_vertices[J].x*(1-M)+this.m_vertices[K].x*M,this.m_vertices[J].y*(1-M)+this.m_vertices[K].y*M);
M=0;G=new o;F=this.m_vertices[A];for(A=A;A!=K;){A=(A+1)%this.m_vertexCount;B=A==K?J:this.m_vertices[A];p=0.5*((F.x-I.x)*(B.y-I.y)-(F.y-I.y)*(B.x-I.x));
M+=p;G.x+=p*(I.x+F.x+B.x)/3;G.y+=p*(I.y+F.y+B.y)/3;F=B;}G.Multiply(1/M);y.SetV(k.MulX(L,G));return M;};m.prototype.GetVertexCount=function(){return this.m_vertexCount;
};m.prototype.GetVertices=function(){return this.m_vertices;};m.prototype.GetNormals=function(){return this.m_normals;};m.prototype.GetSupport=function(p){for(var E=0,y=this.m_vertices[0].x*p.x+this.m_vertices[0].y*p.y,B=1;
B<this.m_vertexCount;++B){var A=this.m_vertices[B].x*p.x+this.m_vertices[B].y*p.y;if(A>y){E=B;y=A;}}return E;};m.prototype.GetSupportVertex=function(p){for(var E=0,y=this.m_vertices[0].x*p.x+this.m_vertices[0].y*p.y,B=1;
B<this.m_vertexCount;++B){var A=this.m_vertices[B].x*p.x+this.m_vertices[B].y*p.y;if(A>y){E=B;y=A;}}return this.m_vertices[E];};m.prototype.Validate=function(){return false;
};m.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=q.e_polygonShape;this.m_centroid=new o;this.m_vertices=new b;this.m_normals=new b;
};m.prototype.Reserve=function(p){if(p===g){p=0;}for(var y=parseInt(this.m_vertices.length);y<p;y++){this.m_vertices[y]=new o;this.m_normals[y]=new o;}};
m.ComputeCentroid=function(y,G){if(G===g){G=0;}for(var J=new o,p=0,I=1/3,B=0;B<G;++B){var K=y[B],A=B+1<G?y[parseInt(B+1)]:y[0],F=0.5*((K.x-0)*(A.y-0)-(K.y-0)*(A.x-0));
p+=F;J.x+=F*I*(0+K.x+A.x);J.y+=F*I*(0+K.y+A.y);}J.x*=1/p;J.y*=1/p;return J;};m.ComputeOBB=function(T,G,J){if(J===g){J=0;}var L=0,I=new b(J+1);for(L=0;L<J;
++L){I[L]=G[L];}I[J]=I[0];G=Number.MAX_VALUE;for(L=1;L<=J;++L){var B=I[parseInt(L-1)],K=I[L].x-B.x,A=I[L].y-B.y,F=Math.sqrt(K*K+A*A);K/=F;A/=F;for(var y=-A,X=K,p=F=Number.MAX_VALUE,W=-Number.MAX_VALUE,V=-Number.MAX_VALUE,Q=0;
Q<J;++Q){var U=I[Q].x-B.x,P=I[Q].y-B.y,M=K*U+A*P;U=y*U+X*P;if(M<F){F=M;}if(U<p){p=U;}if(M>W){W=M;}if(U>V){V=U;}}Q=(W-F)*(V-p);if(Q<0.95*G){G=Q;T.R.col1.x=K;
T.R.col1.y=A;T.R.col2.x=y;T.R.col2.y=X;K=0.5*(F+W);A=0.5*(p+V);y=T.R;T.center.x=B.x+(y.col1.x*K+y.col2.x*A);T.center.y=B.y+(y.col1.y*K+y.col2.y*A);T.extents.x=0.5*(W-F);
T.extents.y=0.5*(V-p);}}};j.postDefs.push(function(){j.Collision.Shapes.b2PolygonShape.s_mat=new l;});q.b2Shape=function(){};q.prototype.Copy=function(){return null;
};q.prototype.Set=function(p){this.m_radius=p.m_radius;};q.prototype.GetType=function(){return this.m_type;};q.prototype.TestPoint=function(){return false;
};q.prototype.RayCast=function(){return false;};q.prototype.ComputeAABB=function(){};q.prototype.ComputeMass=function(){};q.prototype.ComputeSubmergedArea=function(){return 0;
};q.TestOverlap=function(p,E,y,B){var A=new t;A.proxyA=new n;A.proxyA.Set(p);A.proxyB=new n;A.proxyB.Set(y);A.transformA=E;A.transformB=B;A.useRadii=true;
p=new i;p.count=0;E=new x;s.Distance(E,p,A);return E.distance<10*Number.MIN_VALUE;};q.prototype.b2Shape=function(){this.m_type=q.e_unknownShape;this.m_radius=D.b2_linearSlop;
};j.postDefs.push(function(){j.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1);j.Collision.Shapes.b2Shape.e_circleShape=0;j.Collision.Shapes.b2Shape.e_polygonShape=1;
j.Collision.Shapes.b2Shape.e_edgeShape=2;j.Collision.Shapes.b2Shape.e_shapeTypeCount=3;j.Collision.Shapes.b2Shape.e_hitCollide=1;j.Collision.Shapes.b2Shape.e_missCollide=0;
j.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1);});})();(function(){var l=j.Common.b2Color,k=j.Common.b2Settings,i=j.Common.Math.b2Math;l.b2Color=function(){this._b=this._g=this._r=0;
};l.prototype.b2Color=function(o,n,m){if(o===g){o=0;}if(n===g){n=0;}if(m===g){m=0;}this._r=j.parseUInt(255*i.Clamp(o,0,1));this._g=j.parseUInt(255*i.Clamp(n,0,1));
this._b=j.parseUInt(255*i.Clamp(m,0,1));};l.prototype.Set=function(o,n,m){if(o===g){o=0;}if(n===g){n=0;}if(m===g){m=0;}this._r=j.parseUInt(255*i.Clamp(o,0,1));
this._g=j.parseUInt(255*i.Clamp(n,0,1));this._b=j.parseUInt(255*i.Clamp(m,0,1));};Object.defineProperty(l.prototype,"r",{enumerable:false,configurable:true,set:function(m){if(m===g){m=0;
}this._r=j.parseUInt(255*i.Clamp(m,0,1));}});Object.defineProperty(l.prototype,"g",{enumerable:false,configurable:true,set:function(m){if(m===g){m=0;}this._g=j.parseUInt(255*i.Clamp(m,0,1));
}});Object.defineProperty(l.prototype,"b",{enumerable:false,configurable:true,set:function(m){if(m===g){m=0;}this._b=j.parseUInt(255*i.Clamp(m,0,1));}});
Object.defineProperty(l.prototype,"color",{enumerable:false,configurable:true,get:function(){return this._r<<16|this._g<<8|this._b;}});k.b2Settings=function(){};
k.b2MixFriction=function(n,m){if(n===g){n=0;}if(m===g){m=0;}return Math.sqrt(n*m);};k.b2MixRestitution=function(n,m){if(n===g){n=0;}if(m===g){m=0;}return n>m?n:m;
};k.b2Assert=function(m){if(!m){throw"Assertion Failed";}};j.postDefs.push(function(){j.Common.b2Settings.VERSION="2.1alpha";j.Common.b2Settings.USHRT_MAX=65535;
j.Common.b2Settings.b2_pi=Math.PI;j.Common.b2Settings.b2_maxManifoldPoints=2;j.Common.b2Settings.b2_aabbExtension=0.1;j.Common.b2Settings.b2_aabbMultiplier=2;
j.Common.b2Settings.b2_polygonRadius=2*k.b2_linearSlop;j.Common.b2Settings.b2_linearSlop=0.005;j.Common.b2Settings.b2_angularSlop=2/180*k.b2_pi;j.Common.b2Settings.b2_toiSlop=8*k.b2_linearSlop;
j.Common.b2Settings.b2_maxTOIContactsPerIsland=32;j.Common.b2Settings.b2_maxTOIJointsPerIsland=32;j.Common.b2Settings.b2_velocityThreshold=1;j.Common.b2Settings.b2_maxLinearCorrection=0.2;
j.Common.b2Settings.b2_maxAngularCorrection=8/180*k.b2_pi;j.Common.b2Settings.b2_maxTranslation=2;j.Common.b2Settings.b2_maxTranslationSquared=k.b2_maxTranslation*k.b2_maxTranslation;
j.Common.b2Settings.b2_maxRotation=0.5*k.b2_pi;j.Common.b2Settings.b2_maxRotationSquared=k.b2_maxRotation*k.b2_maxRotation;j.Common.b2Settings.b2_contactBaumgarte=0.2;
j.Common.b2Settings.b2_timeToSleep=0.5;j.Common.b2Settings.b2_linearSleepTolerance=0.01;j.Common.b2Settings.b2_angularSleepTolerance=2/180*k.b2_pi;});})();
(function(){var o=j.Common.Math.b2Mat22,n=j.Common.Math.b2Mat33,l=j.Common.Math.b2Math,p=j.Common.Math.b2Sweep,k=j.Common.Math.b2Transform,i=j.Common.Math.b2Vec2,m=j.Common.Math.b2Vec3;
o.b2Mat22=function(){this.col1=new i;this.col2=new i;};o.prototype.b2Mat22=function(){this.SetIdentity();};o.FromAngle=function(q){if(q===g){q=0;}var r=new o;
r.Set(q);return r;};o.FromVV=function(r,s){var q=new o;q.SetVV(r,s);return q;};o.prototype.Set=function(q){if(q===g){q=0;}var r=Math.cos(q);q=Math.sin(q);
this.col1.x=r;this.col2.x=-q;this.col1.y=q;this.col2.y=r;};o.prototype.SetVV=function(q,r){this.col1.SetV(q);this.col2.SetV(r);};o.prototype.Copy=function(){var q=new o;
q.SetM(this);return q;};o.prototype.SetM=function(q){this.col1.SetV(q.col1);this.col2.SetV(q.col2);};o.prototype.AddM=function(q){this.col1.x+=q.col1.x;
this.col1.y+=q.col1.y;this.col2.x+=q.col2.x;this.col2.y+=q.col2.y;};o.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1;
};o.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0;};o.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x);
};o.prototype.GetInverse=function(t){var v=this.col1.x,s=this.col2.x,r=this.col1.y,u=this.col2.y,q=v*u-s*r;if(q!=0){q=1/q;}t.col1.x=q*u;t.col2.x=-q*s;t.col1.y=-q*r;
t.col2.y=q*v;return t;};o.prototype.Solve=function(v,y,u){if(y===g){y=0;}if(u===g){u=0;}var s=this.col1.x,x=this.col2.x,r=this.col1.y,t=this.col2.y,q=s*t-x*r;
if(q!=0){q=1/q;}v.x=q*(t*y-x*u);v.y=q*(s*u-r*y);return v;};o.prototype.Abs=function(){this.col1.Abs();this.col2.Abs();};n.b2Mat33=function(){this.col1=new m;
this.col2=new m;this.col3=new m;};n.prototype.b2Mat33=function(r,s,q){if(r===g){r=null;}if(s===g){s=null;}if(q===g){q=null;}if(!r&&!s&&!q){this.col1.SetZero();
this.col2.SetZero();this.col3.SetZero();}else{this.col1.SetV(r);this.col2.SetV(s);this.col3.SetV(q);}};n.prototype.SetVVV=function(r,s,q){this.col1.SetV(r);
this.col2.SetV(s);this.col3.SetV(q);};n.prototype.Copy=function(){return new n(this.col1,this.col2,this.col3);};n.prototype.SetM=function(q){this.col1.SetV(q.col1);
this.col2.SetV(q.col2);this.col3.SetV(q.col3);};n.prototype.AddM=function(q){this.col1.x+=q.col1.x;this.col1.y+=q.col1.y;this.col1.z+=q.col1.z;this.col2.x+=q.col2.x;
this.col2.y+=q.col2.y;this.col2.z+=q.col2.z;this.col3.x+=q.col3.x;this.col3.y+=q.col3.y;this.col3.z+=q.col3.z;};n.prototype.SetIdentity=function(){this.col1.x=1;
this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1;};n.prototype.SetZero=function(){this.col1.x=0;
this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0;};n.prototype.Solve22=function(v,y,u){if(y===g){y=0;
}if(u===g){u=0;}var s=this.col1.x,x=this.col2.x,r=this.col1.y,t=this.col2.y,q=s*t-x*r;if(q!=0){q=1/q;}v.x=q*(t*y-x*u);v.y=q*(s*u-r*y);return v;};n.prototype.Solve33=function(t,s,A,x){if(s===g){s=0;
}if(A===g){A=0;}if(x===g){x=0;}var C=this.col1.x,F=this.col1.y,G=this.col1.z,v=this.col2.x,r=this.col2.y,y=this.col2.z,E=this.col3.x,K=this.col3.y,q=this.col3.z,J=C*(r*q-y*K)+F*(y*E-v*q)+G*(v*K-r*E);
if(J!=0){J=1/J;}t.x=J*(s*(r*q-y*K)+A*(y*E-v*q)+x*(v*K-r*E));t.y=J*(C*(A*q-x*K)+F*(x*E-s*q)+G*(s*K-A*E));t.z=J*(C*(r*x-y*A)+F*(y*s-v*x)+G*(v*A-r*s));return t;
};l.b2Math=function(){};l.IsValid=function(q){if(q===g){q=0;}return isFinite(q);};l.Dot=function(q,r){return q.x*r.x+q.y*r.y;};l.CrossVV=function(q,r){return q.x*r.y-q.y*r.x;
};l.CrossVF=function(q,r){if(r===g){r=0;}return new i(r*q.y,-r*q.x);};l.CrossFV=function(q,r){if(q===g){q=0;}return new i(-q*r.y,q*r.x);};l.MulMV=function(q,r){return new i(q.col1.x*r.x+q.col2.x*r.y,q.col1.y*r.x+q.col2.y*r.y);
};l.MulTMV=function(q,r){return new i(l.Dot(r,q.col1),l.Dot(r,q.col2));};l.MulX=function(r,s){var q=l.MulMV(r.R,s);q.x+=r.position.x;q.y+=r.position.y;
return q;};l.MulXT=function(s,t){var r=l.SubtractVV(t,s.position),q=r.x*s.R.col1.x+r.y*s.R.col1.y;r.y=r.x*s.R.col2.x+r.y*s.R.col2.y;r.x=q;return r;};l.AddVV=function(q,r){return new i(q.x+r.x,q.y+r.y);
};l.SubtractVV=function(q,r){return new i(q.x-r.x,q.y-r.y);};l.Distance=function(s,t){var r=s.x-t.x,q=s.y-t.y;return Math.sqrt(r*r+q*q);};l.DistanceSquared=function(s,t){var r=s.x-t.x,q=s.y-t.y;
return r*r+q*q;};l.MulFV=function(q,r){if(q===g){q=0;}return new i(q*r.x,q*r.y);};l.AddMM=function(q,r){return o.FromVV(l.AddVV(q.col1,r.col1),l.AddVV(q.col2,r.col2));
};l.MulMM=function(q,r){return o.FromVV(l.MulMV(q,r.col1),l.MulMV(q,r.col2));};l.MulTMM=function(s,t){var r=new i(l.Dot(s.col1,t.col1),l.Dot(s.col2,t.col1)),q=new i(l.Dot(s.col1,t.col2),l.Dot(s.col2,t.col2));
return o.FromVV(r,q);};l.Abs=function(q){if(q===g){q=0;}return q>0?q:-q;};l.AbsV=function(q){return new i(l.Abs(q.x),l.Abs(q.y));};l.AbsM=function(q){return o.FromVV(l.AbsV(q.col1),l.AbsV(q.col2));
};l.Min=function(q,r){if(q===g){q=0;}if(r===g){r=0;}return q<r?q:r;};l.MinV=function(q,r){return new i(l.Min(q.x,r.x),l.Min(q.y,r.y));};l.Max=function(q,r){if(q===g){q=0;
}if(r===g){r=0;}return q>r?q:r;};l.MaxV=function(q,r){return new i(l.Max(q.x,r.x),l.Max(q.y,r.y));};l.Clamp=function(r,s,q){if(r===g){r=0;}if(s===g){s=0;
}if(q===g){q=0;}return r<s?s:r>q?q:r;};l.ClampV=function(r,s,q){return l.MaxV(s,l.MinV(r,q));};l.Swap=function(r,s){var q=r[0];r[0]=s[0];s[0]=q;};l.Random=function(){return Math.random()*2-1;
};l.RandomRange=function(r,s){if(r===g){r=0;}if(s===g){s=0;}var q=Math.random();return q=(s-r)*q+r;};l.NextPowerOfTwo=function(q){if(q===g){q=0;}q|=q>>1&2147483647;
q|=q>>2&1073741823;q|=q>>4&268435455;q|=q>>8&16777215;q|=q>>16&65535;return q+1;};l.IsPowerOfTwo=function(q){if(q===g){q=0;}return q>0&&(q&q-1)==0;};j.postDefs.push(function(){j.Common.Math.b2Math.b2Vec2_zero=new i(0,0);
j.Common.Math.b2Math.b2Mat22_identity=o.FromVV(new i(1,0),new i(0,1));j.Common.Math.b2Math.b2Transform_identity=new k(l.b2Vec2_zero,l.b2Mat22_identity);
});p.b2Sweep=function(){this.localCenter=new i;this.c0=new i;this.c=new i;};p.prototype.Set=function(q){this.localCenter.SetV(q.localCenter);this.c0.SetV(q.c0);
this.c.SetV(q.c);this.a0=q.a0;this.a=q.a;this.t0=q.t0;};p.prototype.Copy=function(){var q=new p;q.localCenter.SetV(this.localCenter);q.c0.SetV(this.c0);
q.c.SetV(this.c);q.a0=this.a0;q.a=this.a;q.t0=this.t0;return q;};p.prototype.GetTransform=function(r,s){if(s===g){s=0;}r.position.x=(1-s)*this.c0.x+s*this.c.x;
r.position.y=(1-s)*this.c0.y+s*this.c.y;r.R.Set((1-s)*this.a0+s*this.a);var q=r.R;r.position.x-=q.col1.x*this.localCenter.x+q.col2.x*this.localCenter.y;
r.position.y-=q.col1.y*this.localCenter.x+q.col2.y*this.localCenter.y;};p.prototype.Advance=function(q){if(q===g){q=0;}if(this.t0<q&&1-this.t0>Number.MIN_VALUE){var r=(q-this.t0)/(1-this.t0);
this.c0.x=(1-r)*this.c0.x+r*this.c.x;this.c0.y=(1-r)*this.c0.y+r*this.c.y;this.a0=(1-r)*this.a0+r*this.a;this.t0=q;}};k.b2Transform=function(){this.position=new i;
this.R=new o;};k.prototype.b2Transform=function(q,r){if(q===g){q=null;}if(r===g){r=null;}if(q){this.position.SetV(q);this.R.SetM(r);}};k.prototype.Initialize=function(q,r){this.position.SetV(q);
this.R.SetM(r);};k.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity();};k.prototype.Set=function(q){this.position.SetV(q.position);
this.R.SetM(q.R);};k.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x);};i.b2Vec2=function(){};i.prototype.b2Vec2=function(q,r){if(q===g){q=0;
}if(r===g){r=0;}this.x=q;this.y=r;};i.prototype.SetZero=function(){this.y=this.x=0;};i.prototype.Set=function(q,r){if(q===g){q=0;}if(r===g){r=0;}this.x=q;
this.y=r;};i.prototype.SetV=function(q){this.x=q.x;this.y=q.y;};i.prototype.GetNegative=function(){return new i(-this.x,-this.y);};i.prototype.NegativeSelf=function(){this.x=-this.x;
this.y=-this.y;};i.Make=function(q,r){if(q===g){q=0;}if(r===g){r=0;}return new i(q,r);};i.prototype.Copy=function(){return new i(this.x,this.y);};i.prototype.Add=function(q){this.x+=q.x;
this.y+=q.y;};i.prototype.Subtract=function(q){this.x-=q.x;this.y-=q.y;};i.prototype.Multiply=function(q){if(q===g){q=0;}this.x*=q;this.y*=q;};i.prototype.MulM=function(q){var r=this.x;
this.x=q.col1.x*r+q.col2.x*this.y;this.y=q.col1.y*r+q.col2.y*this.y;};i.prototype.MulTM=function(q){var r=l.Dot(this,q.col1);this.y=l.Dot(this,q.col2);
this.x=r;};i.prototype.CrossVF=function(q){if(q===g){q=0;}var r=this.x;this.x=q*this.y;this.y=-q*r;};i.prototype.CrossFV=function(q){if(q===g){q=0;}var r=this.x;
this.x=-q*this.y;this.y=q*r;};i.prototype.MinV=function(q){this.x=this.x<q.x?this.x:q.x;this.y=this.y<q.y?this.y:q.y;};i.prototype.MaxV=function(q){this.x=this.x>q.x?this.x:q.x;
this.y=this.y>q.y?this.y:q.y;};i.prototype.Abs=function(){if(this.x<0){this.x=-this.x;}if(this.y<0){this.y=-this.y;}};i.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y);
};i.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y;};i.prototype.Normalize=function(){var q=Math.sqrt(this.x*this.x+this.y*this.y);
if(q<Number.MIN_VALUE){return 0;}var r=1/q;this.x*=r;this.y*=r;return q;};i.prototype.IsValid=function(){return l.IsValid(this.x)&&l.IsValid(this.y);};
m.b2Vec3=function(){};m.prototype.b2Vec3=function(r,s,q){if(r===g){r=0;}if(s===g){s=0;}if(q===g){q=0;}this.x=r;this.y=s;this.z=q;};m.prototype.SetZero=function(){this.x=this.y=this.z=0;
};m.prototype.Set=function(r,s,q){if(r===g){r=0;}if(s===g){s=0;}if(q===g){q=0;}this.x=r;this.y=s;this.z=q;};m.prototype.SetV=function(q){this.x=q.x;this.y=q.y;
this.z=q.z;};m.prototype.GetNegative=function(){return new m(-this.x,-this.y,-this.z);};m.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;
this.z=-this.z;};m.prototype.Copy=function(){return new m(this.x,this.y,this.z);};m.prototype.Add=function(q){this.x+=q.x;this.y+=q.y;this.z+=q.z;};m.prototype.Subtract=function(q){this.x-=q.x;
this.y-=q.y;this.z-=q.z;};m.prototype.Multiply=function(q){if(q===g){q=0;}this.x*=q;this.y*=q;this.z*=q;};})();(function(){var aj=j.Common.Math.b2Math,ah=j.Common.Math.b2Sweep,ac=j.Common.Math.b2Transform,ad=j.Common.Math.b2Vec2,ag=j.Common.b2Color,ao=j.Common.b2Settings,t=j.Collision.b2AABB,ap=j.Collision.b2ContactPoint,an=j.Collision.b2DynamicTreeBroadPhase,C=j.Collision.b2RayCastInput,s=j.Collision.b2RayCastOutput,T=j.Collision.Shapes.b2CircleShape,X=j.Collision.Shapes.b2EdgeShape,ae=j.Collision.Shapes.b2MassData,r=j.Collision.Shapes.b2PolygonShape,m=j.Collision.Shapes.b2Shape,au=j.Dynamics.b2Body,ab=j.Dynamics.b2BodyDef,ai=j.Dynamics.b2ContactFilter,al=j.Dynamics.b2ContactImpulse,af=j.Dynamics.b2ContactListener,J=j.Dynamics.b2ContactManager,ak=j.Dynamics.b2DebugDraw,x=j.Dynamics.b2DestructionListener,P=j.Dynamics.b2FilterData,v=j.Dynamics.b2Fixture,ay=j.Dynamics.b2FixtureDef,i=j.Dynamics.b2Island,ax=j.Dynamics.b2TimeStep,aw=j.Dynamics.b2World,at=j.Dynamics.Contacts.b2Contact,av=j.Dynamics.Contacts.b2ContactFactory,aq=j.Dynamics.Contacts.b2ContactSolver,am=j.Dynamics.Joints.b2Joint,ar=j.Dynamics.Joints.b2PulleyJoint;
au.b2Body=function(){this.m_xf=new ac;this.m_sweep=new ah;this.m_linearVelocity=new ad;this.m_force=new ad;};au.prototype.connectEdges=function(l,q,n){if(n===g){n=0;
}var k=Math.atan2(q.GetDirectionVector().y,q.GetDirectionVector().x);n=aj.MulFV(Math.tan((k-n)*0.5),q.GetDirectionVector());n=aj.SubtractVV(n,q.GetNormalVector());
n=aj.MulFV(ao.b2_toiSlop,n);n=aj.AddVV(n,q.GetVertex1());var p=aj.AddVV(l.GetDirectionVector(),q.GetDirectionVector());p.Normalize();var o=aj.Dot(l.GetDirectionVector(),q.GetNormalVector())>0;
l.SetNextEdge(q,n,p,o);q.SetPrevEdge(l,n,p,o);return k;};au.prototype.CreateFixture=function(k){if(this.m_world.IsLocked()==true){return null;}var l=new v;
l.Create(this,this.m_xf,k);this.m_flags&au.e_activeFlag&&l.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf);l.m_next=this.m_fixtureList;
this.m_fixtureList=l;++this.m_fixtureCount;l.m_body=this;l.m_density>0&&this.ResetMassData();this.m_world.m_flags|=aw.e_newFixture;return l;};au.prototype.CreateFixture2=function(k,n){if(n===g){n=0;
}var l=new ay;l.shape=k;l.density=n;return this.CreateFixture(l);};au.prototype.DestroyFixture=function(l){if(this.m_world.IsLocked()!=true){for(var p=this.m_fixtureList,n=null;
p!=null;){if(p==l){if(n){n.m_next=l.m_next;}else{this.m_fixtureList=l.m_next;}break;}n=p;p=p.m_next;}for(p=this.m_contactList;p;){n=p.contact;p=p.next;
var k=n.GetFixtureA(),o=n.GetFixtureB();if(l==k||l==o){this.m_world.m_contactManager.Destroy(n);}}this.m_flags&au.e_activeFlag&&l.DestroyProxy(this.m_world.m_contactManager.m_broadPhase);
l.Destroy();l.m_body=null;l.m_next=null;--this.m_fixtureCount;this.ResetMassData();}};au.prototype.SetPositionAndAngle=function(l,o){if(o===g){o=0;}var n;
if(this.m_world.IsLocked()!=true){this.m_xf.R.Set(o);this.m_xf.position.SetV(l);n=this.m_xf.R;var k=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*k.x+n.col2.x*k.y;
this.m_sweep.c.y=n.col1.y*k.x+n.col2.y*k.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);
this.m_sweep.a0=this.m_sweep.a=o;k=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next){n.Synchronize(k,this.m_xf,this.m_xf);
}this.m_world.m_contactManager.FindNewContacts();}};au.prototype.SetTransform=function(k){this.SetPositionAndAngle(k.position,k.GetAngle());};au.prototype.GetTransform=function(){return this.m_xf;
};au.prototype.GetPosition=function(){return this.m_xf.position;};au.prototype.SetPosition=function(k){this.SetPositionAndAngle(k,this.GetAngle());};au.prototype.GetAngle=function(){return this.m_sweep.a;
};au.prototype.SetAngle=function(k){if(k===g){k=0;}this.SetPositionAndAngle(this.GetPosition(),k);};au.prototype.GetWorldCenter=function(){return this.m_sweep.c;
};au.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter;};au.prototype.SetLinearVelocity=function(k){this.m_type!=au.b2_staticBody&&this.m_linearVelocity.SetV(k);
};au.prototype.GetLinearVelocity=function(){return this.m_linearVelocity;};au.prototype.SetAngularVelocity=function(k){if(k===g){k=0;}if(this.m_type!=au.b2_staticBody){this.m_angularVelocity=k;
}};au.prototype.GetAngularVelocity=function(){return this.m_angularVelocity;};au.prototype.GetDefinition=function(){var k=new ab;k.type=this.GetType();
k.allowSleep=(this.m_flags&au.e_allowSleepFlag)==au.e_allowSleepFlag;k.angle=this.GetAngle();k.angularDamping=this.m_angularDamping;k.angularVelocity=this.m_angularVelocity;
k.fixedRotation=(this.m_flags&au.e_fixedRotationFlag)==au.e_fixedRotationFlag;k.bullet=(this.m_flags&au.e_bulletFlag)==au.e_bulletFlag;k.awake=(this.m_flags&au.e_awakeFlag)==au.e_awakeFlag;
k.linearDamping=this.m_linearDamping;k.linearVelocity.SetV(this.GetLinearVelocity());k.position=this.GetPosition();k.userData=this.GetUserData();return k;
};au.prototype.ApplyForce=function(k,l){if(this.m_type==au.b2_dynamicBody){this.IsAwake()==false&&this.SetAwake(true);this.m_force.x+=k.x;this.m_force.y+=k.y;
this.m_torque+=(l.x-this.m_sweep.c.x)*k.y-(l.y-this.m_sweep.c.y)*k.x;}};au.prototype.ApplyTorque=function(k){if(k===g){k=0;}if(this.m_type==au.b2_dynamicBody){this.IsAwake()==false&&this.SetAwake(true);
this.m_torque+=k;}};au.prototype.ApplyImpulse=function(k,l){if(this.m_type==au.b2_dynamicBody){this.IsAwake()==false&&this.SetAwake(true);this.m_linearVelocity.x+=this.m_invMass*k.x;
this.m_linearVelocity.y+=this.m_invMass*k.y;this.m_angularVelocity+=this.m_invI*((l.x-this.m_sweep.c.x)*k.y-(l.y-this.m_sweep.c.y)*k.x);}};au.prototype.Split=function(n){for(var y=this.GetLinearVelocity().Copy(),p=this.GetAngularVelocity(),l=this.GetWorldCenter(),u=this.m_world.CreateBody(this.GetDefinition()),q,k=this.m_fixtureList;
k;){if(n(k)){var o=k.m_next;if(q){q.m_next=o;}else{this.m_fixtureList=o;}this.m_fixtureCount--;k.m_next=u.m_fixtureList;u.m_fixtureList=k;u.m_fixtureCount++;
k.m_body=u;k=o;}else{q=k;k=k.m_next;}}this.ResetMassData();u.ResetMassData();q=this.GetWorldCenter();n=u.GetWorldCenter();q=aj.AddVV(y,aj.CrossFV(p,aj.SubtractVV(q,l)));
y=aj.AddVV(y,aj.CrossFV(p,aj.SubtractVV(n,l)));this.SetLinearVelocity(q);u.SetLinearVelocity(y);this.SetAngularVelocity(p);u.SetAngularVelocity(p);this.SynchronizeFixtures();
u.SynchronizeFixtures();return u;};au.prototype.Merge=function(l){var p;for(p=l.m_fixtureList;p;){var n=p.m_next;l.m_fixtureCount--;p.m_next=this.m_fixtureList;
this.m_fixtureList=p;this.m_fixtureCount++;p.m_body=o;p=n;}k.m_fixtureCount=0;var k=this,o=l;k.GetWorldCenter();o.GetWorldCenter();k.GetLinearVelocity().Copy();
o.GetLinearVelocity().Copy();k.GetAngularVelocity();o.GetAngularVelocity();k.ResetMassData();this.SynchronizeFixtures();};au.prototype.GetMass=function(){return this.m_mass;
};au.prototype.GetInertia=function(){return this.m_I;};au.prototype.GetMassData=function(k){k.mass=this.m_mass;k.I=this.m_I;k.center.SetV(this.m_sweep.localCenter);
};au.prototype.SetMassData=function(k){ao.b2Assert(this.m_world.IsLocked()==false);if(this.m_world.IsLocked()!=true){if(this.m_type==au.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0;
this.m_mass=k.mass;if(this.m_mass<=0){this.m_mass=1;}this.m_invMass=1/this.m_mass;if(k.I>0&&(this.m_flags&au.e_fixedRotationFlag)==0){this.m_I=k.I-this.m_mass*(k.center.x*k.center.x+k.center.y*k.center.y);
this.m_invI=1/this.m_I;}var l=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(k.center);this.m_sweep.c0.SetV(aj.MulX(this.m_xf,this.m_sweep.localCenter));
this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-l.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-l.x);
}}};au.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();if(!(this.m_type==au.b2_staticBody||this.m_type==au.b2_kinematicBody)){for(var k=ad.Make(0,0),n=this.m_fixtureList;
n;n=n.m_next){if(n.m_density!=0){var l=n.GetMassData();this.m_mass+=l.mass;k.x+=l.center.x*l.mass;k.y+=l.center.y*l.mass;this.m_I+=l.I;}}if(this.m_mass>0){this.m_invMass=1/this.m_mass;
k.x*=this.m_invMass;k.y*=this.m_invMass;}else{this.m_invMass=this.m_mass=1;}if(this.m_I>0&&(this.m_flags&au.e_fixedRotationFlag)==0){this.m_I-=this.m_mass*(k.x*k.x+k.y*k.y);
this.m_I*=this.m_inertiaScale;ao.b2Assert(this.m_I>0);this.m_invI=1/this.m_I;}else{this.m_invI=this.m_I=0;}n=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(k);
this.m_sweep.c0.SetV(aj.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-n.y);
this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-n.x);}};au.prototype.GetWorldPoint=function(k){var l=this.m_xf.R;k=new ad(l.col1.x*k.x+l.col2.x*k.y,l.col1.y*k.x+l.col2.y*k.y);
k.x+=this.m_xf.position.x;k.y+=this.m_xf.position.y;return k;};au.prototype.GetWorldVector=function(k){return aj.MulMV(this.m_xf.R,k);};au.prototype.GetLocalPoint=function(k){return aj.MulXT(this.m_xf,k);
};au.prototype.GetLocalVector=function(k){return aj.MulTMV(this.m_xf.R,k);};au.prototype.GetLinearVelocityFromWorldPoint=function(k){return new ad(this.m_linearVelocity.x-this.m_angularVelocity*(k.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(k.x-this.m_sweep.c.x));
};au.prototype.GetLinearVelocityFromLocalPoint=function(k){var l=this.m_xf.R;k=new ad(l.col1.x*k.x+l.col2.x*k.y,l.col1.y*k.x+l.col2.y*k.y);k.x+=this.m_xf.position.x;
k.y+=this.m_xf.position.y;return new ad(this.m_linearVelocity.x-this.m_angularVelocity*(k.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(k.x-this.m_sweep.c.x));
};au.prototype.GetLinearDamping=function(){return this.m_linearDamping;};au.prototype.SetLinearDamping=function(k){if(k===g){k=0;}this.m_linearDamping=k;
};au.prototype.GetAngularDamping=function(){return this.m_angularDamping;};au.prototype.SetAngularDamping=function(k){if(k===g){k=0;}this.m_angularDamping=k;
};au.prototype.SetType=function(k){if(k===g){k=0;}if(this.m_type!=k){this.m_type=k;this.ResetMassData();if(this.m_type==au.b2_staticBody){this.m_linearVelocity.SetZero();
this.m_angularVelocity=0;}this.SetAwake(true);this.m_force.SetZero();this.m_torque=0;for(k=this.m_contactList;k;k=k.next){k.contact.FlagForFiltering();
}}};au.prototype.GetType=function(){return this.m_type;};au.prototype.SetBullet=function(k){if(k){this.m_flags|=au.e_bulletFlag;}else{this.m_flags&=~au.e_bulletFlag;
}};au.prototype.IsBullet=function(){return(this.m_flags&au.e_bulletFlag)==au.e_bulletFlag;};au.prototype.SetSleepingAllowed=function(k){if(k){this.m_flags|=au.e_allowSleepFlag;
}else{this.m_flags&=~au.e_allowSleepFlag;this.SetAwake(true);}};au.prototype.SetAwake=function(k){if(k){this.m_flags|=au.e_awakeFlag;this.m_sleepTime=0;
}else{this.m_flags&=~au.e_awakeFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0;
}};au.prototype.IsAwake=function(){return(this.m_flags&au.e_awakeFlag)==au.e_awakeFlag;};au.prototype.SetFixedRotation=function(k){if(k){this.m_flags|=au.e_fixedRotationFlag;
}else{this.m_flags&=~au.e_fixedRotationFlag;}this.ResetMassData();};au.prototype.IsFixedRotation=function(){return(this.m_flags&au.e_fixedRotationFlag)==au.e_fixedRotationFlag;
};au.prototype.SetActive=function(k){if(k!=this.IsActive()){var l;if(k){this.m_flags|=au.e_activeFlag;k=this.m_world.m_contactManager.m_broadPhase;for(l=this.m_fixtureList;
l;l=l.m_next){l.CreateProxy(k,this.m_xf);}}else{this.m_flags&=~au.e_activeFlag;k=this.m_world.m_contactManager.m_broadPhase;for(l=this.m_fixtureList;l;
l=l.m_next){l.DestroyProxy(k);}for(k=this.m_contactList;k;){l=k;k=k.next;this.m_world.m_contactManager.Destroy(l.contact);}this.m_contactList=null;}}};
au.prototype.IsActive=function(){return(this.m_flags&au.e_activeFlag)==au.e_activeFlag;};au.prototype.IsSleepingAllowed=function(){return(this.m_flags&au.e_allowSleepFlag)==au.e_allowSleepFlag;
};au.prototype.GetFixtureList=function(){return this.m_fixtureList;};au.prototype.GetJointList=function(){return this.m_jointList;};au.prototype.GetControllerList=function(){return this.m_controllerList;
};au.prototype.GetContactList=function(){return this.m_contactList;};au.prototype.GetNext=function(){return this.m_next;};au.prototype.GetUserData=function(){return this.m_userData;
};au.prototype.SetUserData=function(k){this.m_userData=k;};au.prototype.GetWorld=function(){return this.m_world;};au.prototype.b2Body=function(l,o){this.m_flags=0;
if(l.bullet){this.m_flags|=au.e_bulletFlag;}if(l.fixedRotation){this.m_flags|=au.e_fixedRotationFlag;}if(l.allowSleep){this.m_flags|=au.e_allowSleepFlag;
}if(l.awake){this.m_flags|=au.e_awakeFlag;}if(l.active){this.m_flags|=au.e_activeFlag;}this.m_world=o;this.m_xf.position.SetV(l.position);this.m_xf.R.Set(l.angle);
this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=l.angle;var n=this.m_xf.R,k=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*k.x+n.col2.x*k.y;
this.m_sweep.c.y=n.col1.y*k.x+n.col2.y*k.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);
this.m_contactList=this.m_controllerList=this.m_jointList=null;this.m_controllerCount=0;this.m_next=this.m_prev=null;this.m_linearVelocity.SetV(l.linearVelocity);
this.m_angularVelocity=l.angularVelocity;this.m_linearDamping=l.linearDamping;this.m_angularDamping=l.angularDamping;this.m_force.Set(0,0);this.m_sleepTime=this.m_torque=0;
this.m_type=l.type;if(this.m_type==au.b2_dynamicBody){this.m_invMass=this.m_mass=1;}else{this.m_invMass=this.m_mass=0;}this.m_invI=this.m_I=0;this.m_inertiaScale=l.inertiaScale;
this.m_userData=l.userData;this.m_fixtureList=null;this.m_fixtureCount=0;};au.prototype.SynchronizeFixtures=function(){var k=au.s_xf1;k.R.Set(this.m_sweep.a0);
var n=k.R,l=this.m_sweep.localCenter;k.position.x=this.m_sweep.c0.x-(n.col1.x*l.x+n.col2.x*l.y);k.position.y=this.m_sweep.c0.y-(n.col1.y*l.x+n.col2.y*l.y);
l=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next){n.Synchronize(l,k,this.m_xf);}};au.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);
var k=this.m_xf.R,l=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(k.col1.x*l.x+k.col2.x*l.y);this.m_xf.position.y=this.m_sweep.c.y-(k.col1.y*l.x+k.col2.y*l.y);
};au.prototype.ShouldCollide=function(k){if(this.m_type!=au.b2_dynamicBody&&k.m_type!=au.b2_dynamicBody){return false;}for(var l=this.m_jointList;l;l=l.next){if(l.other==k){if(l.joint.m_collideConnected==false){return false;
}}}return true;};au.prototype.Advance=function(k){if(k===g){k=0;}this.m_sweep.Advance(k);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;
this.SynchronizeTransform();};j.postDefs.push(function(){j.Dynamics.b2Body.s_xf1=new ac;j.Dynamics.b2Body.e_islandFlag=1;j.Dynamics.b2Body.e_awakeFlag=2;
j.Dynamics.b2Body.e_allowSleepFlag=4;j.Dynamics.b2Body.e_bulletFlag=8;j.Dynamics.b2Body.e_fixedRotationFlag=16;j.Dynamics.b2Body.e_activeFlag=32;j.Dynamics.b2Body.b2_staticBody=0;
j.Dynamics.b2Body.b2_kinematicBody=1;j.Dynamics.b2Body.b2_dynamicBody=2;});ab.b2BodyDef=function(){this.position=new ad;this.linearVelocity=new ad;};ab.prototype.b2BodyDef=function(){this.userData=null;
this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularDamping=this.linearDamping=this.angularVelocity=0;this.awake=this.allowSleep=true;
this.bullet=this.fixedRotation=false;this.type=au.b2_staticBody;this.active=true;this.inertiaScale=1;};ai.b2ContactFilter=function(){};ai.prototype.ShouldCollide=function(l,o){var n=l.GetFilterData(),k=o.GetFilterData();
if(n.groupIndex==k.groupIndex&&n.groupIndex!=0){return n.groupIndex>0;}return(n.maskBits&k.categoryBits)!=0&&(n.categoryBits&k.maskBits)!=0;};ai.prototype.RayCollide=function(k,l){if(!k){return true;
}return this.ShouldCollide(k instanceof v?k:null,l);};j.postDefs.push(function(){j.Dynamics.b2ContactFilter.b2_defaultFilter=new ai;});al.b2ContactImpulse=function(){this.normalImpulses=new a(ao.b2_maxManifoldPoints);
this.tangentImpulses=new a(ao.b2_maxManifoldPoints);};af.b2ContactListener=function(){};af.prototype.BeginContact=function(){};af.prototype.EndContact=function(){};
af.prototype.PreSolve=function(){};af.prototype.PostSolve=function(){};j.postDefs.push(function(){j.Dynamics.b2ContactListener.b2_defaultListener=new af;
});J.b2ContactManager=function(){};J.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=ai.b2_defaultFilter;
this.m_contactListener=af.b2_defaultListener;this.m_contactFactory=new av(this.m_allocator);this.m_broadPhase=new an;};J.prototype.AddPair=function(y,q){var n=y instanceof v?y:null,u=q instanceof v?q:null,p=n.GetBody(),o=u.GetBody();
if(p!=o){for(var l=o.GetContactList();l;){if(l.other==p){var k=l.contact.GetFixtureA(),z=l.contact.GetFixtureB();if(k==n&&z==u){return;}if(k==u&&z==n){return;
}}l=l.next;}if(o.ShouldCollide(p)!=false){if(this.m_contactFilter.ShouldCollide(n,u)!=false){l=this.m_contactFactory.Create(n,u);n=l.GetFixtureA();u=l.GetFixtureB();
p=n.m_body;o=u.m_body;l.m_prev=null;l.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null){this.m_world.m_contactList.m_prev=l;}this.m_world.m_contactList=l;
l.m_nodeA.contact=l;l.m_nodeA.other=o;l.m_nodeA.prev=null;l.m_nodeA.next=p.m_contactList;if(p.m_contactList!=null){p.m_contactList.prev=l.m_nodeA;}p.m_contactList=l.m_nodeA;
l.m_nodeB.contact=l;l.m_nodeB.other=p;l.m_nodeB.prev=null;l.m_nodeB.next=o.m_contactList;if(o.m_contactList!=null){o.m_contactList.prev=l.m_nodeB;}o.m_contactList=l.m_nodeB;
++this.m_world.m_contactCount;}}}};J.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(j.generateCallback(this,this.AddPair));};J.prototype.Destroy=function(k){var n=k.GetFixtureA(),l=k.GetFixtureB();
n=n.GetBody();l=l.GetBody();k.IsTouching()&&this.m_contactListener.EndContact(k);if(k.m_prev){k.m_prev.m_next=k.m_next;}if(k.m_next){k.m_next.m_prev=k.m_prev;
}if(k==this.m_world.m_contactList){this.m_world.m_contactList=k.m_next;}if(k.m_nodeA.prev){k.m_nodeA.prev.next=k.m_nodeA.next;}if(k.m_nodeA.next){k.m_nodeA.next.prev=k.m_nodeA.prev;
}if(k.m_nodeA==n.m_contactList){n.m_contactList=k.m_nodeA.next;}if(k.m_nodeB.prev){k.m_nodeB.prev.next=k.m_nodeB.next;}if(k.m_nodeB.next){k.m_nodeB.next.prev=k.m_nodeB.prev;
}if(k.m_nodeB==l.m_contactList){l.m_contactList=k.m_nodeB.next;}this.m_contactFactory.Destroy(k);--this.m_contactCount;};J.prototype.Collide=function(){for(var l=this.m_world.m_contactList;
l;){var p=l.GetFixtureA(),n=l.GetFixtureB(),k=p.GetBody(),o=n.GetBody();if(k.IsAwake()==false&&o.IsAwake()==false){l=l.GetNext();}else{if(l.m_flags&at.e_filterFlag){if(o.ShouldCollide(k)==false){p=l;
l=p.GetNext();this.Destroy(p);continue;}if(this.m_contactFilter.ShouldCollide(p,n)==false){p=l;l=p.GetNext();this.Destroy(p);continue;}l.m_flags&=~at.e_filterFlag;
}if(this.m_broadPhase.TestOverlap(p.m_proxy,n.m_proxy)==false){p=l;l=p.GetNext();this.Destroy(p);}else{l.Update(this.m_contactListener);l=l.GetNext();}}}};
j.postDefs.push(function(){j.Dynamics.b2ContactManager.s_evalCP=new ap;});ak.b2DebugDraw=function(){};ak.prototype.b2DebugDraw=function(){};ak.prototype.SetFlags=function(){};
ak.prototype.GetFlags=function(){};ak.prototype.AppendFlags=function(){};ak.prototype.ClearFlags=function(){};ak.prototype.SetSprite=function(){};ak.prototype.GetSprite=function(){};
ak.prototype.SetDrawScale=function(){};ak.prototype.GetDrawScale=function(){};ak.prototype.SetLineThickness=function(){};ak.prototype.GetLineThickness=function(){};
ak.prototype.SetAlpha=function(){};ak.prototype.GetAlpha=function(){};ak.prototype.SetFillAlpha=function(){};ak.prototype.GetFillAlpha=function(){};ak.prototype.SetXFormScale=function(){};
ak.prototype.GetXFormScale=function(){};ak.prototype.DrawPolygon=function(){};ak.prototype.DrawSolidPolygon=function(){};ak.prototype.DrawCircle=function(){};
ak.prototype.DrawSolidCircle=function(){};ak.prototype.DrawSegment=function(){};ak.prototype.DrawTransform=function(){};j.postDefs.push(function(){j.Dynamics.b2DebugDraw.e_shapeBit=1;
j.Dynamics.b2DebugDraw.e_jointBit=2;j.Dynamics.b2DebugDraw.e_aabbBit=4;j.Dynamics.b2DebugDraw.e_pairBit=8;j.Dynamics.b2DebugDraw.e_centerOfMassBit=16;j.Dynamics.b2DebugDraw.e_controllerBit=32;
});x.b2DestructionListener=function(){};x.prototype.SayGoodbyeJoint=function(){};x.prototype.SayGoodbyeFixture=function(){};P.b2FilterData=function(){this.categoryBits=1;
this.maskBits=65535;this.groupIndex=0;};P.prototype.Copy=function(){var k=new P;k.categoryBits=this.categoryBits;k.maskBits=this.maskBits;k.groupIndex=this.groupIndex;
return k;};v.b2Fixture=function(){this.m_filter=new P;};v.prototype.GetType=function(){return this.m_shape.GetType();};v.prototype.GetShape=function(){return this.m_shape;
};v.prototype.SetSensor=function(l){if(this.m_isSensor!=l){this.m_isSensor=l;if(this.m_body!=null){for(l=this.m_body.GetContactList();l;){var o=l.contact,n=o.GetFixtureA(),k=o.GetFixtureB();
if(n==this||k==this){o.SetSensor(n.IsSensor()||k.IsSensor());}l=l.next;}}}};v.prototype.IsSensor=function(){return this.m_isSensor;};v.prototype.SetFilterData=function(l){this.m_filter=l.Copy();
if(!this.m_body){for(l=this.m_body.GetContactList();l;){var o=l.contact,n=o.GetFixtureA(),k=o.GetFixtureB();if(n==this||k==this){o.FlagForFiltering();}l=l.next;
}}};v.prototype.GetFilterData=function(){return this.m_filter.Copy();};v.prototype.GetBody=function(){return this.m_body;};v.prototype.GetNext=function(){return this.m_next;
};v.prototype.GetUserData=function(){return this.m_userData;};v.prototype.SetUserData=function(k){this.m_userData=k;};v.prototype.TestPoint=function(k){return this.m_shape.TestPoint(this.m_body.GetTransform(),k);
};v.prototype.RayCast=function(k,l){return this.m_shape.RayCast(k,l,this.m_body.GetTransform());};v.prototype.GetMassData=function(k){if(k===g){k=null;
}if(k==null){k=new ae;}this.m_shape.ComputeMass(k,this.m_density);return k;};v.prototype.SetDensity=function(k){if(k===g){k=0;}this.m_density=k;};v.prototype.GetDensity=function(){return this.m_density;
};v.prototype.GetFriction=function(){return this.m_friction;};v.prototype.SetFriction=function(k){if(k===g){k=0;}this.m_friction=k;};v.prototype.GetRestitution=function(){return this.m_restitution;
};v.prototype.SetRestitution=function(k){if(k===g){k=0;}this.m_restitution=k;};v.prototype.GetAABB=function(){return this.m_aabb;};v.prototype.b2Fixture=function(){this.m_aabb=new t;
this.m_shape=this.m_next=this.m_body=this.m_userData=null;this.m_restitution=this.m_friction=this.m_density=0;};v.prototype.Create=function(k,n,l){this.m_userData=l.userData;
this.m_friction=l.friction;this.m_restitution=l.restitution;this.m_body=k;this.m_next=null;this.m_filter=l.filter.Copy();this.m_isSensor=l.isSensor;this.m_shape=l.shape.Copy();
this.m_density=l.density;};v.prototype.Destroy=function(){this.m_shape=null;};v.prototype.CreateProxy=function(k,l){this.m_shape.ComputeAABB(this.m_aabb,l);
this.m_proxy=k.CreateProxy(this.m_aabb,this);};v.prototype.DestroyProxy=function(k){if(this.m_proxy!=null){k.DestroyProxy(this.m_proxy);this.m_proxy=null;
}};v.prototype.Synchronize=function(l,p,n){if(this.m_proxy){var k=new t,o=new t;this.m_shape.ComputeAABB(k,p);this.m_shape.ComputeAABB(o,n);this.m_aabb.Combine(k,o);
p=aj.SubtractVV(n.position,p.position);l.MoveProxy(this.m_proxy,this.m_aabb,p);}};ay.b2FixtureDef=function(){this.filter=new P;};ay.prototype.b2FixtureDef=function(){this.userData=this.shape=null;
this.friction=0.2;this.density=this.restitution=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=false;};
i.b2Island=function(){};i.prototype.b2Island=function(){this.m_bodies=new b;this.m_contacts=new b;this.m_joints=new b;};i.prototype.Initialize=function(n,u,o,l,q,p){if(n===g){n=0;
}if(u===g){u=0;}if(o===g){o=0;}var k=0;this.m_bodyCapacity=n;this.m_contactCapacity=u;this.m_jointCapacity=o;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;
this.m_allocator=l;this.m_listener=q;this.m_contactSolver=p;for(k=this.m_bodies.length;k<n;k++){this.m_bodies[k]=null;}for(k=this.m_contacts.length;k<u;
k++){this.m_contacts[k]=null;}for(k=this.m_joints.length;k<o;k++){this.m_joints[k]=null;}};i.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;
};i.prototype.Solve=function(n,y,p){var l=0,u=0,q;for(l=0;l<this.m_bodyCount;++l){u=this.m_bodies[l];if(u.GetType()==au.b2_dynamicBody){u.m_linearVelocity.x+=n.dt*(y.x+u.m_invMass*u.m_force.x);
u.m_linearVelocity.y+=n.dt*(y.y+u.m_invMass*u.m_force.y);u.m_angularVelocity+=n.dt*u.m_invI*u.m_torque;u.m_linearVelocity.Multiply(aj.Clamp(1-n.dt*u.m_linearDamping,0,1));
u.m_angularVelocity*=aj.Clamp(1-n.dt*u.m_angularDamping,0,1);}}this.m_contactSolver.Initialize(n,this.m_contacts,this.m_contactCount,this.m_allocator);
y=this.m_contactSolver;y.InitVelocityConstraints(n);for(l=0;l<this.m_jointCount;++l){q=this.m_joints[l];q.InitVelocityConstraints(n);}for(l=0;l<n.velocityIterations;
++l){for(u=0;u<this.m_jointCount;++u){q=this.m_joints[u];q.SolveVelocityConstraints(n);}y.SolveVelocityConstraints();}for(l=0;l<this.m_jointCount;++l){q=this.m_joints[l];
q.FinalizeVelocityConstraints();}y.FinalizeVelocityConstraints();for(l=0;l<this.m_bodyCount;++l){u=this.m_bodies[l];if(u.GetType()!=au.b2_staticBody){var k=n.dt*u.m_linearVelocity.x,o=n.dt*u.m_linearVelocity.y;
if(k*k+o*o>ao.b2_maxTranslationSquared){u.m_linearVelocity.Normalize();u.m_linearVelocity.x*=ao.b2_maxTranslation*n.inv_dt;u.m_linearVelocity.y*=ao.b2_maxTranslation*n.inv_dt;
}k=n.dt*u.m_angularVelocity;if(k*k>ao.b2_maxRotationSquared){u.m_angularVelocity=u.m_angularVelocity<0?-ao.b2_maxRotation*n.inv_dt:ao.b2_maxRotation*n.inv_dt;
}u.m_sweep.c0.SetV(u.m_sweep.c);u.m_sweep.a0=u.m_sweep.a;u.m_sweep.c.x+=n.dt*u.m_linearVelocity.x;u.m_sweep.c.y+=n.dt*u.m_linearVelocity.y;u.m_sweep.a+=n.dt*u.m_angularVelocity;
u.SynchronizeTransform();}}for(l=0;l<n.positionIterations;++l){k=y.SolvePositionConstraints(ao.b2_contactBaumgarte);o=true;for(u=0;u<this.m_jointCount;
++u){q=this.m_joints[u];q=q.SolvePositionConstraints(ao.b2_contactBaumgarte);o=o&&q;}if(k&&o){break;}}this.Report(y.m_constraints);if(p){p=Number.MAX_VALUE;
y=ao.b2_linearSleepTolerance*ao.b2_linearSleepTolerance;k=ao.b2_angularSleepTolerance*ao.b2_angularSleepTolerance;for(l=0;l<this.m_bodyCount;++l){u=this.m_bodies[l];
if(u.GetType()!=au.b2_staticBody){if((u.m_flags&au.e_allowSleepFlag)==0){p=u.m_sleepTime=0;}if((u.m_flags&au.e_allowSleepFlag)==0||u.m_angularVelocity*u.m_angularVelocity>k||aj.Dot(u.m_linearVelocity,u.m_linearVelocity)>y){p=u.m_sleepTime=0;
}else{u.m_sleepTime+=n.dt;p=aj.Min(p,u.m_sleepTime);}}}if(p>=ao.b2_timeToSleep){for(l=0;l<this.m_bodyCount;++l){u=this.m_bodies[l];u.SetAwake(false);}}}};
i.prototype.SolveTOI=function(n){var u=0,o=0;this.m_contactSolver.Initialize(n,this.m_contacts,this.m_contactCount,this.m_allocator);var l=this.m_contactSolver;
for(u=0;u<this.m_jointCount;++u){this.m_joints[u].InitVelocityConstraints(n);}for(u=0;u<n.velocityIterations;++u){l.SolveVelocityConstraints();for(o=0;
o<this.m_jointCount;++o){this.m_joints[o].SolveVelocityConstraints(n);}}for(u=0;u<this.m_bodyCount;++u){o=this.m_bodies[u];if(o.GetType()!=au.b2_staticBody){var q=n.dt*o.m_linearVelocity.x,p=n.dt*o.m_linearVelocity.y;
if(q*q+p*p>ao.b2_maxTranslationSquared){o.m_linearVelocity.Normalize();o.m_linearVelocity.x*=ao.b2_maxTranslation*n.inv_dt;o.m_linearVelocity.y*=ao.b2_maxTranslation*n.inv_dt;
}q=n.dt*o.m_angularVelocity;if(q*q>ao.b2_maxRotationSquared){o.m_angularVelocity=o.m_angularVelocity<0?-ao.b2_maxRotation*n.inv_dt:ao.b2_maxRotation*n.inv_dt;
}o.m_sweep.c0.SetV(o.m_sweep.c);o.m_sweep.a0=o.m_sweep.a;o.m_sweep.c.x+=n.dt*o.m_linearVelocity.x;o.m_sweep.c.y+=n.dt*o.m_linearVelocity.y;o.m_sweep.a+=n.dt*o.m_angularVelocity;
o.SynchronizeTransform();}}for(u=0;u<n.positionIterations;++u){q=l.SolvePositionConstraints(0.75);p=true;for(o=0;o<this.m_jointCount;++o){var k=this.m_joints[o].SolvePositionConstraints(ao.b2_contactBaumgarte);
p=p&&k;}if(q&&p){break;}}this.Report(l.m_constraints);};i.prototype.Report=function(l){if(this.m_listener!=null){for(var p=0;p<this.m_contactCount;++p){for(var n=this.m_contacts[p],k=l[p],o=0;
o<k.pointCount;++o){i.s_impulse.normalImpulses[o]=k.points[o].normalImpulse;i.s_impulse.tangentImpulses[o]=k.points[o].tangentImpulse;}this.m_listener.PostSolve(n,i.s_impulse);
}}};i.prototype.AddBody=function(k){k.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=k;};i.prototype.AddContact=function(k){this.m_contacts[this.m_contactCount++]=k;
};i.prototype.AddJoint=function(k){this.m_joints[this.m_jointCount++]=k;};j.postDefs.push(function(){j.Dynamics.b2Island.s_impulse=new al;});ax.b2TimeStep=function(){};
ax.prototype.Set=function(k){this.dt=k.dt;this.inv_dt=k.inv_dt;this.positionIterations=k.positionIterations;this.velocityIterations=k.velocityIterations;
this.warmStarting=k.warmStarting;};aw.b2World=function(){this.s_stack=new b;this.m_contactManager=new J;this.m_contactSolver=new aq;this.m_island=new i;
};aw.prototype.b2World=function(k,l){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null;
this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;aw.m_warmStarting=true;aw.m_continuousPhysics=true;this.m_allowSleep=l;
this.m_gravity=k;this.m_inv_dt0=0;this.m_contactManager.m_world=this;this.m_groundBody=this.CreateBody(new ab);};aw.prototype.SetDestructionListener=function(k){this.m_destructionListener=k;
};aw.prototype.SetContactFilter=function(k){this.m_contactManager.m_contactFilter=k;};aw.prototype.SetContactListener=function(k){this.m_contactManager.m_contactListener=k;
};aw.prototype.SetDebugDraw=function(k){this.m_debugDraw=k;};aw.prototype.SetBroadPhase=function(l){var o=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=l;
for(var n=this.m_bodyList;n;n=n.m_next){for(var k=n.m_fixtureList;k;k=k.m_next){k.m_proxy=l.CreateProxy(o.GetFatAABB(k.m_proxy),k);}}};aw.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate();
};aw.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount();};aw.prototype.CreateBody=function(k){if(this.IsLocked()==true){return null;
}k=new au(k,this);k.m_prev=null;if(k.m_next=this.m_bodyList){this.m_bodyList.m_prev=k;}this.m_bodyList=k;++this.m_bodyCount;return k;};aw.prototype.DestroyBody=function(k){if(this.IsLocked()!=true){for(var n=k.m_jointList;
n;){var l=n;n=n.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(l.joint);this.DestroyJoint(l.joint);}for(n=k.m_controllerList;
n;){l=n;n=n.nextController;l.controller.RemoveBody(k);}for(n=k.m_contactList;n;){l=n;n=n.next;this.m_contactManager.Destroy(l.contact);}k.m_contactList=null;
for(n=k.m_fixtureList;n;){l=n;n=n.m_next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(l);l.DestroyProxy(this.m_contactManager.m_broadPhase);
l.Destroy();}k.m_fixtureList=null;k.m_fixtureCount=0;if(k.m_prev){k.m_prev.m_next=k.m_next;}if(k.m_next){k.m_next.m_prev=k.m_prev;}if(k==this.m_bodyList){this.m_bodyList=k.m_next;
}--this.m_bodyCount;}};aw.prototype.CreateJoint=function(l){var o=am.Create(l,null);o.m_prev=null;if(o.m_next=this.m_jointList){this.m_jointList.m_prev=o;
}this.m_jointList=o;++this.m_jointCount;o.m_edgeA.joint=o;o.m_edgeA.other=o.m_bodyB;o.m_edgeA.prev=null;if(o.m_edgeA.next=o.m_bodyA.m_jointList){o.m_bodyA.m_jointList.prev=o.m_edgeA;
}o.m_bodyA.m_jointList=o.m_edgeA;o.m_edgeB.joint=o;o.m_edgeB.other=o.m_bodyA;o.m_edgeB.prev=null;if(o.m_edgeB.next=o.m_bodyB.m_jointList){o.m_bodyB.m_jointList.prev=o.m_edgeB;
}o.m_bodyB.m_jointList=o.m_edgeB;var n=l.bodyA,k=l.bodyB;if(l.collideConnected==false){for(l=k.GetContactList();l;){l.other==n&&l.contact.FlagForFiltering();
l=l.next;}}return o;};aw.prototype.DestroyJoint=function(l){var o=l.m_collideConnected;if(l.m_prev){l.m_prev.m_next=l.m_next;}if(l.m_next){l.m_next.m_prev=l.m_prev;
}if(l==this.m_jointList){this.m_jointList=l.m_next;}var n=l.m_bodyA,k=l.m_bodyB;n.SetAwake(true);k.SetAwake(true);if(l.m_edgeA.prev){l.m_edgeA.prev.next=l.m_edgeA.next;
}if(l.m_edgeA.next){l.m_edgeA.next.prev=l.m_edgeA.prev;}if(l.m_edgeA==n.m_jointList){n.m_jointList=l.m_edgeA.next;}l.m_edgeA.prev=null;l.m_edgeA.next=null;
if(l.m_edgeB.prev){l.m_edgeB.prev.next=l.m_edgeB.next;}if(l.m_edgeB.next){l.m_edgeB.next.prev=l.m_edgeB.prev;}if(l.m_edgeB==k.m_jointList){k.m_jointList=l.m_edgeB.next;
}l.m_edgeB.prev=null;l.m_edgeB.next=null;am.Destroy(l,null);--this.m_jointCount;if(o==false){for(l=k.GetContactList();l;){l.other==n&&l.contact.FlagForFiltering();
l=l.next;}}};aw.prototype.AddController=function(k){k.m_next=this.m_controllerList;k.m_prev=null;this.m_controllerList=k;k.m_world=this;this.m_controllerCount++;
return k;};aw.prototype.RemoveController=function(k){if(k.m_prev){k.m_prev.m_next=k.m_next;}if(k.m_next){k.m_next.m_prev=k.m_prev;}if(this.m_controllerList==k){this.m_controllerList=k.m_next;
}this.m_controllerCount--;};aw.prototype.CreateController=function(k){if(k.m_world!=this){throw Error("Controller can only be a member of one world");}k.m_next=this.m_controllerList;
k.m_prev=null;if(this.m_controllerList){this.m_controllerList.m_prev=k;}this.m_controllerList=k;++this.m_controllerCount;k.m_world=this;return k;};aw.prototype.DestroyController=function(k){k.Clear();
if(k.m_next){k.m_next.m_prev=k.m_prev;}if(k.m_prev){k.m_prev.m_next=k.m_next;}if(k==this.m_controllerList){this.m_controllerList=k.m_next;}--this.m_controllerCount;
};aw.prototype.SetWarmStarting=function(k){aw.m_warmStarting=k;};aw.prototype.SetContinuousPhysics=function(k){aw.m_continuousPhysics=k;};aw.prototype.GetBodyCount=function(){return this.m_bodyCount;
};aw.prototype.GetJointCount=function(){return this.m_jointCount;};aw.prototype.GetContactCount=function(){return this.m_contactCount;};aw.prototype.SetGravity=function(k){this.m_gravity=k;
};aw.prototype.GetGravity=function(){return this.m_gravity;};aw.prototype.GetGroundBody=function(){return this.m_groundBody;};aw.prototype.Step=function(l,o,n){if(l===g){l=0;
}if(o===g){o=0;}if(n===g){n=0;}if(this.m_flags&aw.e_newFixture){this.m_contactManager.FindNewContacts();this.m_flags&=~aw.e_newFixture;}this.m_flags|=aw.e_locked;
var k=aw.s_timestep2;k.dt=l;k.velocityIterations=o;k.positionIterations=n;k.inv_dt=l>0?1/l:0;k.dtRatio=this.m_inv_dt0*l;k.warmStarting=aw.m_warmStarting;
this.m_contactManager.Collide();k.dt>0&&this.Solve(k);aw.m_continuousPhysics&&k.dt>0&&this.SolveTOI(k);if(k.dt>0){this.m_inv_dt0=k.inv_dt;}this.m_flags&=~aw.e_locked;
};aw.prototype.ClearForces=function(){for(var k=this.m_bodyList;k;k=k.m_next){k.m_force.SetZero();k.m_torque=0;}};aw.prototype.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();
var n=this.m_debugDraw.GetFlags(),u,o,l;new ad;new ad;new ad;var q;new t;new t;q=[new ad,new ad,new ad,new ad];var p=new ag(0,0,0);if(n&ak.e_shapeBit){for(u=this.m_bodyList;
u;u=u.m_next){q=u.m_xf;for(o=u.GetFixtureList();o;o=o.m_next){l=o.GetShape();if(u.IsActive()==false){p.Set(0.5,0.5,0.3);}else{if(u.GetType()==au.b2_staticBody){p.Set(0.5,0.9,0.5);
}else{if(u.GetType()==au.b2_kinematicBody){p.Set(0.5,0.5,0.9);}else{u.IsAwake()==false?p.Set(0.6,0.6,0.6):p.Set(0.9,0.7,0.7);}}}this.DrawShape(l,q,p);}}}if(n&ak.e_jointBit){for(u=this.m_jointList;
u;u=u.m_next){this.DrawJoint(u);}}if(n&ak.e_controllerBit){for(u=this.m_controllerList;u;u=u.m_next){u.Draw(this.m_debugDraw);}}if(n&ak.e_pairBit){p.Set(0.3,0.9,0.9);
for(u=this.m_contactManager.m_contactList;u;u=u.GetNext()){l=u.GetFixtureA();o=u.GetFixtureB();l=l.GetAABB().GetCenter();o=o.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(l,o,p);
}}if(n&ak.e_aabbBit){l=this.m_contactManager.m_broadPhase;q=[new ad,new ad,new ad,new ad];for(u=this.m_bodyList;u;u=u.GetNext()){if(u.IsActive()!=false){for(o=u.GetFixtureList();
o;o=o.GetNext()){var k=l.GetFatAABB(o.m_proxy);q[0].Set(k.lowerBound.x,k.lowerBound.y);q[1].Set(k.upperBound.x,k.lowerBound.y);q[2].Set(k.upperBound.x,k.upperBound.y);
q[3].Set(k.lowerBound.x,k.upperBound.y);this.m_debugDraw.DrawPolygon(q,4,p);}}}}if(n&ak.e_centerOfMassBit){for(u=this.m_bodyList;u;u=u.m_next){q=aw.s_xf;
q.R=u.m_xf.R;q.position=u.GetWorldCenter();this.m_debugDraw.DrawTransform(q);}}}};aw.prototype.QueryAABB=function(k,n){var l=this.m_contactManager.m_broadPhase;
l.Query(function(o){return k(l.GetUserData(o));},n);};aw.prototype.QueryShape=function(l,p,n){if(n===g){n=null;}if(n==null){n=new ac;n.SetIdentity();}var k=this.m_contactManager.m_broadPhase,o=new t;
p.ComputeAABB(o,n);k.Query(function(q){q=k.GetUserData(q) instanceof v?k.GetUserData(q):null;if(m.TestOverlap(p,n,q.GetShape(),q.GetBody().GetTransform())){return l(q);
}return true;},o);};aw.prototype.QueryPoint=function(l,o){var n=this.m_contactManager.m_broadPhase,k=new t;k.lowerBound.Set(o.x-ao.b2_linearSlop,o.y-ao.b2_linearSlop);
k.upperBound.Set(o.x+ao.b2_linearSlop,o.y+ao.b2_linearSlop);n.Query(function(p){p=n.GetUserData(p) instanceof v?n.GetUserData(p):null;if(p.TestPoint(o)){return l(p);
}return true;},k);};aw.prototype.RayCast=function(l,q,n){var k=this.m_contactManager.m_broadPhase,p=new s,o=new C(q,n);k.RayCast(function(u,B){var A=k.GetUserData(B);
A=A instanceof v?A:null;if(A.RayCast(p,u)){var y=p.fraction,z=new ad((1-y)*q.x+y*n.x,(1-y)*q.y+y*n.y);return l(A,z,p.normal,y);}return u.maxFraction;},o);
};aw.prototype.RayCastOne=function(k,n){var l;this.RayCast(function(p,u,q,o){if(o===g){o=0;}l=p;return o;},k,n);return l;};aw.prototype.RayCastAll=function(k,n){var l=new b;
this.RayCast(function(o){l[l.length]=o;return 1;},k,n);return l;};aw.prototype.GetBodyList=function(){return this.m_bodyList;};aw.prototype.GetJointList=function(){return this.m_jointList;
};aw.prototype.GetContactList=function(){return this.m_contactList;};aw.prototype.IsLocked=function(){return(this.m_flags&aw.e_locked)>0;};aw.prototype.Solve=function(n){for(var y,p=this.m_controllerList;
p;p=p.m_next){p.Step(n);}p=this.m_island;p.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);
for(y=this.m_bodyList;y;y=y.m_next){y.m_flags&=~au.e_islandFlag;}for(var l=this.m_contactList;l;l=l.m_next){l.m_flags&=~at.e_islandFlag;}for(l=this.m_jointList;
l;l=l.m_next){l.m_islandFlag=false;}parseInt(this.m_bodyCount);l=this.s_stack;for(var u=this.m_bodyList;u;u=u.m_next){if(!(u.m_flags&au.e_islandFlag)){if(!(u.IsAwake()==false||u.IsActive()==false)){if(u.GetType()!=au.b2_staticBody){p.Clear();
var q=0;l[q++]=u;for(u.m_flags|=au.e_islandFlag;q>0;){y=l[--q];p.AddBody(y);y.IsAwake()==false&&y.SetAwake(true);if(y.GetType()!=au.b2_staticBody){for(var k,o=y.m_contactList;
o;o=o.next){if(!(o.contact.m_flags&at.e_islandFlag)){if(!(o.contact.IsSensor()==true||o.contact.IsEnabled()==false||o.contact.IsTouching()==false)){p.AddContact(o.contact);
o.contact.m_flags|=at.e_islandFlag;k=o.other;if(!(k.m_flags&au.e_islandFlag)){l[q++]=k;k.m_flags|=au.e_islandFlag;}}}}for(y=y.m_jointList;y;y=y.next){if(y.joint.m_islandFlag!=true){k=y.other;
if(k.IsActive()!=false){p.AddJoint(y.joint);y.joint.m_islandFlag=true;if(!(k.m_flags&au.e_islandFlag)){l[q++]=k;k.m_flags|=au.e_islandFlag;}}}}}}p.Solve(n,this.m_gravity,this.m_allowSleep);
for(q=0;q<p.m_bodyCount;++q){y=p.m_bodies[q];if(y.GetType()==au.b2_staticBody){y.m_flags&=~au.e_islandFlag;}}}}}}for(q=0;q<l.length;++q){if(!l[q]){break;
}l[q]=null;}for(y=this.m_bodyList;y;y=y.m_next){y.IsAwake()==false||y.IsActive()==false||y.GetType()!=au.b2_staticBody&&y.SynchronizeFixtures();}this.m_contactManager.FindNewContacts();
};aw.prototype.SolveTOI=function(y){var q,n,u,p=this.m_island;p.Initialize(this.m_bodyCount,ao.b2_maxTOIContactsPerIsland,ao.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);
var o=aw.s_queue;for(q=this.m_bodyList;q;q=q.m_next){q.m_flags&=~au.e_islandFlag;q.m_sweep.t0=0;}for(u=this.m_contactList;u;u=u.m_next){u.m_flags&=~(at.e_toiFlag|at.e_islandFlag);
}for(u=this.m_jointList;u;u=u.m_next){u.m_islandFlag=false;}for(;;){var l=null,k=1;for(u=this.m_contactList;u;u=u.m_next){if(!(u.IsSensor()==true||u.IsEnabled()==false||u.IsContinuous()==false)){q=1;
if(u.m_flags&at.e_toiFlag){q=u.m_toi;}else{q=u.m_fixtureA;n=u.m_fixtureB;q=q.m_body;n=n.m_body;if((q.GetType()!=au.b2_dynamicBody||q.IsAwake()==false)&&(n.GetType()!=au.b2_dynamicBody||n.IsAwake()==false)){continue;
}var z=q.m_sweep.t0;if(q.m_sweep.t0<n.m_sweep.t0){z=n.m_sweep.t0;q.m_sweep.Advance(z);}else{if(n.m_sweep.t0<q.m_sweep.t0){z=q.m_sweep.t0;n.m_sweep.Advance(z);
}}q=u.ComputeTOI(q.m_sweep,n.m_sweep);ao.b2Assert(0<=q&&q<=1);if(q>0&&q<1){q=(1-q)*z+q;if(q>1){q=1;}}u.m_toi=q;u.m_flags|=at.e_toiFlag;}if(Number.MIN_VALUE<q&&q<k){l=u;
k=q;}}}if(l==null||1-100*Number.MIN_VALUE<k){break;}q=l.m_fixtureA;n=l.m_fixtureB;q=q.m_body;n=n.m_body;aw.s_backupA.Set(q.m_sweep);aw.s_backupB.Set(n.m_sweep);
q.Advance(k);n.Advance(k);l.Update(this.m_contactManager.m_contactListener);l.m_flags&=~at.e_toiFlag;if(l.IsSensor()==true||l.IsEnabled()==false){q.m_sweep.Set(aw.s_backupA);
n.m_sweep.Set(aw.s_backupB);q.SynchronizeTransform();n.SynchronizeTransform();}else{if(l.IsTouching()!=false){q=q;if(q.GetType()!=au.b2_dynamicBody){q=n;
}p.Clear();l=u=0;o[u+l++]=q;for(q.m_flags|=au.e_islandFlag;l>0;){q=o[u++];--l;p.AddBody(q);q.IsAwake()==false&&q.SetAwake(true);if(q.GetType()==au.b2_dynamicBody){for(n=q.m_contactList;
n;n=n.next){if(p.m_contactCount==p.m_contactCapacity){break;}if(!(n.contact.m_flags&at.e_islandFlag)){if(!(n.contact.IsSensor()==true||n.contact.IsEnabled()==false||n.contact.IsTouching()==false)){p.AddContact(n.contact);
n.contact.m_flags|=at.e_islandFlag;z=n.other;if(!(z.m_flags&au.e_islandFlag)){if(z.GetType()!=au.b2_staticBody){z.Advance(k);z.SetAwake(true);}o[u+l]=z;
++l;z.m_flags|=au.e_islandFlag;}}}}for(q=q.m_jointList;q;q=q.next){if(p.m_jointCount!=p.m_jointCapacity){if(q.joint.m_islandFlag!=true){z=q.other;if(z.IsActive()!=false){p.AddJoint(q.joint);
q.joint.m_islandFlag=true;if(!(z.m_flags&au.e_islandFlag)){if(z.GetType()!=au.b2_staticBody){z.Advance(k);z.SetAwake(true);}o[u+l]=z;++l;z.m_flags|=au.e_islandFlag;
}}}}}}}u=aw.s_timestep;u.warmStarting=false;u.dt=(1-k)*y.dt;u.inv_dt=1/u.dt;u.dtRatio=0;u.velocityIterations=y.velocityIterations;u.positionIterations=y.positionIterations;
p.SolveTOI(u);for(k=k=0;k<p.m_bodyCount;++k){q=p.m_bodies[k];q.m_flags&=~au.e_islandFlag;if(q.IsAwake()!=false){if(q.GetType()==au.b2_dynamicBody){q.SynchronizeFixtures();
for(n=q.m_contactList;n;n=n.next){n.contact.m_flags&=~at.e_toiFlag;}}}}for(k=0;k<p.m_contactCount;++k){u=p.m_contacts[k];u.m_flags&=~(at.e_toiFlag|at.e_islandFlag);
}for(k=0;k<p.m_jointCount;++k){u=p.m_joints[k];u.m_islandFlag=false;}this.m_contactManager.FindNewContacts();}}}};aw.prototype.DrawJoint=function(n){var y=n.GetBodyA(),p=n.GetBodyB(),l=y.m_xf.position,u=p.m_xf.position,q=n.GetAnchorA(),k=n.GetAnchorB(),o=aw.s_jointColor;
switch(n.m_type){case am.e_distanceJoint:this.m_debugDraw.DrawSegment(q,k,o);break;case am.e_pulleyJoint:y=n instanceof ar?n:null;n=y.GetGroundAnchorA();
y=y.GetGroundAnchorB();this.m_debugDraw.DrawSegment(n,q,o);this.m_debugDraw.DrawSegment(y,k,o);this.m_debugDraw.DrawSegment(n,y,o);break;case am.e_mouseJoint:this.m_debugDraw.DrawSegment(q,k,o);
break;default:y!=this.m_groundBody&&this.m_debugDraw.DrawSegment(l,q,o);this.m_debugDraw.DrawSegment(q,k,o);p!=this.m_groundBody&&this.m_debugDraw.DrawSegment(u,k,o);
}};aw.prototype.DrawShape=function(l,q,n){switch(l.m_type){case m.e_circleShape:var k=l instanceof T?l:null;this.m_debugDraw.DrawSolidCircle(aj.MulX(q,k.m_p),k.m_radius,q.R.col1,n);
break;case m.e_polygonShape:k=0;k=l instanceof r?l:null;l=parseInt(k.GetVertexCount());var p=k.GetVertices(),o=new b(l);for(k=0;k<l;++k){o[k]=aj.MulX(q,p[k]);
}this.m_debugDraw.DrawSolidPolygon(o,l,n);break;case m.e_edgeShape:k=l instanceof X?l:null;this.m_debugDraw.DrawSegment(aj.MulX(q,k.GetVertex1()),aj.MulX(q,k.GetVertex2()),n);
}};j.postDefs.push(function(){j.Dynamics.b2World.s_timestep2=new ax;j.Dynamics.b2World.s_xf=new ac;j.Dynamics.b2World.s_backupA=new ah;j.Dynamics.b2World.s_backupB=new ah;
j.Dynamics.b2World.s_timestep=new ax;j.Dynamics.b2World.s_queue=new b;j.Dynamics.b2World.s_jointColor=new ag(0.5,0.8,0.8);j.Dynamics.b2World.e_newFixture=1;
j.Dynamics.b2World.e_locked=2;});})();(function(){var ag=j.Collision.Shapes.b2CircleShape,ae=j.Collision.Shapes.b2EdgeShape,T=j.Collision.Shapes.b2PolygonShape,X=j.Collision.Shapes.b2Shape,ad=j.Dynamics.Contacts.b2CircleContact,ak=j.Dynamics.Contacts.b2Contact,q=j.Dynamics.Contacts.b2ContactConstraint,al=j.Dynamics.Contacts.b2ContactConstraintPoint,aj=j.Dynamics.Contacts.b2ContactEdge,t=j.Dynamics.Contacts.b2ContactFactory,o=j.Dynamics.Contacts.b2ContactRegister,C=j.Dynamics.Contacts.b2ContactResult,J=j.Dynamics.Contacts.b2ContactSolver,ab=j.Dynamics.Contacts.b2EdgeAndCircleContact,n=j.Dynamics.Contacts.b2NullContact,m=j.Dynamics.Contacts.b2PolyAndCircleContact,an=j.Dynamics.Contacts.b2PolyAndEdgeContact,P=j.Dynamics.Contacts.b2PolygonContact,af=j.Dynamics.Contacts.b2PositionSolverManifold,ai=j.Dynamics.b2Body,ac=j.Dynamics.b2TimeStep,v=j.Common.b2Settings,ah=j.Common.Math.b2Mat22,s=j.Common.Math.b2Math,x=j.Common.Math.b2Vec2,r=j.Collision.b2Collision,aq=j.Collision.b2ContactID,i=j.Collision.b2Manifold,ap=j.Collision.b2TimeOfImpact,ao=j.Collision.b2TOIInput,am=j.Collision.b2WorldManifold;
j.inherit(ad,j.Dynamics.Contacts.b2Contact);ad.prototype.__super=j.Dynamics.Contacts.b2Contact.prototype;ad.b2CircleContact=function(){j.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments);
};ad.Create=function(){return new ad;};ad.Destroy=function(){};ad.prototype.Reset=function(k,l){this.__super.Reset.call(this,k,l);};ad.prototype.Evaluate=function(){var k=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody();
r.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape() instanceof ag?this.m_fixtureA.GetShape():null,k.m_xf,this.m_fixtureB.GetShape() instanceof ag?this.m_fixtureB.GetShape():null,l.m_xf);
};ak.b2Contact=function(){this.m_nodeA=new aj;this.m_nodeB=new aj;this.m_manifold=new i;this.m_oldManifold=new i;};ak.prototype.GetManifold=function(){return this.m_manifold;
};ak.prototype.GetWorldManifold=function(l){var u=this.m_fixtureA.GetBody(),p=this.m_fixtureB.GetBody(),y=this.m_fixtureA.GetShape(),k=this.m_fixtureB.GetShape();
l.Initialize(this.m_manifold,u.GetTransform(),y.m_radius,p.GetTransform(),k.m_radius);};ak.prototype.IsTouching=function(){return(this.m_flags&ak.e_touchingFlag)==ak.e_touchingFlag;
};ak.prototype.IsContinuous=function(){return(this.m_flags&ak.e_continuousFlag)==ak.e_continuousFlag;};ak.prototype.SetSensor=function(k){if(k){this.m_flags|=ak.e_sensorFlag;
}else{this.m_flags&=~ak.e_sensorFlag;}};ak.prototype.IsSensor=function(){return(this.m_flags&ak.e_sensorFlag)==ak.e_sensorFlag;};ak.prototype.SetEnabled=function(k){if(k){this.m_flags|=ak.e_enabledFlag;
}else{this.m_flags&=~ak.e_enabledFlag;}};ak.prototype.IsEnabled=function(){return(this.m_flags&ak.e_enabledFlag)==ak.e_enabledFlag;};ak.prototype.GetNext=function(){return this.m_next;
};ak.prototype.GetFixtureA=function(){return this.m_fixtureA;};ak.prototype.GetFixtureB=function(){return this.m_fixtureB;};ak.prototype.FlagForFiltering=function(){this.m_flags|=ak.e_filterFlag;
};ak.prototype.b2Contact=function(){};ak.prototype.Reset=function(k,p){if(k===g){k=null;}if(p===g){p=null;}this.m_flags=ak.e_enabledFlag;if(!k||!p){this.m_fixtureB=this.m_fixtureA=null;
}else{if(k.IsSensor()||p.IsSensor()){this.m_flags|=ak.e_sensorFlag;}var l=k.GetBody(),u=p.GetBody();if(l.GetType()!=ai.b2_dynamicBody||l.IsBullet()||u.GetType()!=ai.b2_dynamicBody||u.IsBullet()){this.m_flags|=ak.e_continuousFlag;
}this.m_fixtureA=k;this.m_fixtureB=p;this.m_manifold.m_pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;
this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null;}};ak.prototype.Update=function(u){var l=this.m_oldManifold;
this.m_oldManifold=this.m_manifold;this.m_manifold=l;this.m_flags|=ak.e_enabledFlag;var k=false;l=(this.m_flags&ak.e_touchingFlag)==ak.e_touchingFlag;var p=this.m_fixtureA.m_body,E=this.m_fixtureB.m_body,B=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);
if(this.m_flags&ak.e_sensorFlag){if(B){k=this.m_fixtureA.GetShape();B=this.m_fixtureB.GetShape();p=p.GetTransform();E=E.GetTransform();k=X.TestOverlap(k,p,B,E);
}this.m_manifold.m_pointCount=0;}else{if(p.GetType()!=ai.b2_dynamicBody||p.IsBullet()||E.GetType()!=ai.b2_dynamicBody||E.IsBullet()){this.m_flags|=ak.e_continuousFlag;
}else{this.m_flags&=~ak.e_continuousFlag;}if(B){this.Evaluate();k=this.m_manifold.m_pointCount>0;for(B=0;B<this.m_manifold.m_pointCount;++B){var y=this.m_manifold.m_points[B];
y.m_normalImpulse=0;y.m_tangentImpulse=0;for(var D=y.m_id,A=0;A<this.m_oldManifold.m_pointCount;++A){var z=this.m_oldManifold.m_points[A];if(z.m_id.key==D.key){y.m_normalImpulse=z.m_normalImpulse;
y.m_tangentImpulse=z.m_tangentImpulse;break;}}}}else{this.m_manifold.m_pointCount=0;}if(k!=l){p.SetAwake(true);E.SetAwake(true);}}if(k){this.m_flags|=ak.e_touchingFlag;
}else{this.m_flags&=~ak.e_touchingFlag;}l==false&&k==true&&u.BeginContact(this);l==true&&k==false&&u.EndContact(this);(this.m_flags&ak.e_sensorFlag)==0&&u.PreSolve(this,this.m_oldManifold);
};ak.prototype.Evaluate=function(){};ak.prototype.ComputeTOI=function(k,l){ak.s_input.proxyA.Set(this.m_fixtureA.GetShape());ak.s_input.proxyB.Set(this.m_fixtureB.GetShape());
ak.s_input.sweepA=k;ak.s_input.sweepB=l;ak.s_input.tolerance=v.b2_linearSlop;return ap.TimeOfImpact(ak.s_input);};j.postDefs.push(function(){j.Dynamics.Contacts.b2Contact.e_sensorFlag=1;
j.Dynamics.Contacts.b2Contact.e_continuousFlag=2;j.Dynamics.Contacts.b2Contact.e_islandFlag=4;j.Dynamics.Contacts.b2Contact.e_toiFlag=8;j.Dynamics.Contacts.b2Contact.e_touchingFlag=16;
j.Dynamics.Contacts.b2Contact.e_enabledFlag=32;j.Dynamics.Contacts.b2Contact.e_filterFlag=64;j.Dynamics.Contacts.b2Contact.s_input=new ao;});q.b2ContactConstraint=function(){this.localPlaneNormal=new x;
this.localPoint=new x;this.normal=new x;this.normalMass=new ah;this.K=new ah;};q.prototype.b2ContactConstraint=function(){this.points=new b(v.b2_maxManifoldPoints);
for(var k=0;k<v.b2_maxManifoldPoints;k++){this.points[k]=new al;}};al.b2ContactConstraintPoint=function(){this.localPoint=new x;this.rA=new x;this.rB=new x;
};aj.b2ContactEdge=function(){};t.b2ContactFactory=function(){};t.prototype.b2ContactFactory=function(k){this.m_allocator=k;this.InitializeRegisters();
};t.prototype.AddType=function(k,p,l,u){if(l===g){l=0;}if(u===g){u=0;}this.m_registers[l][u].createFcn=k;this.m_registers[l][u].destroyFcn=p;this.m_registers[l][u].primary=true;
if(l!=u){this.m_registers[u][l].createFcn=k;this.m_registers[u][l].destroyFcn=p;this.m_registers[u][l].primary=false;}};t.prototype.InitializeRegisters=function(){this.m_registers=new b(X.e_shapeTypeCount);
for(var k=0;k<X.e_shapeTypeCount;k++){this.m_registers[k]=new b(X.e_shapeTypeCount);for(var l=0;l<X.e_shapeTypeCount;l++){this.m_registers[k][l]=new o;
}}this.AddType(ad.Create,ad.Destroy,X.e_circleShape,X.e_circleShape);this.AddType(m.Create,m.Destroy,X.e_polygonShape,X.e_circleShape);this.AddType(P.Create,P.Destroy,X.e_polygonShape,X.e_polygonShape);
this.AddType(ab.Create,ab.Destroy,X.e_edgeShape,X.e_circleShape);this.AddType(an.Create,an.Destroy,X.e_polygonShape,X.e_edgeShape);};t.prototype.Create=function(k,p){var l=parseInt(k.GetType()),u=parseInt(p.GetType());
l=this.m_registers[l][u];if(l.pool){u=l.pool;l.pool=u.m_next;l.poolCount--;u.Reset(k,p);return u;}u=l.createFcn;if(u!=null){if(l.primary){u=u(this.m_allocator);
u.Reset(k,p);}else{u=u(this.m_allocator);u.Reset(p,k);}return u;}else{return null;}};t.prototype.Destroy=function(k){if(k.m_manifold.m_pointCount>0){k.m_fixtureA.m_body.SetAwake(true);
k.m_fixtureB.m_body.SetAwake(true);}var p=parseInt(k.m_fixtureA.GetType()),l=parseInt(k.m_fixtureB.GetType());p=this.m_registers[p][l];p.poolCount++;k.m_next=p.pool;
p.pool=k;p=p.destroyFcn;p(k,this.m_allocator);};o.b2ContactRegister=function(){};C.b2ContactResult=function(){this.position=new x;this.normal=new x;this.id=new aq;
};J.b2ContactSolver=function(){this.m_step=new ac;this.m_constraints=new b;};J.prototype.b2ContactSolver=function(){};J.prototype.Initialize=function(N,K,H,L){if(H===g){H=0;
}var V;this.m_step.Set(N);this.m_allocator=L;N=0;for(this.m_constraintCount=H;this.m_constraints.length<this.m_constraintCount;){this.m_constraints[this.m_constraints.length]=new q;
}for(N=0;N<H;++N){V=K[N];L=V.m_fixtureA;var S=V.m_fixtureB,O=L.m_shape.m_radius,U=S.m_shape.m_radius,R=L.m_body,Q=S.m_body,M=V.GetManifold(),G=v.b2MixFriction(L.GetFriction(),S.GetFriction()),E=v.b2MixRestitution(L.GetRestitution(),S.GetRestitution()),B=R.m_linearVelocity.x,D=R.m_linearVelocity.y,A=Q.m_linearVelocity.x,F=Q.m_linearVelocity.y,z=R.m_angularVelocity,l=Q.m_angularVelocity;
v.b2Assert(M.m_pointCount>0);J.s_worldManifold.Initialize(M,R.m_xf,O,Q.m_xf,U);S=J.s_worldManifold.m_normal.x;V=J.s_worldManifold.m_normal.y;L=this.m_constraints[N];
L.bodyA=R;L.bodyB=Q;L.manifold=M;L.normal.x=S;L.normal.y=V;L.pointCount=M.m_pointCount;L.friction=G;L.restitution=E;L.localPlaneNormal.x=M.m_localPlaneNormal.x;
L.localPlaneNormal.y=M.m_localPlaneNormal.y;L.localPoint.x=M.m_localPoint.x;L.localPoint.y=M.m_localPoint.y;L.radius=O+U;L.type=M.m_type;for(O=0;O<L.pointCount;
++O){G=M.m_points[O];U=L.points[O];U.normalImpulse=G.m_normalImpulse;U.tangentImpulse=G.m_tangentImpulse;U.localPoint.SetV(G.m_localPoint);G=U.rA.x=J.s_worldManifold.m_points[O].x-R.m_sweep.c.x;
E=U.rA.y=J.s_worldManifold.m_points[O].y-R.m_sweep.c.y;var y=U.rB.x=J.s_worldManifold.m_points[O].x-Q.m_sweep.c.x,k=U.rB.y=J.s_worldManifold.m_points[O].y-Q.m_sweep.c.y,p=G*V-E*S,u=y*V-k*S;
p*=p;u*=u;U.normalMass=1/(R.m_invMass+Q.m_invMass+R.m_invI*p+Q.m_invI*u);var I=R.m_mass*R.m_invMass+Q.m_mass*Q.m_invMass;I+=R.m_mass*R.m_invI*p+Q.m_mass*Q.m_invI*u;
U.equalizedMass=1/I;u=V;I=-S;p=G*I-E*u;u=y*I-k*u;p*=p;u*=u;U.tangentMass=1/(R.m_invMass+Q.m_invMass+R.m_invI*p+Q.m_invI*u);U.velocityBias=0;G=L.normal.x*(A+-l*k-B- -z*E)+L.normal.y*(F+l*y-D-z*G);
if(G<-v.b2_velocityThreshold){U.velocityBias+=-L.restitution*G;}}if(L.pointCount==2){F=L.points[0];A=L.points[1];M=R.m_invMass;R=R.m_invI;B=Q.m_invMass;
Q=Q.m_invI;D=F.rA.x*V-F.rA.y*S;F=F.rB.x*V-F.rB.y*S;z=A.rA.x*V-A.rA.y*S;A=A.rB.x*V-A.rB.y*S;S=M+B+R*D*D+Q*F*F;V=M+B+R*z*z+Q*A*A;Q=M+B+R*D*z+Q*F*A;if(S*S<100*(S*V-Q*Q)){L.K.col1.Set(S,Q);
L.K.col2.Set(Q,V);L.K.GetInverse(L.normalMass);}else{L.pointCount=1;}}}};J.prototype.InitVelocityConstraints=function(G){for(var D=0;D<this.m_constraintCount;
++D){var B=this.m_constraints[D],E=B.bodyA,N=B.bodyB,L=E.m_invMass,H=E.m_invI,M=N.m_invMass,K=N.m_invI,I=B.normal.x,F=B.normal.y,A=F,y=-I,p=0,u=0;if(G.warmStarting){u=B.pointCount;
for(p=0;p<u;++p){var l=B.points[p];l.normalImpulse*=G.dtRatio;l.tangentImpulse*=G.dtRatio;var z=l.normalImpulse*I+l.tangentImpulse*A,k=l.normalImpulse*F+l.tangentImpulse*y;
E.m_angularVelocity-=H*(l.rA.x*k-l.rA.y*z);E.m_linearVelocity.x-=L*z;E.m_linearVelocity.y-=L*k;N.m_angularVelocity+=K*(l.rB.x*k-l.rB.y*z);N.m_linearVelocity.x+=M*z;
N.m_linearVelocity.y+=M*k;}}else{u=B.pointCount;for(p=0;p<u;++p){E=B.points[p];E.normalImpulse=0;E.tangentImpulse=0;}}}};J.prototype.SolveVelocityConstraints=function(){for(var N=0,K,H=0,L=0,V=0,S=L=L=H=H=0,O=H=H=0,U=H=V=0,R=0,Q,M=0;
M<this.m_constraintCount;++M){V=this.m_constraints[M];var G=V.bodyA,E=V.bodyB,B=G.m_angularVelocity,D=E.m_angularVelocity,A=G.m_linearVelocity,F=E.m_linearVelocity,z=G.m_invMass,l=G.m_invI,y=E.m_invMass,k=E.m_invI;
U=V.normal.x;var p=R=V.normal.y;Q=-U;O=V.friction;for(N=0;N<V.pointCount;N++){K=V.points[N];H=F.x-D*K.rB.y-A.x+B*K.rA.y;L=F.y+D*K.rB.x-A.y-B*K.rA.x;H=H*p+L*Q;
H=K.tangentMass*-H;L=O*K.normalImpulse;L=s.Clamp(K.tangentImpulse+H,-L,L);H=L-K.tangentImpulse;S=H*p;H=H*Q;A.x-=z*S;A.y-=z*H;B-=l*(K.rA.x*H-K.rA.y*S);F.x+=y*S;
F.y+=y*H;D+=k*(K.rB.x*H-K.rB.y*S);K.tangentImpulse=L;}parseInt(V.pointCount);if(V.pointCount==1){K=V.points[0];H=F.x+-D*K.rB.y-A.x- -B*K.rA.y;L=F.y+D*K.rB.x-A.y-B*K.rA.x;
V=H*U+L*R;H=-K.normalMass*(V-K.velocityBias);L=K.normalImpulse+H;L=L>0?L:0;H=L-K.normalImpulse;S=H*U;H=H*R;A.x-=z*S;A.y-=z*H;B-=l*(K.rA.x*H-K.rA.y*S);F.x+=y*S;
F.y+=y*H;D+=k*(K.rB.x*H-K.rB.y*S);K.normalImpulse=L;}else{K=V.points[0];N=V.points[1];H=K.normalImpulse;O=N.normalImpulse;var u=(F.x-D*K.rB.y-A.x+B*K.rA.y)*U+(F.y+D*K.rB.x-A.y-B*K.rA.x)*R,I=(F.x-D*N.rB.y-A.x+B*N.rA.y)*U+(F.y+D*N.rB.x-A.y-B*N.rA.x)*R;
L=u-K.velocityBias;S=I-N.velocityBias;Q=V.K;L-=Q.col1.x*H+Q.col2.x*O;for(S-=Q.col1.y*H+Q.col2.y*O;;){Q=V.normalMass;p=-(Q.col1.x*L+Q.col2.x*S);Q=-(Q.col1.y*L+Q.col2.y*S);
if(p>=0&&Q>=0){H=p-H;O=Q-O;V=H*U;H=H*R;U=O*U;R=O*R;A.x-=z*(V+U);A.y-=z*(H+R);B-=l*(K.rA.x*H-K.rA.y*V+N.rA.x*R-N.rA.y*U);F.x+=y*(V+U);F.y+=y*(H+R);D+=k*(K.rB.x*H-K.rB.y*V+N.rB.x*R-N.rB.y*U);
K.normalImpulse=p;N.normalImpulse=Q;break;}p=-K.normalMass*L;Q=0;I=V.K.col1.y*p+S;if(p>=0&&I>=0){H=p-H;O=Q-O;V=H*U;H=H*R;U=O*U;R=O*R;A.x-=z*(V+U);A.y-=z*(H+R);
B-=l*(K.rA.x*H-K.rA.y*V+N.rA.x*R-N.rA.y*U);F.x+=y*(V+U);F.y+=y*(H+R);D+=k*(K.rB.x*H-K.rB.y*V+N.rB.x*R-N.rB.y*U);K.normalImpulse=p;N.normalImpulse=Q;break;
}p=0;Q=-N.normalMass*S;u=V.K.col2.x*Q+L;if(Q>=0&&u>=0){H=p-H;O=Q-O;V=H*U;H=H*R;U=O*U;R=O*R;A.x-=z*(V+U);A.y-=z*(H+R);B-=l*(K.rA.x*H-K.rA.y*V+N.rA.x*R-N.rA.y*U);
F.x+=y*(V+U);F.y+=y*(H+R);D+=k*(K.rB.x*H-K.rB.y*V+N.rB.x*R-N.rB.y*U);K.normalImpulse=p;N.normalImpulse=Q;break;}Q=p=0;u=L;I=S;if(u>=0&&I>=0){H=p-H;O=Q-O;
V=H*U;H=H*R;U=O*U;R=O*R;A.x-=z*(V+U);A.y-=z*(H+R);B-=l*(K.rA.x*H-K.rA.y*V+N.rA.x*R-N.rA.y*U);F.x+=y*(V+U);F.y+=y*(H+R);D+=k*(K.rB.x*H-K.rB.y*V+N.rB.x*R-N.rB.y*U);
K.normalImpulse=p;N.normalImpulse=Q;break;}break;}}G.m_angularVelocity=B;E.m_angularVelocity=D;}};J.prototype.FinalizeVelocityConstraints=function(){for(var l=0;
l<this.m_constraintCount;++l){for(var u=this.m_constraints[l],p=u.manifold,z=0;z<u.pointCount;++z){var k=p.m_points[z],y=u.points[z];k.m_normalImpulse=y.normalImpulse;
k.m_tangentImpulse=y.tangentImpulse;}}};J.prototype.SolvePositionConstraints=function(G){if(G===g){G=0;}for(var D=0,B=0;B<this.m_constraintCount;B++){var E=this.m_constraints[B],N=E.bodyA,L=E.bodyB,H=N.m_mass*N.m_invMass,M=N.m_mass*N.m_invI,K=L.m_mass*L.m_invMass,I=L.m_mass*L.m_invI;
J.s_psm.Initialize(E);for(var F=J.s_psm.m_normal,A=0;A<E.pointCount;A++){var y=E.points[A],p=J.s_psm.m_points[A],u=J.s_psm.m_separations[A],l=p.x-N.m_sweep.c.x,z=p.y-N.m_sweep.c.y,k=p.x-L.m_sweep.c.x;
p=p.y-L.m_sweep.c.y;D=D<u?D:u;u=s.Clamp(G*(u+v.b2_linearSlop),-v.b2_maxLinearCorrection,0);u=-y.equalizedMass*u;y=u*F.x;u=u*F.y;N.m_sweep.c.x-=H*y;N.m_sweep.c.y-=H*u;
N.m_sweep.a-=M*(l*u-z*y);N.SynchronizeTransform();L.m_sweep.c.x+=K*y;L.m_sweep.c.y+=K*u;L.m_sweep.a+=I*(k*u-p*y);L.SynchronizeTransform();}}return D>-1.5*v.b2_linearSlop;
};j.postDefs.push(function(){j.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new am;j.Dynamics.Contacts.b2ContactSolver.s_psm=new af;});j.inherit(ab,j.Dynamics.Contacts.b2Contact);
ab.prototype.__super=j.Dynamics.Contacts.b2Contact.prototype;ab.b2EdgeAndCircleContact=function(){j.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments);
};ab.Create=function(){return new ab;};ab.Destroy=function(){};ab.prototype.Reset=function(k,l){this.__super.Reset.call(this,k,l);};ab.prototype.Evaluate=function(){var k=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody();
this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape() instanceof ae?this.m_fixtureA.GetShape():null,k.m_xf,this.m_fixtureB.GetShape() instanceof ag?this.m_fixtureB.GetShape():null,l.m_xf);
};ab.prototype.b2CollideEdgeAndCircle=function(){};j.inherit(n,j.Dynamics.Contacts.b2Contact);n.prototype.__super=j.Dynamics.Contacts.b2Contact.prototype;
n.b2NullContact=function(){j.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments);};n.prototype.b2NullContact=function(){this.__super.b2Contact.call(this);
};n.prototype.Evaluate=function(){};j.inherit(m,j.Dynamics.Contacts.b2Contact);m.prototype.__super=j.Dynamics.Contacts.b2Contact.prototype;m.b2PolyAndCircleContact=function(){j.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments);
};m.Create=function(){return new m;};m.Destroy=function(){};m.prototype.Reset=function(k,l){this.__super.Reset.call(this,k,l);v.b2Assert(k.GetType()==X.e_polygonShape);
v.b2Assert(l.GetType()==X.e_circleShape);};m.prototype.Evaluate=function(){var k=this.m_fixtureA.m_body,l=this.m_fixtureB.m_body;r.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape() instanceof T?this.m_fixtureA.GetShape():null,k.m_xf,this.m_fixtureB.GetShape() instanceof ag?this.m_fixtureB.GetShape():null,l.m_xf);
};j.inherit(an,j.Dynamics.Contacts.b2Contact);an.prototype.__super=j.Dynamics.Contacts.b2Contact.prototype;an.b2PolyAndEdgeContact=function(){j.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments);
};an.Create=function(){return new an;};an.Destroy=function(){};an.prototype.Reset=function(k,l){this.__super.Reset.call(this,k,l);v.b2Assert(k.GetType()==X.e_polygonShape);
v.b2Assert(l.GetType()==X.e_edgeShape);};an.prototype.Evaluate=function(){var k=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape() instanceof T?this.m_fixtureA.GetShape():null,k.m_xf,this.m_fixtureB.GetShape() instanceof ae?this.m_fixtureB.GetShape():null,l.m_xf);
};an.prototype.b2CollidePolyAndEdge=function(){};j.inherit(P,j.Dynamics.Contacts.b2Contact);P.prototype.__super=j.Dynamics.Contacts.b2Contact.prototype;
P.b2PolygonContact=function(){j.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments);};P.Create=function(){return new P;};P.Destroy=function(){};
P.prototype.Reset=function(k,l){this.__super.Reset.call(this,k,l);};P.prototype.Evaluate=function(){var k=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody();
r.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape() instanceof T?this.m_fixtureA.GetShape():null,k.m_xf,this.m_fixtureB.GetShape() instanceof T?this.m_fixtureB.GetShape():null,l.m_xf);
};af.b2PositionSolverManifold=function(){};af.prototype.b2PositionSolverManifold=function(){this.m_normal=new x;this.m_separations=new a(v.b2_maxManifoldPoints);
this.m_points=new b(v.b2_maxManifoldPoints);for(var k=0;k<v.b2_maxManifoldPoints;k++){this.m_points[k]=new x;}};af.prototype.Initialize=function(p){v.b2Assert(p.pointCount>0);
var z=0,y=0,B=0,l,A=0,u=0;switch(p.type){case i.e_circles:l=p.bodyA.m_xf.R;B=p.localPoint;z=p.bodyA.m_xf.position.x+(l.col1.x*B.x+l.col2.x*B.y);y=p.bodyA.m_xf.position.y+(l.col1.y*B.x+l.col2.y*B.y);
l=p.bodyB.m_xf.R;B=p.points[0].localPoint;A=p.bodyB.m_xf.position.x+(l.col1.x*B.x+l.col2.x*B.y);l=p.bodyB.m_xf.position.y+(l.col1.y*B.x+l.col2.y*B.y);B=A-z;
u=l-y;var k=B*B+u*u;if(k>Number.MIN_VALUE*Number.MIN_VALUE){k=Math.sqrt(k);this.m_normal.x=B/k;this.m_normal.y=u/k;}else{this.m_normal.x=1;this.m_normal.y=0;
}this.m_points[0].x=0.5*(z+A);this.m_points[0].y=0.5*(y+l);this.m_separations[0]=B*this.m_normal.x+u*this.m_normal.y-p.radius;break;case i.e_faceA:l=p.bodyA.m_xf.R;
B=p.localPlaneNormal;this.m_normal.x=l.col1.x*B.x+l.col2.x*B.y;this.m_normal.y=l.col1.y*B.x+l.col2.y*B.y;l=p.bodyA.m_xf.R;B=p.localPoint;A=p.bodyA.m_xf.position.x+(l.col1.x*B.x+l.col2.x*B.y);
u=p.bodyA.m_xf.position.y+(l.col1.y*B.x+l.col2.y*B.y);l=p.bodyB.m_xf.R;for(z=0;z<p.pointCount;++z){B=p.points[z].localPoint;y=p.bodyB.m_xf.position.x+(l.col1.x*B.x+l.col2.x*B.y);
B=p.bodyB.m_xf.position.y+(l.col1.y*B.x+l.col2.y*B.y);this.m_separations[z]=(y-A)*this.m_normal.x+(B-u)*this.m_normal.y-p.radius;this.m_points[z].x=y;this.m_points[z].y=B;
}break;case i.e_faceB:l=p.bodyB.m_xf.R;B=p.localPlaneNormal;this.m_normal.x=l.col1.x*B.x+l.col2.x*B.y;this.m_normal.y=l.col1.y*B.x+l.col2.y*B.y;l=p.bodyB.m_xf.R;
B=p.localPoint;A=p.bodyB.m_xf.position.x+(l.col1.x*B.x+l.col2.x*B.y);u=p.bodyB.m_xf.position.y+(l.col1.y*B.x+l.col2.y*B.y);l=p.bodyA.m_xf.R;for(z=0;z<p.pointCount;
++z){B=p.points[z].localPoint;y=p.bodyA.m_xf.position.x+(l.col1.x*B.x+l.col2.x*B.y);B=p.bodyA.m_xf.position.y+(l.col1.y*B.x+l.col2.y*B.y);this.m_separations[z]=(y-A)*this.m_normal.x+(B-u)*this.m_normal.y-p.radius;
this.m_points[z].Set(y,B);}this.m_normal.x*=-1;this.m_normal.y*=-1;}};j.postDefs.push(function(){j.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new x;
j.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new x;});})();(function(){var u=j.Common.Math.b2Mat22,t=j.Common.Math.b2Math,r=j.Common.Math.b2Vec2,q=j.Common.b2Color,s=j.Dynamics.Controllers.b2BuoyancyController,l=j.Dynamics.Controllers.b2ConstantAccelController,n=j.Dynamics.Controllers.b2ConstantForceController,k=j.Dynamics.Controllers.b2Controller,i=j.Dynamics.Controllers.b2ControllerEdge,o=j.Dynamics.Controllers.b2GravityController,m=j.Dynamics.Controllers.b2TensorDampingController;
j.inherit(s,j.Dynamics.Controllers.b2Controller);s.prototype.__super=j.Dynamics.Controllers.b2Controller.prototype;s.b2BuoyancyController=function(){j.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);
this.normal=new r(0,-1);this.density=this.offset=0;this.velocity=new r(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=false;this.useWorldGravity=true;
this.gravity=null;};s.prototype.Step=function(){if(this.m_bodyList){if(this.useWorldGravity){this.gravity=this.GetWorld().GetGravity().Copy();}for(var A=this.m_bodyList;
A;A=A.nextBody){var C=A.body;if(C.IsAwake()!=false){for(var E=new r,x=new r,v=0,y=0,B=C.GetFixtureList();B;B=B.GetNext()){var G=new r,p=B.GetShape().ComputeSubmergedArea(this.normal,this.offset,C.GetTransform(),G);
v+=p;E.x+=p*G.x;E.y+=p*G.y;var F=0;F=1;y+=p*F;x.x+=p*G.x*F;x.y+=p*G.y*F;}E.x/=v;E.y/=v;x.x/=y;x.y/=y;if(!(v<Number.MIN_VALUE)){y=this.gravity.GetNegative();
y.Multiply(this.density*v);C.ApplyForce(y,x);x=C.GetLinearVelocityFromWorldPoint(E);x.Subtract(this.velocity);x.Multiply(-this.linearDrag*v);C.ApplyForce(x,E);
C.ApplyTorque(-C.GetInertia()/C.GetMass()*v*C.GetAngularVelocity()*this.angularDrag);}}}}};s.prototype.Draw=function(y){var v=new r,x=new r;v.x=this.normal.x*this.offset+this.normal.y*1000;
v.y=this.normal.y*this.offset-this.normal.x*1000;x.x=this.normal.x*this.offset-this.normal.y*1000;x.y=this.normal.y*this.offset+this.normal.x*1000;var p=new q(0,0,1);
y.DrawSegment(v,x,p);};j.inherit(l,j.Dynamics.Controllers.b2Controller);l.prototype.__super=j.Dynamics.Controllers.b2Controller.prototype;l.b2ConstantAccelController=function(){j.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);
this.A=new r(0,0);};l.prototype.Step=function(x){x=new r(this.A.x*x.dt,this.A.y*x.dt);for(var p=this.m_bodyList;p;p=p.nextBody){var v=p.body;v.IsAwake()&&v.SetLinearVelocity(new r(v.GetLinearVelocity().x+x.x,v.GetLinearVelocity().y+x.y));
}};j.inherit(n,j.Dynamics.Controllers.b2Controller);n.prototype.__super=j.Dynamics.Controllers.b2Controller.prototype;n.b2ConstantForceController=function(){j.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);
this.F=new r(0,0);};n.prototype.Step=function(){for(var v=this.m_bodyList;v;v=v.nextBody){var p=v.body;p.IsAwake()&&p.ApplyForce(this.F,p.GetWorldCenter());
}};k.b2Controller=function(){};k.prototype.Step=function(){};k.prototype.Draw=function(){};k.prototype.AddBody=function(v){var p=new i;p.controller=this;
p.body=v;p.nextBody=this.m_bodyList;p.prevBody=null;this.m_bodyList=p;if(p.nextBody){p.nextBody.prevBody=p;}this.m_bodyCount++;p.nextController=v.m_controllerList;
p.prevController=null;v.m_controllerList=p;if(p.nextController){p.nextController.prevController=p;}v.m_controllerCount++;};k.prototype.RemoveBody=function(v){for(var p=v.m_controllerList;
p&&p.controller!=this;){p=p.nextController;}if(p.prevBody){p.prevBody.nextBody=p.nextBody;}if(p.nextBody){p.nextBody.prevBody=p.prevBody;}if(p.nextController){p.nextController.prevController=p.prevController;
}if(p.prevController){p.prevController.nextController=p.nextController;}if(this.m_bodyList==p){this.m_bodyList=p.nextBody;}if(v.m_controllerList==p){v.m_controllerList=p.nextController;
}v.m_controllerCount--;this.m_bodyCount--;};k.prototype.Clear=function(){for(;this.m_bodyList;){this.RemoveBody(this.m_bodyList.body);}};k.prototype.GetNext=function(){return this.m_next;
};k.prototype.GetWorld=function(){return this.m_world;};k.prototype.GetBodyList=function(){return this.m_bodyList;};i.b2ControllerEdge=function(){};j.inherit(o,j.Dynamics.Controllers.b2Controller);
o.prototype.__super=j.Dynamics.Controllers.b2Controller.prototype;o.b2GravityController=function(){j.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);
this.G=1;this.invSqr=true;};o.prototype.Step=function(){var A=null,C=null,E=null,x=0,v=null,y=null,B=null,G=0,p=0,F=0;G=null;if(this.invSqr){for(A=this.m_bodyList;
A;A=A.nextBody){C=A.body;E=C.GetWorldCenter();x=C.GetMass();for(v=this.m_bodyList;v!=A;v=v.nextBody){y=v.body;B=y.GetWorldCenter();G=B.x-E.x;p=B.y-E.y;
F=G*G+p*p;if(!(F<Number.MIN_VALUE)){G=new r(G,p);G.Multiply(this.G/F/Math.sqrt(F)*x*y.GetMass());C.IsAwake()&&C.ApplyForce(G,E);G.Multiply(-1);y.IsAwake()&&y.ApplyForce(G,B);
}}}}else{for(A=this.m_bodyList;A;A=A.nextBody){C=A.body;E=C.GetWorldCenter();x=C.GetMass();for(v=this.m_bodyList;v!=A;v=v.nextBody){y=v.body;B=y.GetWorldCenter();
G=B.x-E.x;p=B.y-E.y;F=G*G+p*p;if(!(F<Number.MIN_VALUE)){G=new r(G,p);G.Multiply(this.G/F*x*y.GetMass());C.IsAwake()&&C.ApplyForce(G,E);G.Multiply(-1);y.IsAwake()&&y.ApplyForce(G,B);
}}}}};j.inherit(m,j.Dynamics.Controllers.b2Controller);m.prototype.__super=j.Dynamics.Controllers.b2Controller.prototype;m.b2TensorDampingController=function(){j.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);
this.T=new u;this.maxTimestep=0;};m.prototype.SetAxisAligned=function(v,p){if(v===g){v=0;}if(p===g){p=0;}this.T.col1.x=-v;this.T.col1.y=0;this.T.col2.x=0;
this.T.col2.y=-p;this.maxTimestep=v>0||p>0?1/Math.max(v,p):0;};m.prototype.Step=function(y){y=y.dt;if(!(y<=Number.MIN_VALUE)){if(y>this.maxTimestep&&this.maxTimestep>0){y=this.maxTimestep;
}for(var v=this.m_bodyList;v;v=v.nextBody){var x=v.body;if(x.IsAwake()){var p=x.GetWorldVector(t.MulMV(this.T,x.GetLocalVector(x.GetLinearVelocity())));
x.SetLinearVelocity(new r(x.GetLinearVelocity().x+p.x*y,x.GetLinearVelocity().y+p.y*y));}}}};})();(function(){var af=j.Common.b2Settings,ad=j.Common.Math.b2Mat22,P=j.Common.Math.b2Mat33,T=j.Common.Math.b2Math,ac=j.Common.Math.b2Vec2,aj=j.Common.Math.b2Vec3,o=j.Dynamics.Joints.b2DistanceJoint,ak=j.Dynamics.Joints.b2DistanceJointDef,ai=j.Dynamics.Joints.b2FrictionJoint,s=j.Dynamics.Joints.b2FrictionJointDef,n=j.Dynamics.Joints.b2GearJoint,x=j.Dynamics.Joints.b2GearJointDef,C=j.Dynamics.Joints.b2Jacobian,X=j.Dynamics.Joints.b2Joint,m=j.Dynamics.Joints.b2JointDef,l=j.Dynamics.Joints.b2JointEdge,al=j.Dynamics.Joints.b2LineJoint,J=j.Dynamics.Joints.b2LineJointDef,ae=j.Dynamics.Joints.b2MouseJoint,ah=j.Dynamics.Joints.b2MouseJointDef,ab=j.Dynamics.Joints.b2PrismaticJoint,t=j.Dynamics.Joints.b2PrismaticJointDef,ag=j.Dynamics.Joints.b2PulleyJoint,r=j.Dynamics.Joints.b2PulleyJointDef,v=j.Dynamics.Joints.b2RevoluteJoint,q=j.Dynamics.Joints.b2RevoluteJointDef,am=j.Dynamics.Joints.b2WeldJoint,i=j.Dynamics.Joints.b2WeldJointDef;
j.inherit(o,j.Dynamics.Joints.b2Joint);o.prototype.__super=j.Dynamics.Joints.b2Joint.prototype;o.b2DistanceJoint=function(){j.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);
this.m_localAnchor1=new ac;this.m_localAnchor2=new ac;this.m_u=new ac;};o.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
};o.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);};o.prototype.GetReactionForce=function(k){if(k===g){k=0;}return new ac(k*this.m_impulse*this.m_u.x,k*this.m_impulse*this.m_u.y);
};o.prototype.GetReactionTorque=function(){return 0;};o.prototype.GetLength=function(){return this.m_length;};o.prototype.SetLength=function(k){if(k===g){k=0;
}this.m_length=k;};o.prototype.GetFrequency=function(){return this.m_frequencyHz;};o.prototype.SetFrequency=function(k){if(k===g){k=0;}this.m_frequencyHz=k;
};o.prototype.GetDampingRatio=function(){return this.m_dampingRatio;};o.prototype.SetDampingRatio=function(k){if(k===g){k=0;}this.m_dampingRatio=k;};o.prototype.b2DistanceJoint=function(k){this.__super.b2Joint.call(this,k);
this.m_localAnchor1.SetV(k.localAnchorA);this.m_localAnchor2.SetV(k.localAnchorB);this.m_length=k.length;this.m_frequencyHz=k.frequencyHz;this.m_dampingRatio=k.dampingRatio;
this.m_bias=this.m_gamma=this.m_impulse=0;};o.prototype.InitVelocityConstraints=function(D){var A,y=0,z=this.m_bodyA,p=this.m_bodyB;A=z.m_xf.R;var k=this.m_localAnchor1.x-z.m_sweep.localCenter.x,u=this.m_localAnchor1.y-z.m_sweep.localCenter.y;
y=A.col1.x*k+A.col2.x*u;u=A.col1.y*k+A.col2.y*u;k=y;A=p.m_xf.R;var G=this.m_localAnchor2.x-p.m_sweep.localCenter.x,E=this.m_localAnchor2.y-p.m_sweep.localCenter.y;
y=A.col1.x*G+A.col2.x*E;E=A.col1.y*G+A.col2.y*E;G=y;this.m_u.x=p.m_sweep.c.x+G-z.m_sweep.c.x-k;this.m_u.y=p.m_sweep.c.y+E-z.m_sweep.c.y-u;y=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);
y>af.b2_linearSlop?this.m_u.Multiply(1/y):this.m_u.SetZero();A=k*this.m_u.y-u*this.m_u.x;var B=G*this.m_u.y-E*this.m_u.x;A=z.m_invMass+z.m_invI*A*A+p.m_invMass+p.m_invI*B*B;
this.m_mass=A!=0?1/A:0;if(this.m_frequencyHz>0){y=y-this.m_length;B=2*Math.PI*this.m_frequencyHz;var F=this.m_mass*B*B;this.m_gamma=D.dt*(2*this.m_mass*this.m_dampingRatio*B+D.dt*F);
this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_bias=y*D.dt*F*this.m_gamma;this.m_mass=A+this.m_gamma;this.m_mass=this.m_mass!=0?1/this.m_mass:0;}if(D.warmStarting){this.m_impulse*=D.dtRatio;
D=this.m_impulse*this.m_u.x;A=this.m_impulse*this.m_u.y;z.m_linearVelocity.x-=z.m_invMass*D;z.m_linearVelocity.y-=z.m_invMass*A;z.m_angularVelocity-=z.m_invI*(k*A-u*D);
p.m_linearVelocity.x+=p.m_invMass*D;p.m_linearVelocity.y+=p.m_invMass*A;p.m_angularVelocity+=p.m_invI*(G*A-E*D);}else{this.m_impulse=0;}};o.prototype.SolveVelocityConstraints=function(){var B,y=this.m_bodyA,p=this.m_bodyB;
B=y.m_xf.R;var u=this.m_localAnchor1.x-y.m_sweep.localCenter.x,A=this.m_localAnchor1.y-y.m_sweep.localCenter.y,z=B.col1.x*u+B.col2.x*A;A=B.col1.y*u+B.col2.y*A;
u=z;B=p.m_xf.R;var D=this.m_localAnchor2.x-p.m_sweep.localCenter.x,k=this.m_localAnchor2.y-p.m_sweep.localCenter.y;z=B.col1.x*D+B.col2.x*k;k=B.col1.y*D+B.col2.y*k;
D=z;z=-this.m_mass*(this.m_u.x*(p.m_linearVelocity.x+-p.m_angularVelocity*k-(y.m_linearVelocity.x+-y.m_angularVelocity*A))+this.m_u.y*(p.m_linearVelocity.y+p.m_angularVelocity*D-(y.m_linearVelocity.y+y.m_angularVelocity*u))+this.m_bias+this.m_gamma*this.m_impulse);
this.m_impulse+=z;B=z*this.m_u.x;z=z*this.m_u.y;y.m_linearVelocity.x-=y.m_invMass*B;y.m_linearVelocity.y-=y.m_invMass*z;y.m_angularVelocity-=y.m_invI*(u*z-A*B);
p.m_linearVelocity.x+=p.m_invMass*B;p.m_linearVelocity.y+=p.m_invMass*z;p.m_angularVelocity+=p.m_invI*(D*z-k*B);};o.prototype.SolvePositionConstraints=function(){var D;
if(this.m_frequencyHz>0){return true;}var A=this.m_bodyA,y=this.m_bodyB;D=A.m_xf.R;var z=this.m_localAnchor1.x-A.m_sweep.localCenter.x,p=this.m_localAnchor1.y-A.m_sweep.localCenter.y,k=D.col1.x*z+D.col2.x*p;
p=D.col1.y*z+D.col2.y*p;z=k;D=y.m_xf.R;var u=this.m_localAnchor2.x-y.m_sweep.localCenter.x,F=this.m_localAnchor2.y-y.m_sweep.localCenter.y;k=D.col1.x*u+D.col2.x*F;
F=D.col1.y*u+D.col2.y*F;u=k;k=y.m_sweep.c.x+u-A.m_sweep.c.x-z;var E=y.m_sweep.c.y+F-A.m_sweep.c.y-p;D=Math.sqrt(k*k+E*E);k/=D;E/=D;D=D-this.m_length;D=T.Clamp(D,-af.b2_maxLinearCorrection,af.b2_maxLinearCorrection);
var B=-this.m_mass*D;this.m_u.Set(k,E);k=B*this.m_u.x;E=B*this.m_u.y;A.m_sweep.c.x-=A.m_invMass*k;A.m_sweep.c.y-=A.m_invMass*E;A.m_sweep.a-=A.m_invI*(z*E-p*k);
y.m_sweep.c.x+=y.m_invMass*k;y.m_sweep.c.y+=y.m_invMass*E;y.m_sweep.a+=y.m_invI*(u*E-F*k);A.SynchronizeTransform();y.SynchronizeTransform();return T.Abs(D)<af.b2_linearSlop;
};j.inherit(ak,j.Dynamics.Joints.b2JointDef);ak.prototype.__super=j.Dynamics.Joints.b2JointDef.prototype;ak.b2DistanceJointDef=function(){j.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);
this.localAnchorA=new ac;this.localAnchorB=new ac;};ak.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=X.e_distanceJoint;
this.length=1;this.dampingRatio=this.frequencyHz=0;};ak.prototype.Initialize=function(y,u,k,p){this.bodyA=y;this.bodyB=u;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(k));
this.localAnchorB.SetV(this.bodyB.GetLocalPoint(p));y=p.x-k.x;k=p.y-k.y;this.length=Math.sqrt(y*y+k*k);this.dampingRatio=this.frequencyHz=0;};j.inherit(ai,j.Dynamics.Joints.b2Joint);
ai.prototype.__super=j.Dynamics.Joints.b2Joint.prototype;ai.b2FrictionJoint=function(){j.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new ac;
this.m_localAnchorB=new ac;this.m_linearMass=new ad;this.m_linearImpulse=new ac;};ai.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA);
};ai.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB);};ai.prototype.GetReactionForce=function(k){if(k===g){k=0;}return new ac(k*this.m_linearImpulse.x,k*this.m_linearImpulse.y);
};ai.prototype.GetReactionTorque=function(k){if(k===g){k=0;}return k*this.m_angularImpulse;};ai.prototype.SetMaxForce=function(k){if(k===g){k=0;}this.m_maxForce=k;
};ai.prototype.GetMaxForce=function(){return this.m_maxForce;};ai.prototype.SetMaxTorque=function(k){if(k===g){k=0;}this.m_maxTorque=k;};ai.prototype.GetMaxTorque=function(){return this.m_maxTorque;
};ai.prototype.b2FrictionJoint=function(k){this.__super.b2Joint.call(this,k);this.m_localAnchorA.SetV(k.localAnchorA);this.m_localAnchorB.SetV(k.localAnchorB);
this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=k.maxForce;this.m_maxTorque=k.maxTorque;
};ai.prototype.InitVelocityConstraints=function(E){var A,y=0,z=this.m_bodyA,p=this.m_bodyB;A=z.m_xf.R;var k=this.m_localAnchorA.x-z.m_sweep.localCenter.x,u=this.m_localAnchorA.y-z.m_sweep.localCenter.y;
y=A.col1.x*k+A.col2.x*u;u=A.col1.y*k+A.col2.y*u;k=y;A=p.m_xf.R;var H=this.m_localAnchorB.x-p.m_sweep.localCenter.x,F=this.m_localAnchorB.y-p.m_sweep.localCenter.y;
y=A.col1.x*H+A.col2.x*F;F=A.col1.y*H+A.col2.y*F;H=y;A=z.m_invMass;y=p.m_invMass;var B=z.m_invI,G=p.m_invI,D=new ad;D.col1.x=A+y;D.col2.x=0;D.col1.y=0;D.col2.y=A+y;
D.col1.x+=B*u*u;D.col2.x+=-B*k*u;D.col1.y+=-B*k*u;D.col2.y+=B*k*k;D.col1.x+=G*F*F;D.col2.x+=-G*H*F;D.col1.y+=-G*H*F;D.col2.y+=G*H*H;D.GetInverse(this.m_linearMass);
this.m_angularMass=B+G;if(this.m_angularMass>0){this.m_angularMass=1/this.m_angularMass;}if(E.warmStarting){this.m_linearImpulse.x*=E.dtRatio;this.m_linearImpulse.y*=E.dtRatio;
this.m_angularImpulse*=E.dtRatio;E=this.m_linearImpulse;z.m_linearVelocity.x-=A*E.x;z.m_linearVelocity.y-=A*E.y;z.m_angularVelocity-=B*(k*E.y-u*E.x+this.m_angularImpulse);
p.m_linearVelocity.x+=y*E.x;p.m_linearVelocity.y+=y*E.y;p.m_angularVelocity+=G*(H*E.y-F*E.x+this.m_angularImpulse);}else{this.m_linearImpulse.SetZero();
this.m_angularImpulse=0;}};ai.prototype.SolveVelocityConstraints=function(L){var G,E=0,F=this.m_bodyA,A=this.m_bodyB,z=F.m_linearVelocity,B=F.m_angularVelocity,O=A.m_linearVelocity,M=A.m_angularVelocity,H=F.m_invMass,N=A.m_invMass,K=F.m_invI,I=A.m_invI;
G=F.m_xf.R;var D=this.m_localAnchorA.x-F.m_sweep.localCenter.x,y=this.m_localAnchorA.y-F.m_sweep.localCenter.y;E=G.col1.x*D+G.col2.x*y;y=G.col1.y*D+G.col2.y*y;
D=E;G=A.m_xf.R;var u=this.m_localAnchorB.x-A.m_sweep.localCenter.x,k=this.m_localAnchorB.y-A.m_sweep.localCenter.y;E=G.col1.x*u+G.col2.x*k;k=G.col1.y*u+G.col2.y*k;
u=E;G=0;E=-this.m_angularMass*(M-B);var p=this.m_angularImpulse;G=L.dt*this.m_maxTorque;this.m_angularImpulse=T.Clamp(this.m_angularImpulse+E,-G,G);E=this.m_angularImpulse-p;
B-=K*E;M+=I*E;G=T.MulMV(this.m_linearMass,new ac(-(O.x-M*k-z.x+B*y),-(O.y+M*u-z.y-B*D)));E=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(G);G=L.dt*this.m_maxForce;
if(this.m_linearImpulse.LengthSquared()>G*G){this.m_linearImpulse.Normalize();this.m_linearImpulse.Multiply(G);}G=T.SubtractVV(this.m_linearImpulse,E);
z.x-=H*G.x;z.y-=H*G.y;B-=K*(D*G.y-y*G.x);O.x+=N*G.x;O.y+=N*G.y;M+=I*(u*G.y-k*G.x);F.m_angularVelocity=B;A.m_angularVelocity=M;};ai.prototype.SolvePositionConstraints=function(){return true;
};j.inherit(s,j.Dynamics.Joints.b2JointDef);s.prototype.__super=j.Dynamics.Joints.b2JointDef.prototype;s.b2FrictionJointDef=function(){j.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);
this.localAnchorA=new ac;this.localAnchorB=new ac;};s.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=X.e_frictionJoint;
this.maxTorque=this.maxForce=0;};s.prototype.Initialize=function(u,p,k){this.bodyA=u;this.bodyB=p;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(k));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(k));
};j.inherit(n,j.Dynamics.Joints.b2Joint);n.prototype.__super=j.Dynamics.Joints.b2Joint.prototype;n.b2GearJoint=function(){j.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);
this.m_groundAnchor1=new ac;this.m_groundAnchor2=new ac;this.m_localAnchor1=new ac;this.m_localAnchor2=new ac;this.m_J=new C;};n.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
};n.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);};n.prototype.GetReactionForce=function(k){if(k===g){k=0;}return new ac(k*this.m_impulse*this.m_J.linearB.x,k*this.m_impulse*this.m_J.linearB.y);
};n.prototype.GetReactionTorque=function(z){if(z===g){z=0;}var u=this.m_bodyB.m_xf.R,k=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,p=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,y=u.col1.x*k+u.col2.x*p;
p=u.col1.y*k+u.col2.y*p;k=y;return z*(this.m_impulse*this.m_J.angularB-k*this.m_impulse*this.m_J.linearB.y+p*this.m_impulse*this.m_J.linearB.x);};n.prototype.GetRatio=function(){return this.m_ratio;
};n.prototype.SetRatio=function(k){if(k===g){k=0;}this.m_ratio=k;};n.prototype.b2GearJoint=function(z){this.__super.b2Joint.call(this,z);var u=parseInt(z.joint1.m_type),k=parseInt(z.joint2.m_type);
this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var p=0,y=0;this.m_ground1=z.joint1.GetBodyA();this.m_bodyA=z.joint1.GetBodyB();
if(u==X.e_revoluteJoint){this.m_revolute1=z.joint1 instanceof v?z.joint1:null;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);
p=this.m_revolute1.GetJointAngle();}else{this.m_prismatic1=z.joint1 instanceof ab?z.joint1:null;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);
this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);p=this.m_prismatic1.GetJointTranslation();}this.m_ground2=z.joint2.GetBodyA();this.m_bodyB=z.joint2.GetBodyB();
if(k==X.e_revoluteJoint){this.m_revolute2=z.joint2 instanceof v?z.joint2:null;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);
y=this.m_revolute2.GetJointAngle();}else{this.m_prismatic2=z.joint2 instanceof ab?z.joint2:null;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);
this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);y=this.m_prismatic2.GetJointTranslation();}this.m_ratio=z.ratio;this.m_constant=p+this.m_ratio*y;
this.m_impulse=0;};n.prototype.InitVelocityConstraints=function(D){var A=this.m_ground1,y=this.m_ground2,z=this.m_bodyA,p=this.m_bodyB,k=0,u=0,G=0,E=0,B=G=0,F=0;
this.m_J.SetZero();if(this.m_revolute1){this.m_J.angularA=-1;F+=z.m_invI;}else{A=A.m_xf.R;u=this.m_prismatic1.m_localXAxis1;k=A.col1.x*u.x+A.col2.x*u.y;
u=A.col1.y*u.x+A.col2.y*u.y;A=z.m_xf.R;G=this.m_localAnchor1.x-z.m_sweep.localCenter.x;E=this.m_localAnchor1.y-z.m_sweep.localCenter.y;B=A.col1.x*G+A.col2.x*E;
E=A.col1.y*G+A.col2.y*E;G=B;G=G*u-E*k;this.m_J.linearA.Set(-k,-u);this.m_J.angularA=-G;F+=z.m_invMass+z.m_invI*G*G;}if(this.m_revolute2){this.m_J.angularB=-this.m_ratio;
F+=this.m_ratio*this.m_ratio*p.m_invI;}else{A=y.m_xf.R;u=this.m_prismatic2.m_localXAxis1;k=A.col1.x*u.x+A.col2.x*u.y;u=A.col1.y*u.x+A.col2.y*u.y;A=p.m_xf.R;
G=this.m_localAnchor2.x-p.m_sweep.localCenter.x;E=this.m_localAnchor2.y-p.m_sweep.localCenter.y;B=A.col1.x*G+A.col2.x*E;E=A.col1.y*G+A.col2.y*E;G=B;G=G*u-E*k;
this.m_J.linearB.Set(-this.m_ratio*k,-this.m_ratio*u);this.m_J.angularB=-this.m_ratio*G;F+=this.m_ratio*this.m_ratio*(p.m_invMass+p.m_invI*G*G);}this.m_mass=F>0?1/F:0;
if(D.warmStarting){z.m_linearVelocity.x+=z.m_invMass*this.m_impulse*this.m_J.linearA.x;z.m_linearVelocity.y+=z.m_invMass*this.m_impulse*this.m_J.linearA.y;
z.m_angularVelocity+=z.m_invI*this.m_impulse*this.m_J.angularA;p.m_linearVelocity.x+=p.m_invMass*this.m_impulse*this.m_J.linearB.x;p.m_linearVelocity.y+=p.m_invMass*this.m_impulse*this.m_J.linearB.y;
p.m_angularVelocity+=p.m_invI*this.m_impulse*this.m_J.angularB;}else{this.m_impulse=0;}};n.prototype.SolveVelocityConstraints=function(){var u=this.m_bodyA,p=this.m_bodyB,k=-this.m_mass*this.m_J.Compute(u.m_linearVelocity,u.m_angularVelocity,p.m_linearVelocity,p.m_angularVelocity);
this.m_impulse+=k;u.m_linearVelocity.x+=u.m_invMass*k*this.m_J.linearA.x;u.m_linearVelocity.y+=u.m_invMass*k*this.m_J.linearA.y;u.m_angularVelocity+=u.m_invI*k*this.m_J.angularA;
p.m_linearVelocity.x+=p.m_invMass*k*this.m_J.linearB.x;p.m_linearVelocity.y+=p.m_invMass*k*this.m_J.linearB.y;p.m_angularVelocity+=p.m_invI*k*this.m_J.angularB;
};n.prototype.SolvePositionConstraints=function(){var y=this.m_bodyA,u=this.m_bodyB,k=0,p=0;k=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation();
p=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();k=-this.m_mass*(this.m_constant-(k+this.m_ratio*p));y.m_sweep.c.x+=y.m_invMass*k*this.m_J.linearA.x;
y.m_sweep.c.y+=y.m_invMass*k*this.m_J.linearA.y;y.m_sweep.a+=y.m_invI*k*this.m_J.angularA;u.m_sweep.c.x+=u.m_invMass*k*this.m_J.linearB.x;u.m_sweep.c.y+=u.m_invMass*k*this.m_J.linearB.y;
u.m_sweep.a+=u.m_invI*k*this.m_J.angularB;y.SynchronizeTransform();u.SynchronizeTransform();return 0<af.b2_linearSlop;};j.inherit(x,j.Dynamics.Joints.b2JointDef);
x.prototype.__super=j.Dynamics.Joints.b2JointDef.prototype;x.b2GearJointDef=function(){j.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);};
x.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=X.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1;};C.b2Jacobian=function(){this.linearA=new ac;
this.linearB=new ac;};C.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0;};C.prototype.Set=function(y,u,k,p){if(u===g){u=0;
}if(p===g){p=0;}this.linearA.SetV(y);this.angularA=u;this.linearB.SetV(k);this.angularB=p;};C.prototype.Compute=function(y,u,k,p){if(u===g){u=0;}if(p===g){p=0;
}return this.linearA.x*y.x+this.linearA.y*y.y+this.angularA*u+(this.linearB.x*k.x+this.linearB.y*k.y)+this.angularB*p;};X.b2Joint=function(){this.m_edgeA=new l;
this.m_edgeB=new l;this.m_localCenterA=new ac;this.m_localCenterB=new ac;};X.prototype.GetType=function(){return this.m_type;};X.prototype.GetAnchorA=function(){return null;
};X.prototype.GetAnchorB=function(){return null;};X.prototype.GetReactionForce=function(){return null;};X.prototype.GetReactionTorque=function(){return 0;
};X.prototype.GetBodyA=function(){return this.m_bodyA;};X.prototype.GetBodyB=function(){return this.m_bodyB;};X.prototype.GetNext=function(){return this.m_next;
};X.prototype.GetUserData=function(){return this.m_userData;};X.prototype.SetUserData=function(k){this.m_userData=k;};X.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive();
};X.Create=function(p){var k=null;switch(p.type){case X.e_distanceJoint:k=new o(p instanceof ak?p:null);break;case X.e_mouseJoint:k=new ae(p instanceof ah?p:null);
break;case X.e_prismaticJoint:k=new ab(p instanceof t?p:null);break;case X.e_revoluteJoint:k=new v(p instanceof q?p:null);break;case X.e_pulleyJoint:k=new ag(p instanceof r?p:null);
break;case X.e_gearJoint:k=new n(p instanceof x?p:null);break;case X.e_lineJoint:k=new al(p instanceof J?p:null);break;case X.e_weldJoint:k=new am(p instanceof i?p:null);
break;case X.e_frictionJoint:k=new ai(p instanceof s?p:null);}return k;};X.Destroy=function(){};X.prototype.b2Joint=function(k){af.b2Assert(k.bodyA!=k.bodyB);
this.m_type=k.type;this.m_next=this.m_prev=null;this.m_bodyA=k.bodyA;this.m_bodyB=k.bodyB;this.m_collideConnected=k.collideConnected;this.m_islandFlag=false;
this.m_userData=k.userData;};X.prototype.InitVelocityConstraints=function(){};X.prototype.SolveVelocityConstraints=function(){};X.prototype.FinalizeVelocityConstraints=function(){};
X.prototype.SolvePositionConstraints=function(){return false;};j.postDefs.push(function(){j.Dynamics.Joints.b2Joint.e_unknownJoint=0;j.Dynamics.Joints.b2Joint.e_revoluteJoint=1;
j.Dynamics.Joints.b2Joint.e_prismaticJoint=2;j.Dynamics.Joints.b2Joint.e_distanceJoint=3;j.Dynamics.Joints.b2Joint.e_pulleyJoint=4;j.Dynamics.Joints.b2Joint.e_mouseJoint=5;
j.Dynamics.Joints.b2Joint.e_gearJoint=6;j.Dynamics.Joints.b2Joint.e_lineJoint=7;j.Dynamics.Joints.b2Joint.e_weldJoint=8;j.Dynamics.Joints.b2Joint.e_frictionJoint=9;
j.Dynamics.Joints.b2Joint.e_inactiveLimit=0;j.Dynamics.Joints.b2Joint.e_atLowerLimit=1;j.Dynamics.Joints.b2Joint.e_atUpperLimit=2;j.Dynamics.Joints.b2Joint.e_equalLimits=3;
});m.b2JointDef=function(){};m.prototype.b2JointDef=function(){this.type=X.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=false;
};l.b2JointEdge=function(){};j.inherit(al,j.Dynamics.Joints.b2Joint);al.prototype.__super=j.Dynamics.Joints.b2Joint.prototype;al.b2LineJoint=function(){j.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);
this.m_localAnchor1=new ac;this.m_localAnchor2=new ac;this.m_localXAxis1=new ac;this.m_localYAxis1=new ac;this.m_axis=new ac;this.m_perp=new ac;this.m_K=new ad;
this.m_impulse=new ac;};al.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);};al.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);
};al.prototype.GetReactionForce=function(k){if(k===g){k=0;}return new ac(k*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),k*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y));
};al.prototype.GetReactionTorque=function(k){if(k===g){k=0;}return k*this.m_impulse.y;};al.prototype.GetJointTranslation=function(){var y=this.m_bodyA,u=this.m_bodyB,k=y.GetWorldPoint(this.m_localAnchor1),p=u.GetWorldPoint(this.m_localAnchor2);
u=p.x-k.x;k=p.y-k.y;y=y.GetWorldVector(this.m_localXAxis1);return y.x*u+y.y*k;};al.prototype.GetJointSpeed=function(){var D=this.m_bodyA,A=this.m_bodyB,y;
y=D.m_xf.R;var z=this.m_localAnchor1.x-D.m_sweep.localCenter.x,p=this.m_localAnchor1.y-D.m_sweep.localCenter.y,k=y.col1.x*z+y.col2.x*p;p=y.col1.y*z+y.col2.y*p;
z=k;y=A.m_xf.R;var u=this.m_localAnchor2.x-A.m_sweep.localCenter.x,G=this.m_localAnchor2.y-A.m_sweep.localCenter.y;k=y.col1.x*u+y.col2.x*G;G=y.col1.y*u+y.col2.y*G;
u=k;y=A.m_sweep.c.x+u-(D.m_sweep.c.x+z);k=A.m_sweep.c.y+G-(D.m_sweep.c.y+p);var E=D.GetWorldVector(this.m_localXAxis1),B=D.m_linearVelocity,F=A.m_linearVelocity;
D=D.m_angularVelocity;A=A.m_angularVelocity;return y*-D*E.y+k*D*E.x+(E.x*(F.x+-A*G-B.x- -D*p)+E.y*(F.y+A*u-B.y-D*z));};al.prototype.IsLimitEnabled=function(){return this.m_enableLimit;
};al.prototype.EnableLimit=function(k){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=k;};al.prototype.GetLowerLimit=function(){return this.m_lowerTranslation;
};al.prototype.GetUpperLimit=function(){return this.m_upperTranslation;};al.prototype.SetLimits=function(p,k){if(p===g){p=0;}if(k===g){k=0;}this.m_bodyA.SetAwake(true);
this.m_bodyB.SetAwake(true);this.m_lowerTranslation=p;this.m_upperTranslation=k;};al.prototype.IsMotorEnabled=function(){return this.m_enableMotor;};al.prototype.EnableMotor=function(k){this.m_bodyA.SetAwake(true);
this.m_bodyB.SetAwake(true);this.m_enableMotor=k;};al.prototype.SetMotorSpeed=function(k){if(k===g){k=0;}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);
this.m_motorSpeed=k;};al.prototype.GetMotorSpeed=function(){return this.m_motorSpeed;};al.prototype.SetMaxMotorForce=function(k){if(k===g){k=0;}this.m_bodyA.SetAwake(true);
this.m_bodyB.SetAwake(true);this.m_maxMotorForce=k;};al.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce;};al.prototype.GetMotorForce=function(){return this.m_motorImpulse;
};al.prototype.b2LineJoint=function(k){this.__super.b2Joint.call(this,k);this.m_localAnchor1.SetV(k.localAnchorA);this.m_localAnchor2.SetV(k.localAnchorB);
this.m_localXAxis1.SetV(k.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;
this.m_lowerTranslation=k.lowerTranslation;this.m_upperTranslation=k.upperTranslation;this.m_maxMotorForce=k.maxMotorForce;this.m_motorSpeed=k.motorSpeed;
this.m_enableLimit=k.enableLimit;this.m_enableMotor=k.enableMotor;this.m_limitState=X.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero();};al.prototype.InitVelocityConstraints=function(D){var A=this.m_bodyA,y=this.m_bodyB,z,p=0;
this.m_localCenterA.SetV(A.GetLocalCenter());this.m_localCenterB.SetV(y.GetLocalCenter());var k=A.GetTransform();y.GetTransform();z=A.m_xf.R;var u=this.m_localAnchor1.x-this.m_localCenterA.x,F=this.m_localAnchor1.y-this.m_localCenterA.y;
p=z.col1.x*u+z.col2.x*F;F=z.col1.y*u+z.col2.y*F;u=p;z=y.m_xf.R;var E=this.m_localAnchor2.x-this.m_localCenterB.x,B=this.m_localAnchor2.y-this.m_localCenterB.y;
p=z.col1.x*E+z.col2.x*B;B=z.col1.y*E+z.col2.y*B;E=p;z=y.m_sweep.c.x+E-A.m_sweep.c.x-u;p=y.m_sweep.c.y+B-A.m_sweep.c.y-F;this.m_invMassA=A.m_invMass;this.m_invMassB=y.m_invMass;
this.m_invIA=A.m_invI;this.m_invIB=y.m_invI;this.m_axis.SetV(T.MulMV(k.R,this.m_localXAxis1));this.m_a1=(z+u)*this.m_axis.y-(p+F)*this.m_axis.x;this.m_a2=E*this.m_axis.y-B*this.m_axis.x;
this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;
this.m_perp.SetV(T.MulMV(k.R,this.m_localYAxis1));this.m_s1=(z+u)*this.m_perp.y-(p+F)*this.m_perp.x;this.m_s2=E*this.m_perp.y-B*this.m_perp.x;k=this.m_invMassA;
u=this.m_invMassB;F=this.m_invIA;E=this.m_invIB;this.m_K.col1.x=k+u+F*this.m_s1*this.m_s1+E*this.m_s2*this.m_s2;this.m_K.col1.y=F*this.m_s1*this.m_a1+E*this.m_s2*this.m_a2;
this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=k+u+F*this.m_a1*this.m_a1+E*this.m_a2*this.m_a2;if(this.m_enableLimit){z=this.m_axis.x*z+this.m_axis.y*p;
if(T.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*af.b2_linearSlop){this.m_limitState=X.e_equalLimits;}else{if(z<=this.m_lowerTranslation){if(this.m_limitState!=X.e_atLowerLimit){this.m_limitState=X.e_atLowerLimit;
this.m_impulse.y=0;}}else{if(z>=this.m_upperTranslation){if(this.m_limitState!=X.e_atUpperLimit){this.m_limitState=X.e_atUpperLimit;this.m_impulse.y=0;
}}else{this.m_limitState=X.e_inactiveLimit;this.m_impulse.y=0;}}}}else{this.m_limitState=X.e_inactiveLimit;}if(this.m_enableMotor==false){this.m_motorImpulse=0;
}if(D.warmStarting){this.m_impulse.x*=D.dtRatio;this.m_impulse.y*=D.dtRatio;this.m_motorImpulse*=D.dtRatio;D=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x;
z=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y;p=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1;
k=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;A.m_linearVelocity.x-=this.m_invMassA*D;A.m_linearVelocity.y-=this.m_invMassA*z;
A.m_angularVelocity-=this.m_invIA*p;y.m_linearVelocity.x+=this.m_invMassB*D;y.m_linearVelocity.y+=this.m_invMassB*z;y.m_angularVelocity+=this.m_invIB*k;
}else{this.m_impulse.SetZero();this.m_motorImpulse=0;}};al.prototype.SolveVelocityConstraints=function(D){var A=this.m_bodyA,y=this.m_bodyB,z=A.m_linearVelocity,p=A.m_angularVelocity,k=y.m_linearVelocity,u=y.m_angularVelocity,G=0,E=0,B=0,F=0;
if(this.m_enableMotor&&this.m_limitState!=X.e_equalLimits){F=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(k.x-z.x)+this.m_axis.y*(k.y-z.y)+this.m_a2*u-this.m_a1*p));
G=this.m_motorImpulse;E=D.dt*this.m_maxMotorForce;this.m_motorImpulse=T.Clamp(this.m_motorImpulse+F,-E,E);F=this.m_motorImpulse-G;G=F*this.m_axis.x;E=F*this.m_axis.y;
B=F*this.m_a1;F=F*this.m_a2;z.x-=this.m_invMassA*G;z.y-=this.m_invMassA*E;p-=this.m_invIA*B;k.x+=this.m_invMassB*G;k.y+=this.m_invMassB*E;u+=this.m_invIB*F;
}E=this.m_perp.x*(k.x-z.x)+this.m_perp.y*(k.y-z.y)+this.m_s2*u-this.m_s1*p;if(this.m_enableLimit&&this.m_limitState!=X.e_inactiveLimit){B=this.m_axis.x*(k.x-z.x)+this.m_axis.y*(k.y-z.y)+this.m_a2*u-this.m_a1*p;
G=this.m_impulse.Copy();D=this.m_K.Solve(new ac,-E,-B);this.m_impulse.Add(D);if(this.m_limitState==X.e_atLowerLimit){this.m_impulse.y=T.Max(this.m_impulse.y,0);
}else{if(this.m_limitState==X.e_atUpperLimit){this.m_impulse.y=T.Min(this.m_impulse.y,0);}}E=-E-(this.m_impulse.y-G.y)*this.m_K.col2.x;B=0;B=this.m_K.col1.x!=0?E/this.m_K.col1.x+G.x:G.x;
this.m_impulse.x=B;D.x=this.m_impulse.x-G.x;D.y=this.m_impulse.y-G.y;G=D.x*this.m_perp.x+D.y*this.m_axis.x;E=D.x*this.m_perp.y+D.y*this.m_axis.y;B=D.x*this.m_s1+D.y*this.m_a1;
F=D.x*this.m_s2+D.y*this.m_a2;}else{D=0;D=this.m_K.col1.x!=0?-E/this.m_K.col1.x:0;this.m_impulse.x+=D;G=D*this.m_perp.x;E=D*this.m_perp.y;B=D*this.m_s1;
F=D*this.m_s2;}z.x-=this.m_invMassA*G;z.y-=this.m_invMassA*E;p-=this.m_invIA*B;k.x+=this.m_invMassB*G;k.y+=this.m_invMassB*E;u+=this.m_invIB*F;A.m_linearVelocity.SetV(z);
A.m_angularVelocity=p;y.m_linearVelocity.SetV(k);y.m_angularVelocity=u;};al.prototype.SolvePositionConstraints=function(){var H=this.m_bodyA,D=this.m_bodyB,A=H.m_sweep.c,B=H.m_sweep.a,u=D.m_sweep.c,p=D.m_sweep.a,y,L=0,I=0,E=0,K=0,G=y=0,F=0;
I=false;var z=0,k=ad.FromAngle(B);E=ad.FromAngle(p);y=k;F=this.m_localAnchor1.x-this.m_localCenterA.x;var N=this.m_localAnchor1.y-this.m_localCenterA.y;
L=y.col1.x*F+y.col2.x*N;N=y.col1.y*F+y.col2.y*N;F=L;y=E;E=this.m_localAnchor2.x-this.m_localCenterB.x;K=this.m_localAnchor2.y-this.m_localCenterB.y;L=y.col1.x*E+y.col2.x*K;
K=y.col1.y*E+y.col2.y*K;E=L;y=u.x+E-A.x-F;L=u.y+K-A.y-N;if(this.m_enableLimit){this.m_axis=T.MulMV(k,this.m_localXAxis1);this.m_a1=(y+F)*this.m_axis.y-(L+N)*this.m_axis.x;
this.m_a2=E*this.m_axis.y-K*this.m_axis.x;var M=this.m_axis.x*y+this.m_axis.y*L;if(T.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*af.b2_linearSlop){z=T.Clamp(M,-af.b2_maxLinearCorrection,af.b2_maxLinearCorrection);
G=T.Abs(M);I=true;}else{if(M<=this.m_lowerTranslation){z=T.Clamp(M-this.m_lowerTranslation+af.b2_linearSlop,-af.b2_maxLinearCorrection,0);G=this.m_lowerTranslation-M;
I=true;}else{if(M>=this.m_upperTranslation){z=T.Clamp(M-this.m_upperTranslation+af.b2_linearSlop,0,af.b2_maxLinearCorrection);G=M-this.m_upperTranslation;
I=true;}}}}this.m_perp=T.MulMV(k,this.m_localYAxis1);this.m_s1=(y+F)*this.m_perp.y-(L+N)*this.m_perp.x;this.m_s2=E*this.m_perp.y-K*this.m_perp.x;k=new ac;
N=this.m_perp.x*y+this.m_perp.y*L;G=T.Max(G,T.Abs(N));F=0;if(I){I=this.m_invMassA;E=this.m_invMassB;K=this.m_invIA;y=this.m_invIB;this.m_K.col1.x=I+E+K*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2;
this.m_K.col1.y=K*this.m_s1*this.m_a1+y*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=I+E+K*this.m_a1*this.m_a1+y*this.m_a2*this.m_a2;
this.m_K.Solve(k,-N,-z);}else{I=this.m_invMassA;E=this.m_invMassB;K=this.m_invIA;y=this.m_invIB;z=I+E+K*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2;I=0;I=z!=0?-N/z:0;
k.x=I;k.y=0;}z=k.x*this.m_perp.x+k.y*this.m_axis.x;I=k.x*this.m_perp.y+k.y*this.m_axis.y;N=k.x*this.m_s1+k.y*this.m_a1;k=k.x*this.m_s2+k.y*this.m_a2;A.x-=this.m_invMassA*z;
A.y-=this.m_invMassA*I;B-=this.m_invIA*N;u.x+=this.m_invMassB*z;u.y+=this.m_invMassB*I;p+=this.m_invIB*k;H.m_sweep.a=B;D.m_sweep.a=p;H.SynchronizeTransform();
D.SynchronizeTransform();return G<=af.b2_linearSlop&&F<=af.b2_angularSlop;};j.inherit(J,j.Dynamics.Joints.b2JointDef);J.prototype.__super=j.Dynamics.Joints.b2JointDef.prototype;
J.b2LineJointDef=function(){j.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new ac;this.localAnchorB=new ac;this.localAxisA=new ac;
};J.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=X.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=false;this.upperTranslation=this.lowerTranslation=0;
this.enableMotor=false;this.motorSpeed=this.maxMotorForce=0;};J.prototype.Initialize=function(y,u,k,p){this.bodyA=y;this.bodyB=u;this.localAnchorA=this.bodyA.GetLocalPoint(k);
this.localAnchorB=this.bodyB.GetLocalPoint(k);this.localAxisA=this.bodyA.GetLocalVector(p);};j.inherit(ae,j.Dynamics.Joints.b2Joint);ae.prototype.__super=j.Dynamics.Joints.b2Joint.prototype;
ae.b2MouseJoint=function(){j.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new ad;this.K1=new ad;this.K2=new ad;this.m_localAnchor=new ac;
this.m_target=new ac;this.m_impulse=new ac;this.m_mass=new ad;this.m_C=new ac;};ae.prototype.GetAnchorA=function(){return this.m_target;};ae.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor);
};ae.prototype.GetReactionForce=function(k){if(k===g){k=0;}return new ac(k*this.m_impulse.x,k*this.m_impulse.y);};ae.prototype.GetReactionTorque=function(){return 0;
};ae.prototype.GetTarget=function(){return this.m_target;};ae.prototype.SetTarget=function(k){this.m_bodyB.IsAwake()==false&&this.m_bodyB.SetAwake(true);
this.m_target=k;};ae.prototype.GetMaxForce=function(){return this.m_maxForce;};ae.prototype.SetMaxForce=function(k){if(k===g){k=0;}this.m_maxForce=k;};
ae.prototype.GetFrequency=function(){return this.m_frequencyHz;};ae.prototype.SetFrequency=function(k){if(k===g){k=0;}this.m_frequencyHz=k;};ae.prototype.GetDampingRatio=function(){return this.m_dampingRatio;
};ae.prototype.SetDampingRatio=function(k){if(k===g){k=0;}this.m_dampingRatio=k;};ae.prototype.b2MouseJoint=function(y){this.__super.b2Joint.call(this,y);
this.m_target.SetV(y.target);var u=this.m_target.x-this.m_bodyB.m_xf.position.x,k=this.m_target.y-this.m_bodyB.m_xf.position.y,p=this.m_bodyB.m_xf.R;this.m_localAnchor.x=u*p.col1.x+k*p.col1.y;
this.m_localAnchor.y=u*p.col2.x+k*p.col2.y;this.m_maxForce=y.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=y.frequencyHz;this.m_dampingRatio=y.dampingRatio;
this.m_gamma=this.m_beta=0;};ae.prototype.InitVelocityConstraints=function(A){var u=this.m_bodyB,k=u.GetMass(),p=2*Math.PI*this.m_frequencyHz,z=k*p*p;this.m_gamma=A.dt*(2*k*this.m_dampingRatio*p+A.dt*z);
this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_beta=A.dt*z*this.m_gamma;z=u.m_xf.R;k=this.m_localAnchor.x-u.m_sweep.localCenter.x;p=this.m_localAnchor.y-u.m_sweep.localCenter.y;
var y=z.col1.x*k+z.col2.x*p;p=z.col1.y*k+z.col2.y*p;k=y;z=u.m_invMass;y=u.m_invI;this.K1.col1.x=z;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=z;this.K2.col1.x=y*p*p;
this.K2.col2.x=-y*k*p;this.K2.col1.y=-y*k*p;this.K2.col2.y=y*k*k;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;
this.K.GetInverse(this.m_mass);this.m_C.x=u.m_sweep.c.x+k-this.m_target.x;this.m_C.y=u.m_sweep.c.y+p-this.m_target.y;u.m_angularVelocity*=0.98;this.m_impulse.x*=A.dtRatio;
this.m_impulse.y*=A.dtRatio;u.m_linearVelocity.x+=z*this.m_impulse.x;u.m_linearVelocity.y+=z*this.m_impulse.y;u.m_angularVelocity+=y*(k*this.m_impulse.y-p*this.m_impulse.x);
};ae.prototype.SolveVelocityConstraints=function(B){var y=this.m_bodyB,p,u=0,A=0;p=y.m_xf.R;var z=this.m_localAnchor.x-y.m_sweep.localCenter.x,D=this.m_localAnchor.y-y.m_sweep.localCenter.y;
u=p.col1.x*z+p.col2.x*D;D=p.col1.y*z+p.col2.y*D;z=u;u=y.m_linearVelocity.x+-y.m_angularVelocity*D;var k=y.m_linearVelocity.y+y.m_angularVelocity*z;p=this.m_mass;
u=u+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;A=k+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;k=-(p.col1.x*u+p.col2.x*A);A=-(p.col1.y*u+p.col2.y*A);
p=this.m_impulse.x;u=this.m_impulse.y;this.m_impulse.x+=k;this.m_impulse.y+=A;B=B.dt*this.m_maxForce;this.m_impulse.LengthSquared()>B*B&&this.m_impulse.Multiply(B/this.m_impulse.Length());
k=this.m_impulse.x-p;A=this.m_impulse.y-u;y.m_linearVelocity.x+=y.m_invMass*k;y.m_linearVelocity.y+=y.m_invMass*A;y.m_angularVelocity+=y.m_invI*(z*A-D*k);
};ae.prototype.SolvePositionConstraints=function(){return true;};j.inherit(ah,j.Dynamics.Joints.b2JointDef);ah.prototype.__super=j.Dynamics.Joints.b2JointDef.prototype;
ah.b2MouseJointDef=function(){j.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new ac;};ah.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);
this.type=X.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7;};j.inherit(ab,j.Dynamics.Joints.b2Joint);ab.prototype.__super=j.Dynamics.Joints.b2Joint.prototype;
ab.b2PrismaticJoint=function(){j.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new ac;this.m_localAnchor2=new ac;this.m_localXAxis1=new ac;
this.m_localYAxis1=new ac;this.m_axis=new ac;this.m_perp=new ac;this.m_K=new P;this.m_impulse=new aj;};ab.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
};ab.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);};ab.prototype.GetReactionForce=function(k){if(k===g){k=0;}return new ac(k*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),k*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y));
};ab.prototype.GetReactionTorque=function(k){if(k===g){k=0;}return k*this.m_impulse.y;};ab.prototype.GetJointTranslation=function(){var y=this.m_bodyA,u=this.m_bodyB,k=y.GetWorldPoint(this.m_localAnchor1),p=u.GetWorldPoint(this.m_localAnchor2);
u=p.x-k.x;k=p.y-k.y;y=y.GetWorldVector(this.m_localXAxis1);return y.x*u+y.y*k;};ab.prototype.GetJointSpeed=function(){var D=this.m_bodyA,A=this.m_bodyB,y;
y=D.m_xf.R;var z=this.m_localAnchor1.x-D.m_sweep.localCenter.x,p=this.m_localAnchor1.y-D.m_sweep.localCenter.y,k=y.col1.x*z+y.col2.x*p;p=y.col1.y*z+y.col2.y*p;
z=k;y=A.m_xf.R;var u=this.m_localAnchor2.x-A.m_sweep.localCenter.x,G=this.m_localAnchor2.y-A.m_sweep.localCenter.y;k=y.col1.x*u+y.col2.x*G;G=y.col1.y*u+y.col2.y*G;
u=k;y=A.m_sweep.c.x+u-(D.m_sweep.c.x+z);k=A.m_sweep.c.y+G-(D.m_sweep.c.y+p);var E=D.GetWorldVector(this.m_localXAxis1),B=D.m_linearVelocity,F=A.m_linearVelocity;
D=D.m_angularVelocity;A=A.m_angularVelocity;return y*-D*E.y+k*D*E.x+(E.x*(F.x+-A*G-B.x- -D*p)+E.y*(F.y+A*u-B.y-D*z));};ab.prototype.IsLimitEnabled=function(){return this.m_enableLimit;
};ab.prototype.EnableLimit=function(k){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=k;};ab.prototype.GetLowerLimit=function(){return this.m_lowerTranslation;
};ab.prototype.GetUpperLimit=function(){return this.m_upperTranslation;};ab.prototype.SetLimits=function(p,k){if(p===g){p=0;}if(k===g){k=0;}this.m_bodyA.SetAwake(true);
this.m_bodyB.SetAwake(true);this.m_lowerTranslation=p;this.m_upperTranslation=k;};ab.prototype.IsMotorEnabled=function(){return this.m_enableMotor;};ab.prototype.EnableMotor=function(k){this.m_bodyA.SetAwake(true);
this.m_bodyB.SetAwake(true);this.m_enableMotor=k;};ab.prototype.SetMotorSpeed=function(k){if(k===g){k=0;}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);
this.m_motorSpeed=k;};ab.prototype.GetMotorSpeed=function(){return this.m_motorSpeed;};ab.prototype.SetMaxMotorForce=function(k){if(k===g){k=0;}this.m_bodyA.SetAwake(true);
this.m_bodyB.SetAwake(true);this.m_maxMotorForce=k;};ab.prototype.GetMotorForce=function(){return this.m_motorImpulse;};ab.prototype.b2PrismaticJoint=function(k){this.__super.b2Joint.call(this,k);
this.m_localAnchor1.SetV(k.localAnchorA);this.m_localAnchor2.SetV(k.localAnchorB);this.m_localXAxis1.SetV(k.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;
this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=k.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=k.lowerTranslation;
this.m_upperTranslation=k.upperTranslation;this.m_maxMotorForce=k.maxMotorForce;this.m_motorSpeed=k.motorSpeed;this.m_enableLimit=k.enableLimit;this.m_enableMotor=k.enableMotor;
this.m_limitState=X.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero();};ab.prototype.InitVelocityConstraints=function(D){var A=this.m_bodyA,y=this.m_bodyB,z,p=0;
this.m_localCenterA.SetV(A.GetLocalCenter());this.m_localCenterB.SetV(y.GetLocalCenter());var k=A.GetTransform();y.GetTransform();z=A.m_xf.R;var u=this.m_localAnchor1.x-this.m_localCenterA.x,F=this.m_localAnchor1.y-this.m_localCenterA.y;
p=z.col1.x*u+z.col2.x*F;F=z.col1.y*u+z.col2.y*F;u=p;z=y.m_xf.R;var E=this.m_localAnchor2.x-this.m_localCenterB.x,B=this.m_localAnchor2.y-this.m_localCenterB.y;
p=z.col1.x*E+z.col2.x*B;B=z.col1.y*E+z.col2.y*B;E=p;z=y.m_sweep.c.x+E-A.m_sweep.c.x-u;p=y.m_sweep.c.y+B-A.m_sweep.c.y-F;this.m_invMassA=A.m_invMass;this.m_invMassB=y.m_invMass;
this.m_invIA=A.m_invI;this.m_invIB=y.m_invI;this.m_axis.SetV(T.MulMV(k.R,this.m_localXAxis1));this.m_a1=(z+u)*this.m_axis.y-(p+F)*this.m_axis.x;this.m_a2=E*this.m_axis.y-B*this.m_axis.x;
this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;if(this.m_motorMass>Number.MIN_VALUE){this.m_motorMass=1/this.m_motorMass;
}this.m_perp.SetV(T.MulMV(k.R,this.m_localYAxis1));this.m_s1=(z+u)*this.m_perp.y-(p+F)*this.m_perp.x;this.m_s2=E*this.m_perp.y-B*this.m_perp.x;k=this.m_invMassA;
u=this.m_invMassB;F=this.m_invIA;E=this.m_invIB;this.m_K.col1.x=k+u+F*this.m_s1*this.m_s1+E*this.m_s2*this.m_s2;this.m_K.col1.y=F*this.m_s1+E*this.m_s2;
this.m_K.col1.z=F*this.m_s1*this.m_a1+E*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=F+E;this.m_K.col2.z=F*this.m_a1+E*this.m_a2;
this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=k+u+F*this.m_a1*this.m_a1+E*this.m_a2*this.m_a2;if(this.m_enableLimit){z=this.m_axis.x*z+this.m_axis.y*p;
if(T.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*af.b2_linearSlop){this.m_limitState=X.e_equalLimits;}else{if(z<=this.m_lowerTranslation){if(this.m_limitState!=X.e_atLowerLimit){this.m_limitState=X.e_atLowerLimit;
this.m_impulse.z=0;}}else{if(z>=this.m_upperTranslation){if(this.m_limitState!=X.e_atUpperLimit){this.m_limitState=X.e_atUpperLimit;this.m_impulse.z=0;
}}else{this.m_limitState=X.e_inactiveLimit;this.m_impulse.z=0;}}}}else{this.m_limitState=X.e_inactiveLimit;}if(this.m_enableMotor==false){this.m_motorImpulse=0;
}if(D.warmStarting){this.m_impulse.x*=D.dtRatio;this.m_impulse.y*=D.dtRatio;this.m_motorImpulse*=D.dtRatio;D=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x;
z=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y;p=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1;
k=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;A.m_linearVelocity.x-=this.m_invMassA*D;A.m_linearVelocity.y-=this.m_invMassA*z;
A.m_angularVelocity-=this.m_invIA*p;y.m_linearVelocity.x+=this.m_invMassB*D;y.m_linearVelocity.y+=this.m_invMassB*z;y.m_angularVelocity+=this.m_invIB*k;
}else{this.m_impulse.SetZero();this.m_motorImpulse=0;}};ab.prototype.SolveVelocityConstraints=function(D){var A=this.m_bodyA,y=this.m_bodyB,z=A.m_linearVelocity,p=A.m_angularVelocity,k=y.m_linearVelocity,u=y.m_angularVelocity,G=0,E=0,B=0,F=0;
if(this.m_enableMotor&&this.m_limitState!=X.e_equalLimits){F=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(k.x-z.x)+this.m_axis.y*(k.y-z.y)+this.m_a2*u-this.m_a1*p));
G=this.m_motorImpulse;D=D.dt*this.m_maxMotorForce;this.m_motorImpulse=T.Clamp(this.m_motorImpulse+F,-D,D);F=this.m_motorImpulse-G;G=F*this.m_axis.x;E=F*this.m_axis.y;
B=F*this.m_a1;F=F*this.m_a2;z.x-=this.m_invMassA*G;z.y-=this.m_invMassA*E;p-=this.m_invIA*B;k.x+=this.m_invMassB*G;k.y+=this.m_invMassB*E;u+=this.m_invIB*F;
}B=this.m_perp.x*(k.x-z.x)+this.m_perp.y*(k.y-z.y)+this.m_s2*u-this.m_s1*p;E=u-p;if(this.m_enableLimit&&this.m_limitState!=X.e_inactiveLimit){D=this.m_axis.x*(k.x-z.x)+this.m_axis.y*(k.y-z.y)+this.m_a2*u-this.m_a1*p;
G=this.m_impulse.Copy();D=this.m_K.Solve33(new aj,-B,-E,-D);this.m_impulse.Add(D);if(this.m_limitState==X.e_atLowerLimit){this.m_impulse.z=T.Max(this.m_impulse.z,0);
}else{if(this.m_limitState==X.e_atUpperLimit){this.m_impulse.z=T.Min(this.m_impulse.z,0);}}B=-B-(this.m_impulse.z-G.z)*this.m_K.col3.x;E=-E-(this.m_impulse.z-G.z)*this.m_K.col3.y;
E=this.m_K.Solve22(new ac,B,E);E.x+=G.x;E.y+=G.y;this.m_impulse.x=E.x;this.m_impulse.y=E.y;D.x=this.m_impulse.x-G.x;D.y=this.m_impulse.y-G.y;D.z=this.m_impulse.z-G.z;
G=D.x*this.m_perp.x+D.z*this.m_axis.x;E=D.x*this.m_perp.y+D.z*this.m_axis.y;B=D.x*this.m_s1+D.y+D.z*this.m_a1;F=D.x*this.m_s2+D.y+D.z*this.m_a2;}else{D=this.m_K.Solve22(new ac,-B,-E);
this.m_impulse.x+=D.x;this.m_impulse.y+=D.y;G=D.x*this.m_perp.x;E=D.x*this.m_perp.y;B=D.x*this.m_s1+D.y;F=D.x*this.m_s2+D.y;}z.x-=this.m_invMassA*G;z.y-=this.m_invMassA*E;
p-=this.m_invIA*B;k.x+=this.m_invMassB*G;k.y+=this.m_invMassB*E;u+=this.m_invIB*F;A.m_linearVelocity.SetV(z);A.m_angularVelocity=p;y.m_linearVelocity.SetV(k);
y.m_angularVelocity=u;};ab.prototype.SolvePositionConstraints=function(){var H=this.m_bodyA,D=this.m_bodyB,A=H.m_sweep.c,B=H.m_sweep.a,u=D.m_sweep.c,p=D.m_sweep.a,y,L=0,I=0,E=0,K=L=y=0,G=0;
I=false;var F=0,z=ad.FromAngle(B),k=ad.FromAngle(p);y=z;G=this.m_localAnchor1.x-this.m_localCenterA.x;var N=this.m_localAnchor1.y-this.m_localCenterA.y;
L=y.col1.x*G+y.col2.x*N;N=y.col1.y*G+y.col2.y*N;G=L;y=k;k=this.m_localAnchor2.x-this.m_localCenterB.x;E=this.m_localAnchor2.y-this.m_localCenterB.y;L=y.col1.x*k+y.col2.x*E;
E=y.col1.y*k+y.col2.y*E;k=L;y=u.x+k-A.x-G;L=u.y+E-A.y-N;if(this.m_enableLimit){this.m_axis=T.MulMV(z,this.m_localXAxis1);this.m_a1=(y+G)*this.m_axis.y-(L+N)*this.m_axis.x;
this.m_a2=k*this.m_axis.y-E*this.m_axis.x;var M=this.m_axis.x*y+this.m_axis.y*L;if(T.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*af.b2_linearSlop){F=T.Clamp(M,-af.b2_maxLinearCorrection,af.b2_maxLinearCorrection);
K=T.Abs(M);I=true;}else{if(M<=this.m_lowerTranslation){F=T.Clamp(M-this.m_lowerTranslation+af.b2_linearSlop,-af.b2_maxLinearCorrection,0);K=this.m_lowerTranslation-M;
I=true;}else{if(M>=this.m_upperTranslation){F=T.Clamp(M-this.m_upperTranslation+af.b2_linearSlop,0,af.b2_maxLinearCorrection);K=M-this.m_upperTranslation;
I=true;}}}}this.m_perp=T.MulMV(z,this.m_localYAxis1);this.m_s1=(y+G)*this.m_perp.y-(L+N)*this.m_perp.x;this.m_s2=k*this.m_perp.y-E*this.m_perp.x;z=new aj;
N=this.m_perp.x*y+this.m_perp.y*L;k=p-B-this.m_refAngle;K=T.Max(K,T.Abs(N));G=T.Abs(k);if(I){I=this.m_invMassA;E=this.m_invMassB;y=this.m_invIA;L=this.m_invIB;
this.m_K.col1.x=I+E+y*this.m_s1*this.m_s1+L*this.m_s2*this.m_s2;this.m_K.col1.y=y*this.m_s1+L*this.m_s2;this.m_K.col1.z=y*this.m_s1*this.m_a1+L*this.m_s2*this.m_a2;
this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=y+L;this.m_K.col2.z=y*this.m_a1+L*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;
this.m_K.col3.z=I+E+y*this.m_a1*this.m_a1+L*this.m_a2*this.m_a2;this.m_K.Solve33(z,-N,-k,-F);}else{I=this.m_invMassA;E=this.m_invMassB;y=this.m_invIA;L=this.m_invIB;
F=y*this.m_s1+L*this.m_s2;M=y+L;this.m_K.col1.Set(I+E+y*this.m_s1*this.m_s1+L*this.m_s2*this.m_s2,F,0);this.m_K.col2.Set(F,M,0);F=this.m_K.Solve22(new ac,-N,-k);
z.x=F.x;z.y=F.y;z.z=0;}F=z.x*this.m_perp.x+z.z*this.m_axis.x;I=z.x*this.m_perp.y+z.z*this.m_axis.y;N=z.x*this.m_s1+z.y+z.z*this.m_a1;z=z.x*this.m_s2+z.y+z.z*this.m_a2;
A.x-=this.m_invMassA*F;A.y-=this.m_invMassA*I;B-=this.m_invIA*N;u.x+=this.m_invMassB*F;u.y+=this.m_invMassB*I;p+=this.m_invIB*z;H.m_sweep.a=B;D.m_sweep.a=p;
H.SynchronizeTransform();D.SynchronizeTransform();return K<=af.b2_linearSlop&&G<=af.b2_angularSlop;};j.inherit(t,j.Dynamics.Joints.b2JointDef);t.prototype.__super=j.Dynamics.Joints.b2JointDef.prototype;
t.b2PrismaticJointDef=function(){j.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new ac;this.localAnchorB=new ac;this.localAxisA=new ac;
};t.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=X.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;
this.enableLimit=false;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=false;this.motorSpeed=this.maxMotorForce=0;};t.prototype.Initialize=function(y,u,k,p){this.bodyA=y;
this.bodyB=u;this.localAnchorA=this.bodyA.GetLocalPoint(k);this.localAnchorB=this.bodyB.GetLocalPoint(k);this.localAxisA=this.bodyA.GetLocalVector(p);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle();
};j.inherit(ag,j.Dynamics.Joints.b2Joint);ag.prototype.__super=j.Dynamics.Joints.b2Joint.prototype;ag.b2PulleyJoint=function(){j.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);
this.m_groundAnchor1=new ac;this.m_groundAnchor2=new ac;this.m_localAnchor1=new ac;this.m_localAnchor2=new ac;this.m_u1=new ac;this.m_u2=new ac;};ag.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
};ag.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);};ag.prototype.GetReactionForce=function(k){if(k===g){k=0;}return new ac(k*this.m_impulse*this.m_u2.x,k*this.m_impulse*this.m_u2.y);
};ag.prototype.GetReactionTorque=function(){return 0;};ag.prototype.GetGroundAnchorA=function(){var k=this.m_ground.m_xf.position.Copy();k.Add(this.m_groundAnchor1);
return k;};ag.prototype.GetGroundAnchorB=function(){var k=this.m_ground.m_xf.position.Copy();k.Add(this.m_groundAnchor2);return k;};ag.prototype.GetLength1=function(){var p=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),k=p.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x);
p=p.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(k*k+p*p);};ag.prototype.GetLength2=function(){var p=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),k=p.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x);
p=p.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(k*k+p*p);};ag.prototype.GetRatio=function(){return this.m_ratio;};ag.prototype.b2PulleyJoint=function(k){this.__super.b2Joint.call(this,k);
this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=k.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=k.groundAnchorA.y-this.m_ground.m_xf.position.y;
this.m_groundAnchor2.x=k.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=k.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(k.localAnchorA);
this.m_localAnchor2.SetV(k.localAnchorB);this.m_ratio=k.ratio;this.m_constant=k.lengthA+this.m_ratio*k.lengthB;this.m_maxLength1=T.Min(k.maxLengthA,this.m_constant-this.m_ratio*ag.b2_minPulleyLength);
this.m_maxLength2=T.Min(k.maxLengthB,(this.m_constant-ag.b2_minPulleyLength)/this.m_ratio);this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0;};
ag.prototype.InitVelocityConstraints=function(D){var A=this.m_bodyA,y=this.m_bodyB,z;z=A.m_xf.R;var p=this.m_localAnchor1.x-A.m_sweep.localCenter.x,k=this.m_localAnchor1.y-A.m_sweep.localCenter.y,u=z.col1.x*p+z.col2.x*k;
k=z.col1.y*p+z.col2.y*k;p=u;z=y.m_xf.R;var G=this.m_localAnchor2.x-y.m_sweep.localCenter.x,E=this.m_localAnchor2.y-y.m_sweep.localCenter.y;u=z.col1.x*G+z.col2.x*E;
E=z.col1.y*G+z.col2.y*E;G=u;z=y.m_sweep.c.x+G;u=y.m_sweep.c.y+E;var B=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,F=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;
this.m_u1.Set(A.m_sweep.c.x+p-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),A.m_sweep.c.y+k-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));
this.m_u2.Set(z-B,u-F);z=this.m_u1.Length();u=this.m_u2.Length();z>af.b2_linearSlop?this.m_u1.Multiply(1/z):this.m_u1.SetZero();u>af.b2_linearSlop?this.m_u2.Multiply(1/u):this.m_u2.SetZero();
if(this.m_constant-z-this.m_ratio*u>0){this.m_state=X.e_inactiveLimit;this.m_impulse=0;}else{this.m_state=X.e_atUpperLimit;}if(z<this.m_maxLength1){this.m_limitState1=X.e_inactiveLimit;
this.m_limitImpulse1=0;}else{this.m_limitState1=X.e_atUpperLimit;}if(u<this.m_maxLength2){this.m_limitState2=X.e_inactiveLimit;this.m_limitImpulse2=0;}else{this.m_limitState2=X.e_atUpperLimit;
}z=p*this.m_u1.y-k*this.m_u1.x;u=G*this.m_u2.y-E*this.m_u2.x;this.m_limitMass1=A.m_invMass+A.m_invI*z*z;this.m_limitMass2=y.m_invMass+y.m_invI*u*u;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;
this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;if(D.warmStarting){this.m_impulse*=D.dtRatio;
this.m_limitImpulse1*=D.dtRatio;this.m_limitImpulse2*=D.dtRatio;D=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x;z=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y;
u=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x;B=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;A.m_linearVelocity.x+=A.m_invMass*D;
A.m_linearVelocity.y+=A.m_invMass*z;A.m_angularVelocity+=A.m_invI*(p*z-k*D);y.m_linearVelocity.x+=y.m_invMass*u;y.m_linearVelocity.y+=y.m_invMass*B;y.m_angularVelocity+=y.m_invI*(G*B-E*u);
}else{this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0;}};ag.prototype.SolveVelocityConstraints=function(){var D=this.m_bodyA,A=this.m_bodyB,y;
y=D.m_xf.R;var z=this.m_localAnchor1.x-D.m_sweep.localCenter.x,p=this.m_localAnchor1.y-D.m_sweep.localCenter.y,k=y.col1.x*z+y.col2.x*p;p=y.col1.y*z+y.col2.y*p;
z=k;y=A.m_xf.R;var u=this.m_localAnchor2.x-A.m_sweep.localCenter.x,F=this.m_localAnchor2.y-A.m_sweep.localCenter.y;k=y.col1.x*u+y.col2.x*F;F=y.col1.y*u+y.col2.y*F;
u=k;var E=k=y=0,B=0;y=B=y=B=E=k=y=0;if(this.m_state==X.e_atUpperLimit){y=D.m_linearVelocity.x+-D.m_angularVelocity*p;k=D.m_linearVelocity.y+D.m_angularVelocity*z;
E=A.m_linearVelocity.x+-A.m_angularVelocity*F;B=A.m_linearVelocity.y+A.m_angularVelocity*u;y=-(this.m_u1.x*y+this.m_u1.y*k)-this.m_ratio*(this.m_u2.x*E+this.m_u2.y*B);
B=this.m_pulleyMass*-y;y=this.m_impulse;this.m_impulse=T.Max(0,this.m_impulse+B);B=this.m_impulse-y;y=-B*this.m_u1.x;k=-B*this.m_u1.y;E=-this.m_ratio*B*this.m_u2.x;
B=-this.m_ratio*B*this.m_u2.y;D.m_linearVelocity.x+=D.m_invMass*y;D.m_linearVelocity.y+=D.m_invMass*k;D.m_angularVelocity+=D.m_invI*(z*k-p*y);A.m_linearVelocity.x+=A.m_invMass*E;
A.m_linearVelocity.y+=A.m_invMass*B;A.m_angularVelocity+=A.m_invI*(u*B-F*E);}if(this.m_limitState1==X.e_atUpperLimit){y=D.m_linearVelocity.x+-D.m_angularVelocity*p;
k=D.m_linearVelocity.y+D.m_angularVelocity*z;y=-(this.m_u1.x*y+this.m_u1.y*k);B=-this.m_limitMass1*y;y=this.m_limitImpulse1;this.m_limitImpulse1=T.Max(0,this.m_limitImpulse1+B);
B=this.m_limitImpulse1-y;y=-B*this.m_u1.x;k=-B*this.m_u1.y;D.m_linearVelocity.x+=D.m_invMass*y;D.m_linearVelocity.y+=D.m_invMass*k;D.m_angularVelocity+=D.m_invI*(z*k-p*y);
}if(this.m_limitState2==X.e_atUpperLimit){E=A.m_linearVelocity.x+-A.m_angularVelocity*F;B=A.m_linearVelocity.y+A.m_angularVelocity*u;y=-(this.m_u2.x*E+this.m_u2.y*B);
B=-this.m_limitMass2*y;y=this.m_limitImpulse2;this.m_limitImpulse2=T.Max(0,this.m_limitImpulse2+B);B=this.m_limitImpulse2-y;E=-B*this.m_u2.x;B=-B*this.m_u2.y;
A.m_linearVelocity.x+=A.m_invMass*E;A.m_linearVelocity.y+=A.m_invMass*B;A.m_angularVelocity+=A.m_invI*(u*B-F*E);}};ag.prototype.SolvePositionConstraints=function(){var H=this.m_bodyA,D=this.m_bodyB,A,B=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,u=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,p=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,y=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,L=0,I=0,E=0,K=0,G=A=0,F=0,z=0,k=G=z=A=G=A=0;
if(this.m_state==X.e_atUpperLimit){A=H.m_xf.R;L=this.m_localAnchor1.x-H.m_sweep.localCenter.x;I=this.m_localAnchor1.y-H.m_sweep.localCenter.y;G=A.col1.x*L+A.col2.x*I;
I=A.col1.y*L+A.col2.y*I;L=G;A=D.m_xf.R;E=this.m_localAnchor2.x-D.m_sweep.localCenter.x;K=this.m_localAnchor2.y-D.m_sweep.localCenter.y;G=A.col1.x*E+A.col2.x*K;
K=A.col1.y*E+A.col2.y*K;E=G;A=H.m_sweep.c.x+L;G=H.m_sweep.c.y+I;F=D.m_sweep.c.x+E;z=D.m_sweep.c.y+K;this.m_u1.Set(A-B,G-u);this.m_u2.Set(F-p,z-y);A=this.m_u1.Length();
G=this.m_u2.Length();A>af.b2_linearSlop?this.m_u1.Multiply(1/A):this.m_u1.SetZero();G>af.b2_linearSlop?this.m_u2.Multiply(1/G):this.m_u2.SetZero();A=this.m_constant-A-this.m_ratio*G;
k=T.Max(k,-A);A=T.Clamp(A+af.b2_linearSlop,-af.b2_maxLinearCorrection,0);z=-this.m_pulleyMass*A;A=-z*this.m_u1.x;G=-z*this.m_u1.y;F=-this.m_ratio*z*this.m_u2.x;
z=-this.m_ratio*z*this.m_u2.y;H.m_sweep.c.x+=H.m_invMass*A;H.m_sweep.c.y+=H.m_invMass*G;H.m_sweep.a+=H.m_invI*(L*G-I*A);D.m_sweep.c.x+=D.m_invMass*F;D.m_sweep.c.y+=D.m_invMass*z;
D.m_sweep.a+=D.m_invI*(E*z-K*F);H.SynchronizeTransform();D.SynchronizeTransform();}if(this.m_limitState1==X.e_atUpperLimit){A=H.m_xf.R;L=this.m_localAnchor1.x-H.m_sweep.localCenter.x;
I=this.m_localAnchor1.y-H.m_sweep.localCenter.y;G=A.col1.x*L+A.col2.x*I;I=A.col1.y*L+A.col2.y*I;L=G;A=H.m_sweep.c.x+L;G=H.m_sweep.c.y+I;this.m_u1.Set(A-B,G-u);
A=this.m_u1.Length();if(A>af.b2_linearSlop){this.m_u1.x*=1/A;this.m_u1.y*=1/A;}else{this.m_u1.SetZero();}A=this.m_maxLength1-A;k=T.Max(k,-A);A=T.Clamp(A+af.b2_linearSlop,-af.b2_maxLinearCorrection,0);
z=-this.m_limitMass1*A;A=-z*this.m_u1.x;G=-z*this.m_u1.y;H.m_sweep.c.x+=H.m_invMass*A;H.m_sweep.c.y+=H.m_invMass*G;H.m_sweep.a+=H.m_invI*(L*G-I*A);H.SynchronizeTransform();
}if(this.m_limitState2==X.e_atUpperLimit){A=D.m_xf.R;E=this.m_localAnchor2.x-D.m_sweep.localCenter.x;K=this.m_localAnchor2.y-D.m_sweep.localCenter.y;G=A.col1.x*E+A.col2.x*K;
K=A.col1.y*E+A.col2.y*K;E=G;F=D.m_sweep.c.x+E;z=D.m_sweep.c.y+K;this.m_u2.Set(F-p,z-y);G=this.m_u2.Length();if(G>af.b2_linearSlop){this.m_u2.x*=1/G;this.m_u2.y*=1/G;
}else{this.m_u2.SetZero();}A=this.m_maxLength2-G;k=T.Max(k,-A);A=T.Clamp(A+af.b2_linearSlop,-af.b2_maxLinearCorrection,0);z=-this.m_limitMass2*A;F=-z*this.m_u2.x;
z=-z*this.m_u2.y;D.m_sweep.c.x+=D.m_invMass*F;D.m_sweep.c.y+=D.m_invMass*z;D.m_sweep.a+=D.m_invI*(E*z-K*F);D.SynchronizeTransform();}return k<af.b2_linearSlop;
};j.postDefs.push(function(){j.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2;});j.inherit(r,j.Dynamics.Joints.b2JointDef);r.prototype.__super=j.Dynamics.Joints.b2JointDef.prototype;
r.b2PulleyJointDef=function(){j.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new ac;this.groundAnchorB=new ac;this.localAnchorA=new ac;
this.localAnchorB=new ac;};r.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=X.e_pulleyJoint;this.groundAnchorA.Set(-1,1);
this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0;this.ratio=1;
this.collideConnected=true;};r.prototype.Initialize=function(A,u,k,p,z,y,B){if(B===g){B=0;}this.bodyA=A;this.bodyB=u;this.groundAnchorA.SetV(k);this.groundAnchorB.SetV(p);
this.localAnchorA=this.bodyA.GetLocalPoint(z);this.localAnchorB=this.bodyB.GetLocalPoint(y);A=z.x-k.x;k=z.y-k.y;this.lengthA=Math.sqrt(A*A+k*k);k=y.x-p.x;
p=y.y-p.y;this.lengthB=Math.sqrt(k*k+p*p);this.ratio=B;B=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=B-this.ratio*ag.b2_minPulleyLength;this.maxLengthB=(B-ag.b2_minPulleyLength)/this.ratio;
};j.inherit(v,j.Dynamics.Joints.b2Joint);v.prototype.__super=j.Dynamics.Joints.b2Joint.prototype;v.b2RevoluteJoint=function(){j.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);
this.K=new ad;this.K1=new ad;this.K2=new ad;this.K3=new ad;this.impulse3=new aj;this.impulse2=new ac;this.reduced=new ac;this.m_localAnchor1=new ac;this.m_localAnchor2=new ac;
this.m_impulse=new aj;this.m_mass=new P;};v.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);};v.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);
};v.prototype.GetReactionForce=function(k){if(k===g){k=0;}return new ac(k*this.m_impulse.x,k*this.m_impulse.y);};v.prototype.GetReactionTorque=function(k){if(k===g){k=0;
}return k*this.m_impulse.z;};v.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle;};v.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity;
};v.prototype.IsLimitEnabled=function(){return this.m_enableLimit;};v.prototype.EnableLimit=function(k){this.m_enableLimit=k;};v.prototype.GetLowerLimit=function(){return this.m_lowerAngle;
};v.prototype.GetUpperLimit=function(){return this.m_upperAngle;};v.prototype.SetLimits=function(p,k){if(p===g){p=0;}if(k===g){k=0;}this.m_lowerAngle=p;
this.m_upperAngle=k;};v.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);return this.m_enableMotor;};v.prototype.EnableMotor=function(k){this.m_enableMotor=k;
};v.prototype.SetMotorSpeed=function(k){if(k===g){k=0;}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=k;};v.prototype.GetMotorSpeed=function(){return this.m_motorSpeed;
};v.prototype.SetMaxMotorTorque=function(k){if(k===g){k=0;}this.m_maxMotorTorque=k;};v.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque;
};v.prototype.b2RevoluteJoint=function(k){this.__super.b2Joint.call(this,k);this.m_localAnchor1.SetV(k.localAnchorA);this.m_localAnchor2.SetV(k.localAnchorB);
this.m_referenceAngle=k.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=k.lowerAngle;this.m_upperAngle=k.upperAngle;this.m_maxMotorTorque=k.maxMotorTorque;
this.m_motorSpeed=k.motorSpeed;this.m_enableLimit=k.enableLimit;this.m_enableMotor=k.enableMotor;this.m_limitState=X.e_inactiveLimit;};v.prototype.InitVelocityConstraints=function(E){var A=this.m_bodyA,y=this.m_bodyB,z,p=0;
z=A.m_xf.R;var k=this.m_localAnchor1.x-A.m_sweep.localCenter.x,u=this.m_localAnchor1.y-A.m_sweep.localCenter.y;p=z.col1.x*k+z.col2.x*u;u=z.col1.y*k+z.col2.y*u;
k=p;z=y.m_xf.R;var H=this.m_localAnchor2.x-y.m_sweep.localCenter.x,F=this.m_localAnchor2.y-y.m_sweep.localCenter.y;p=z.col1.x*H+z.col2.x*F;F=z.col1.y*H+z.col2.y*F;
H=p;z=A.m_invMass;p=y.m_invMass;var B=A.m_invI,G=y.m_invI;this.m_mass.col1.x=z+p+u*u*B+F*F*G;this.m_mass.col2.x=-u*k*B-F*H*G;this.m_mass.col3.x=-u*B-F*G;
this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=z+p+k*k*B+H*H*G;this.m_mass.col3.y=k*B+H*G;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;
this.m_mass.col3.z=B+G;this.m_motorMass=1/(B+G);if(this.m_enableMotor==false){this.m_motorImpulse=0;}if(this.m_enableLimit){var D=y.m_sweep.a-A.m_sweep.a-this.m_referenceAngle;
if(T.Abs(this.m_upperAngle-this.m_lowerAngle)<2*af.b2_angularSlop){this.m_limitState=X.e_equalLimits;}else{if(D<=this.m_lowerAngle){if(this.m_limitState!=X.e_atLowerLimit){this.m_impulse.z=0;
}this.m_limitState=X.e_atLowerLimit;}else{if(D>=this.m_upperAngle){if(this.m_limitState!=X.e_atUpperLimit){this.m_impulse.z=0;}this.m_limitState=X.e_atUpperLimit;
}else{this.m_limitState=X.e_inactiveLimit;this.m_impulse.z=0;}}}}else{this.m_limitState=X.e_inactiveLimit;}if(E.warmStarting){this.m_impulse.x*=E.dtRatio;
this.m_impulse.y*=E.dtRatio;this.m_motorImpulse*=E.dtRatio;E=this.m_impulse.x;D=this.m_impulse.y;A.m_linearVelocity.x-=z*E;A.m_linearVelocity.y-=z*D;A.m_angularVelocity-=B*(k*D-u*E+this.m_motorImpulse+this.m_impulse.z);
y.m_linearVelocity.x+=p*E;y.m_linearVelocity.y+=p*D;y.m_angularVelocity+=G*(H*D-F*E+this.m_motorImpulse+this.m_impulse.z);}else{this.m_impulse.SetZero();
this.m_motorImpulse=0;}};v.prototype.SolveVelocityConstraints=function(H){var D=this.m_bodyA,A=this.m_bodyB,B=0,u=B=0,p=0,y=0,L=0,I=D.m_linearVelocity,E=D.m_angularVelocity,K=A.m_linearVelocity,G=A.m_angularVelocity,F=D.m_invMass,z=A.m_invMass,k=D.m_invI,N=A.m_invI;
if(this.m_enableMotor&&this.m_limitState!=X.e_equalLimits){u=this.m_motorMass*-(G-E-this.m_motorSpeed);p=this.m_motorImpulse;y=H.dt*this.m_maxMotorTorque;
this.m_motorImpulse=T.Clamp(this.m_motorImpulse+u,-y,y);u=this.m_motorImpulse-p;E-=k*u;G+=N*u;}if(this.m_enableLimit&&this.m_limitState!=X.e_inactiveLimit){H=D.m_xf.R;
u=this.m_localAnchor1.x-D.m_sweep.localCenter.x;p=this.m_localAnchor1.y-D.m_sweep.localCenter.y;B=H.col1.x*u+H.col2.x*p;p=H.col1.y*u+H.col2.y*p;u=B;H=A.m_xf.R;
y=this.m_localAnchor2.x-A.m_sweep.localCenter.x;L=this.m_localAnchor2.y-A.m_sweep.localCenter.y;B=H.col1.x*y+H.col2.x*L;L=H.col1.y*y+H.col2.y*L;y=B;H=K.x+-G*L-I.x- -E*p;
var M=K.y+G*y-I.y-E*u;this.m_mass.Solve33(this.impulse3,-H,-M,-(G-E));if(this.m_limitState==X.e_equalLimits){this.m_impulse.Add(this.impulse3);}else{if(this.m_limitState==X.e_atLowerLimit){B=this.m_impulse.z+this.impulse3.z;
if(B<0){this.m_mass.Solve22(this.reduced,-H,-M);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;
this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0;}}else{if(this.m_limitState==X.e_atUpperLimit){B=this.m_impulse.z+this.impulse3.z;if(B>0){this.m_mass.Solve22(this.reduced,-H,-M);
this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;
this.m_impulse.z=0;}}}}I.x-=F*this.impulse3.x;I.y-=F*this.impulse3.y;E-=k*(u*this.impulse3.y-p*this.impulse3.x+this.impulse3.z);K.x+=z*this.impulse3.x;
K.y+=z*this.impulse3.y;G+=N*(y*this.impulse3.y-L*this.impulse3.x+this.impulse3.z);}else{H=D.m_xf.R;u=this.m_localAnchor1.x-D.m_sweep.localCenter.x;p=this.m_localAnchor1.y-D.m_sweep.localCenter.y;
B=H.col1.x*u+H.col2.x*p;p=H.col1.y*u+H.col2.y*p;u=B;H=A.m_xf.R;y=this.m_localAnchor2.x-A.m_sweep.localCenter.x;L=this.m_localAnchor2.y-A.m_sweep.localCenter.y;
B=H.col1.x*y+H.col2.x*L;L=H.col1.y*y+H.col2.y*L;y=B;this.m_mass.Solve22(this.impulse2,-(K.x+-G*L-I.x- -E*p),-(K.y+G*y-I.y-E*u));this.m_impulse.x+=this.impulse2.x;
this.m_impulse.y+=this.impulse2.y;I.x-=F*this.impulse2.x;I.y-=F*this.impulse2.y;E-=k*(u*this.impulse2.y-p*this.impulse2.x);K.x+=z*this.impulse2.x;K.y+=z*this.impulse2.y;
G+=N*(y*this.impulse2.y-L*this.impulse2.x);}D.m_linearVelocity.SetV(I);D.m_angularVelocity=E;A.m_linearVelocity.SetV(K);A.m_angularVelocity=G;};v.prototype.SolvePositionConstraints=function(){var H=0,D,A=this.m_bodyA,B=this.m_bodyB,u=0,p=D=0,y=0,L=0;
if(this.m_enableLimit&&this.m_limitState!=X.e_inactiveLimit){H=B.m_sweep.a-A.m_sweep.a-this.m_referenceAngle;var I=0;if(this.m_limitState==X.e_equalLimits){H=T.Clamp(H-this.m_lowerAngle,-af.b2_maxAngularCorrection,af.b2_maxAngularCorrection);
I=-this.m_motorMass*H;u=T.Abs(H);}else{if(this.m_limitState==X.e_atLowerLimit){H=H-this.m_lowerAngle;u=-H;H=T.Clamp(H+af.b2_angularSlop,-af.b2_maxAngularCorrection,0);
I=-this.m_motorMass*H;}else{if(this.m_limitState==X.e_atUpperLimit){u=H=H-this.m_upperAngle;H=T.Clamp(H-af.b2_angularSlop,0,af.b2_maxAngularCorrection);
I=-this.m_motorMass*H;}}}A.m_sweep.a-=A.m_invI*I;B.m_sweep.a+=B.m_invI*I;A.SynchronizeTransform();B.SynchronizeTransform();}D=A.m_xf.R;I=this.m_localAnchor1.x-A.m_sweep.localCenter.x;
H=this.m_localAnchor1.y-A.m_sweep.localCenter.y;p=D.col1.x*I+D.col2.x*H;H=D.col1.y*I+D.col2.y*H;I=p;D=B.m_xf.R;var E=this.m_localAnchor2.x-B.m_sweep.localCenter.x,K=this.m_localAnchor2.y-B.m_sweep.localCenter.y;
p=D.col1.x*E+D.col2.x*K;K=D.col1.y*E+D.col2.y*K;E=p;y=B.m_sweep.c.x+E-A.m_sweep.c.x-I;L=B.m_sweep.c.y+K-A.m_sweep.c.y-H;var G=y*y+L*L;D=Math.sqrt(G);p=A.m_invMass;
var F=B.m_invMass,z=A.m_invI,k=B.m_invI,M=10*af.b2_linearSlop;if(G>M*M){G=1/(p+F);y=G*-y;L=G*-L;A.m_sweep.c.x-=0.5*p*y;A.m_sweep.c.y-=0.5*p*L;B.m_sweep.c.x+=0.5*F*y;
B.m_sweep.c.y+=0.5*F*L;y=B.m_sweep.c.x+E-A.m_sweep.c.x-I;L=B.m_sweep.c.y+K-A.m_sweep.c.y-H;}this.K1.col1.x=p+F;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=p+F;
this.K2.col1.x=z*H*H;this.K2.col2.x=-z*I*H;this.K2.col1.y=-z*I*H;this.K2.col2.y=z*I*I;this.K3.col1.x=k*K*K;this.K3.col2.x=-k*E*K;this.K3.col1.y=-k*E*K;
this.K3.col2.y=k*E*E;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(v.tImpulse,-y,-L);y=v.tImpulse.x;L=v.tImpulse.y;A.m_sweep.c.x-=A.m_invMass*y;
A.m_sweep.c.y-=A.m_invMass*L;A.m_sweep.a-=A.m_invI*(I*L-H*y);B.m_sweep.c.x+=B.m_invMass*y;B.m_sweep.c.y+=B.m_invMass*L;B.m_sweep.a+=B.m_invI*(E*L-K*y);
A.SynchronizeTransform();B.SynchronizeTransform();return D<=af.b2_linearSlop&&u<=af.b2_angularSlop;};j.postDefs.push(function(){j.Dynamics.Joints.b2RevoluteJoint.tImpulse=new ac;
});j.inherit(q,j.Dynamics.Joints.b2JointDef);q.prototype.__super=j.Dynamics.Joints.b2JointDef.prototype;q.b2RevoluteJointDef=function(){j.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);
this.localAnchorA=new ac;this.localAnchorB=new ac;};q.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=X.e_revoluteJoint;
this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=false;
};q.prototype.Initialize=function(u,p,k){this.bodyA=u;this.bodyB=p;this.localAnchorA=this.bodyA.GetLocalPoint(k);this.localAnchorB=this.bodyB.GetLocalPoint(k);
this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle();};j.inherit(am,j.Dynamics.Joints.b2Joint);am.prototype.__super=j.Dynamics.Joints.b2Joint.prototype;
am.b2WeldJoint=function(){j.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new ac;this.m_localAnchorB=new ac;this.m_impulse=new aj;
this.m_mass=new P;};am.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA);};am.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB);
};am.prototype.GetReactionForce=function(k){if(k===g){k=0;}return new ac(k*this.m_impulse.x,k*this.m_impulse.y);};am.prototype.GetReactionTorque=function(k){if(k===g){k=0;
}return k*this.m_impulse.z;};am.prototype.b2WeldJoint=function(k){this.__super.b2Joint.call(this,k);this.m_localAnchorA.SetV(k.localAnchorA);this.m_localAnchorB.SetV(k.localAnchorB);
this.m_referenceAngle=k.referenceAngle;this.m_impulse.SetZero();this.m_mass=new P;};am.prototype.InitVelocityConstraints=function(D){var A,y=0,z=this.m_bodyA,p=this.m_bodyB;
A=z.m_xf.R;var k=this.m_localAnchorA.x-z.m_sweep.localCenter.x,u=this.m_localAnchorA.y-z.m_sweep.localCenter.y;y=A.col1.x*k+A.col2.x*u;u=A.col1.y*k+A.col2.y*u;
k=y;A=p.m_xf.R;var G=this.m_localAnchorB.x-p.m_sweep.localCenter.x,E=this.m_localAnchorB.y-p.m_sweep.localCenter.y;y=A.col1.x*G+A.col2.x*E;E=A.col1.y*G+A.col2.y*E;
G=y;A=z.m_invMass;y=p.m_invMass;var B=z.m_invI,F=p.m_invI;this.m_mass.col1.x=A+y+u*u*B+E*E*F;this.m_mass.col2.x=-u*k*B-E*G*F;this.m_mass.col3.x=-u*B-E*F;
this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=A+y+k*k*B+G*G*F;this.m_mass.col3.y=k*B+G*F;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;
this.m_mass.col3.z=B+F;if(D.warmStarting){this.m_impulse.x*=D.dtRatio;this.m_impulse.y*=D.dtRatio;this.m_impulse.z*=D.dtRatio;z.m_linearVelocity.x-=A*this.m_impulse.x;
z.m_linearVelocity.y-=A*this.m_impulse.y;z.m_angularVelocity-=B*(k*this.m_impulse.y-u*this.m_impulse.x+this.m_impulse.z);p.m_linearVelocity.x+=y*this.m_impulse.x;
p.m_linearVelocity.y+=y*this.m_impulse.y;p.m_angularVelocity+=F*(G*this.m_impulse.y-E*this.m_impulse.x+this.m_impulse.z);}else{this.m_impulse.SetZero();
}};am.prototype.SolveVelocityConstraints=function(){var L,G=0,E=this.m_bodyA,F=this.m_bodyB,A=E.m_linearVelocity,z=E.m_angularVelocity,B=F.m_linearVelocity,O=F.m_angularVelocity,M=E.m_invMass,H=F.m_invMass,N=E.m_invI,K=F.m_invI;
L=E.m_xf.R;var I=this.m_localAnchorA.x-E.m_sweep.localCenter.x,D=this.m_localAnchorA.y-E.m_sweep.localCenter.y;G=L.col1.x*I+L.col2.x*D;D=L.col1.y*I+L.col2.y*D;
I=G;L=F.m_xf.R;var y=this.m_localAnchorB.x-F.m_sweep.localCenter.x,u=this.m_localAnchorB.y-F.m_sweep.localCenter.y;G=L.col1.x*y+L.col2.x*u;u=L.col1.y*y+L.col2.y*u;
y=G;L=B.x-O*u-A.x+z*D;G=B.y+O*y-A.y-z*I;var k=O-z,p=new aj;this.m_mass.Solve33(p,-L,-G,-k);this.m_impulse.Add(p);A.x-=M*p.x;A.y-=M*p.y;z-=N*(I*p.y-D*p.x+p.z);
B.x+=H*p.x;B.y+=H*p.y;O+=K*(y*p.y-u*p.x+p.z);E.m_angularVelocity=z;F.m_angularVelocity=O;};am.prototype.SolvePositionConstraints=function(){var H,D=0,A=this.m_bodyA,B=this.m_bodyB;
H=A.m_xf.R;var u=this.m_localAnchorA.x-A.m_sweep.localCenter.x,p=this.m_localAnchorA.y-A.m_sweep.localCenter.y;D=H.col1.x*u+H.col2.x*p;p=H.col1.y*u+H.col2.y*p;
u=D;H=B.m_xf.R;var y=this.m_localAnchorB.x-B.m_sweep.localCenter.x,L=this.m_localAnchorB.y-B.m_sweep.localCenter.y;D=H.col1.x*y+H.col2.x*L;L=H.col1.y*y+H.col2.y*L;
y=D;H=A.m_invMass;D=B.m_invMass;var I=A.m_invI,E=B.m_invI,K=B.m_sweep.c.x+y-A.m_sweep.c.x-u,G=B.m_sweep.c.y+L-A.m_sweep.c.y-p,F=B.m_sweep.a-A.m_sweep.a-this.m_referenceAngle,z=10*af.b2_linearSlop,k=Math.sqrt(K*K+G*G),M=T.Abs(F);
if(k>z){I*=1;E*=1;}this.m_mass.col1.x=H+D+p*p*I+L*L*E;this.m_mass.col2.x=-p*u*I-L*y*E;this.m_mass.col3.x=-p*I-L*E;this.m_mass.col1.y=this.m_mass.col2.x;
this.m_mass.col2.y=H+D+u*u*I+y*y*E;this.m_mass.col3.y=u*I+y*E;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=I+E;
z=new aj;this.m_mass.Solve33(z,-K,-G,-F);A.m_sweep.c.x-=H*z.x;A.m_sweep.c.y-=H*z.y;A.m_sweep.a-=I*(u*z.y-p*z.x+z.z);B.m_sweep.c.x+=D*z.x;B.m_sweep.c.y+=D*z.y;
B.m_sweep.a+=E*(y*z.y-L*z.x+z.z);A.SynchronizeTransform();B.SynchronizeTransform();return k<=af.b2_linearSlop&&M<=af.b2_angularSlop;};j.inherit(i,j.Dynamics.Joints.b2JointDef);
i.prototype.__super=j.Dynamics.Joints.b2JointDef.prototype;i.b2WeldJointDef=function(){j.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new ac;
this.localAnchorB=new ac;};i.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=X.e_weldJoint;this.referenceAngle=0;};i.prototype.Initialize=function(u,p,k){this.bodyA=u;
this.bodyB=p;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(k));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(k));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle();
};})();(function(){var i=j.Dynamics.b2DebugDraw;i.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;
var k=this;this.m_sprite={graphics:{clear:function(){k.m_ctx.clearRect(0,0,k.m_ctx.canvas.width,k.m_ctx.canvas.height);}}};};i.prototype._color=function(l,k){return"rgba("+((l&16711680)>>16)+","+((l&65280)>>8)+","+(l&255)+","+k+")";
};i.prototype.b2DebugDraw=function(){this.m_drawFlags=0;};i.prototype.SetFlags=function(k){if(k===g){k=0;}this.m_drawFlags=k;};i.prototype.GetFlags=function(){return this.m_drawFlags;
};i.prototype.AppendFlags=function(k){if(k===g){k=0;}this.m_drawFlags|=k;};i.prototype.ClearFlags=function(k){if(k===g){k=0;}this.m_drawFlags&=~k;};i.prototype.SetSprite=function(k){this.m_ctx=k;
};i.prototype.GetSprite=function(){return this.m_ctx;};i.prototype.SetDrawScale=function(k){if(k===g){k=0;}this.m_drawScale=k;};i.prototype.GetDrawScale=function(){return this.m_drawScale;
};i.prototype.SetLineThickness=function(k){if(k===g){k=0;}this.m_lineThickness=k;this.m_ctx.strokeWidth=k;};i.prototype.GetLineThickness=function(){return this.m_lineThickness;
};i.prototype.SetAlpha=function(k){if(k===g){k=0;}this.m_alpha=k;};i.prototype.GetAlpha=function(){return this.m_alpha;};i.prototype.SetFillAlpha=function(k){if(k===g){k=0;
}this.m_fillAlpha=k;};i.prototype.GetFillAlpha=function(){return this.m_fillAlpha;};i.prototype.SetXFormScale=function(k){if(k===g){k=0;}this.m_xformScale=k;
};i.prototype.GetXFormScale=function(){return this.m_xformScale;};i.prototype.DrawPolygon=function(n,m,o){if(m){var l=this.m_ctx,k=this.m_drawScale;l.beginPath();
l.strokeStyle=this._color(o.color,this.m_alpha);l.moveTo(n[0].x*k,n[0].y*k);for(o=1;o<m;o++){l.lineTo(n[o].x*k,n[o].y*k);}l.lineTo(n[0].x*k,n[0].y*k);l.closePath();
l.stroke();}};i.prototype.DrawSolidPolygon=function(n,m,o){if(m){var l=this.m_ctx,k=this.m_drawScale;l.beginPath();l.strokeStyle=this._color(o.color,this.m_alpha);
l.fillStyle=this._color(o.color,this.m_fillAlpha);l.moveTo(n[0].x*k,n[0].y*k);for(o=1;o<m;o++){l.lineTo(n[o].x*k,n[o].y*k);}l.lineTo(n[0].x*k,n[0].y*k);
l.closePath();l.fill();l.stroke();}};i.prototype.DrawCircle=function(n,m,o){if(m){var l=this.m_ctx,k=this.m_drawScale;l.beginPath();l.strokeStyle=this._color(o.color,this.m_alpha);
l.arc(n.x*k,n.y*k,m*k,0,Math.PI*2,true);l.closePath();l.stroke();}};i.prototype.DrawSolidCircle=function(o,m,s,l){if(m){var k=this.m_ctx,n=this.m_drawScale,q=o.x*n,r=o.y*n;
k.moveTo(0,0);k.beginPath();k.strokeStyle=this._color(l.color,this.m_alpha);k.fillStyle=this._color(l.color,this.m_fillAlpha);k.arc(q,r,m*n,0,Math.PI*2,true);
k.moveTo(q,r);k.lineTo((o.x+s.x*m)*n,(o.y+s.y*m)*n);k.closePath();k.fill();k.stroke();}};i.prototype.DrawSegment=function(n,m,o){var l=this.m_ctx,k=this.m_drawScale;
l.strokeStyle=this._color(o.color,this.m_alpha);l.beginPath();l.moveTo(n.x*k,n.y*k);l.lineTo(m.x*k,m.y*k);l.closePath();l.stroke();};i.prototype.DrawTransform=function(l){var k=this.m_ctx,m=this.m_drawScale;
k.beginPath();k.strokeStyle=this._color(16711680,this.m_alpha);k.moveTo(l.position.x*m,l.position.y*m);k.lineTo((l.position.x+this.m_xformScale*l.R.col1.x)*m,(l.position.y+this.m_xformScale*l.R.col1.y)*m);
k.strokeStyle=this._color(65280,this.m_alpha);k.moveTo(l.position.x*m,l.position.y*m);k.lineTo((l.position.x+this.m_xformScale*l.R.col2.x)*m,(l.position.y+this.m_xformScale*l.R.col2.y)*m);
k.closePath();k.stroke();};})();var d;for(d=0;d<j.postDefs.length;++d){j.postDefs[d]();}delete j.postDefs;(function(i){isString=function(k){return toString.call(k)=="[object String]";
};i.fn.bodysnatch=function(){var k=this;return k.each(function(m,l){var n=i(this);var o=n.clone();w=n.width();h=n.height();if(this.offsetWidth>0&&this.offsetHeight>0){o.css({position:"absolute",top:n.offset().top,left:n.offset().left,width:n.width(),height:n.height(),margin:0,});
o.addClass("perfect");}else{o.css({position:"absolute",top:n.offset().top,left:n.offset().left,margin:0,});o.addClass("imperfect");}if(n[0].id){n[0].id=n[0].id+"_snatched";
}n.addClass("snatched");o.addClass("bodysnatcher");n.css("visibility","hidden");if(n[0].pause){n[0].pause();n[0].src="";}k[m]=o[0];i("body").append(o);
});};})(jQuery);(function(){var k=0;var l=["ms","moz","webkit","o"];for(var i=0;i<l.length&&!e.requestAnimationFrame;++i){e.requestAnimationFrame=e[l[i]+"RequestAnimationFrame"];
e.cancelAnimationFrame=e[l[i]+"CancelAnimationFrame"]||e[l[i]+"CancelRequestAnimationFrame"];}if(!e.requestAnimationFrame){e.requestAnimationFrame=function(q,n){var m=new Date().getTime();
var o=Math.max(0,16-(m-k));var p=e.setTimeout(function(){q(m+o);},o);k=m+o;return p;};}if(!e.cancelAnimationFrame){e.cancelAnimationFrame=function(m){clearTimeout(m);
};}})();(function(){var ae,af,D,E,H,Z,F,ad,r,K,M,x,ag,A,R,n,z,l,V,y,i,Q,S,p,I,G,q,C,N,O,aa,s,v,ac,m,t,L,k,Y,W,B,U,u,o,T,X,J,P,ab;V=j.Common.Math.b2Vec2;
ad=j.Collision.b2AABB;K=j.Dynamics.b2BodyDef;r=j.Dynamics.b2Body;A=j.Dynamics.b2FixtureDef;ag=j.Dynamics.b2Fixture;y=j.Dynamics.b2World;R=j.Collision.Shapes.b2MassData;
z=j.Collision.Shapes.b2PolygonShape;M=j.Collision.Shapes.b2CircleShape;x=j.Dynamics.b2DebugDraw;l=j.Dynamics.Joints.b2RevoluteJointDef;n=j.Dynamics.Joints.b2MouseJointDef;
ac={"-webkit-transform":"translateZ(0)","-moz-transform":"translateZ(0)","-o-transform":"translateZ(0)",transform:"translateZ(0)"};F=false;af=false;J={};
P=0;ab=0;Z=30;ae=Math.PI/180;H=180/Math.PI;E=Math.PI*2;m={};C=false;p=1.5;I=0.3;G=0.4;q="box";Y=0;W=0;k=void 0;t=false;U=void 0;L=void 0;D=function(al,av,an,aj){var ai,ao,at,aq,aw,ar,ap,am,au,ak,ah;
ai=al;Y=void 0;W=void 0;ap=void 0;am=void 0;ao=false;aq=function(ax){ah(ax);return aj(Y,W);};ah=function(ax){var ay;ax.preventDefault();ay=ax.originalEvent;
if(ay&&ay.touches&&ay.touches.length===1){ay.preventDefault();Y=ay.touches[0].pageX;return W=ay.touches[0].pageY;}else{Y=ax.pageX;return W=ax.pageY;}};
aw=function(ax){ai.addEventListener("mousedown",at,true);ai.removeEventListener("mousemove",aq,true);ao=false;ah(ax);return an(Y,W);};ak=function(ax){ai.addEventListener("touchstart",au,true);
ai.removeEventListener("touchmove",aq,true);ao=false;ah(ax);return an(Y,W);};at=function(ax){ai.removeEventListener("mousedown",at,true);ai.addEventListener("mouseup",aw,true);
ai.addEventListener("mousemove",aq,true);ao=true;ah(ax);return av(Y,W);};au=function(ax){ai.removeEventListener("touchstart",au,true);ai.addEventListener("touchend",ak,true);
ai.addEventListener("touchmove",aq,true);ao=true;ah(ax);return av(Y,W);};ai.addEventListener("mousedown",at,true);ai.addEventListener("touchstart",au,true);
ar={};ar.mouseX=function(){return Y;};ar.mouseY=function(){return W;};ar.isDown=function(){return ao;};return ar;};N=function(ah,ai){t=true;return B(ah,ai);
};o=function(ah,ai){t=false;Y=null;return W=null;};B=function(ah,ai){Y=ah/30;return W=ai/30;};aa=function(){var ah;k=new V(Y,W);ah=new ad();ah.lowerBound.Set(Y-0.001,W-0.001);
ah.upperBound.Set(Y+0.001,W+0.001);U=null;J.QueryAABB(s,ah);return U;};s=function(ah){if(ah.GetBody().GetType()!==r.b2_staticBody){if(ah.GetShape().TestPoint(ah.GetBody().GetTransform(),k)){U=ah.GetBody();
return false;}}return true;};v=function(ai){var aj,ak,ah,al;aj=ai;ak="";ah=0;al=0;while((typeof aj==="object")&&(typeof aj.tagName!=="undefined")){al+=aj.offsetTop;
ah+=aj.offsetLeft;ak=aj.tagName.toUpperCase();if(ak==="BODY"){aj=0;}if(typeof aj==="object"?typeof aj.offsetParent==="object":void 0){aj=aj.offsetParent;
}}return{x:ah,y:al};};X=function(){var ah,ai;if(t&&(!L)){ah=aa();if(ah){ai=new n();ai.bodyA=J.GetGroundBody();ai.bodyB=ah;ai.target.Set(Y,W);ai.collideConnected=true;
ai.maxForce=300*ah.GetMass();L=J.CreateJoint(ai);ah.SetAwake(true);}}if(L){if(t){return L.SetTarget(new V(Y,W));}else{J.DestroyJoint(L);return L=null;}}};
S=function(ak,ai,al,ah,aj,am){if(ai==null){ai=q;}if(al==null){al=C;}if(ah==null){ah=p;}if(aj==null){aj=G;}if(am==null){am=I;}return f(ak).each(function(aE,aD){var au,aB,av,aC,aA,ax,ay,ar,ap,an,ao,aF,aw,az,at,aq;
aB=f(aD);aA=aB.width();aC=aB.height();if(!(aA&&aC)){if(aB.attr("src")){if(typeof console!=="undefined"&&console!==null){console.log(" - box2d-jquery ERROR: an element withour width or height, will lead to strangeness!");
}aB.on("load",function(){return S(this,ai,al,ah,aj,am);});}return true;}av=f(aD).position();az=aA/2;ax=aC/2;at=av.left+az;aq=av.top+ax;an=(aB.attr("data-box2d-shape")?aB.attr("data-box2d-shape"):ai);
ay=parseFloat((aB.attr("data-box2d-density")?aB.attr("data-box2d-density"):ah));ap=parseFloat((aB.attr("data-box2d-restitution")?aB.attr("data-box2d-restitution"):aj));
ar=parseFloat((aB.attr("data-box2d-friction")?aB.attr("data-box2d-friction"):am));if(aB.attr("data-box2d-static")==="true"){ao=true;}else{if(aB.attr("data-box2d-static")==="false"){ao=false;
}else{ao=al;}}if(an&&an!=="circle"){au=i(at,aq,az,ax,ao,ay,ap,ar);}else{aw=(az>ax?az:ax);au=Q(at,aq,aw,ao,ay,ap,ar);}au.m_userData={domObj:aB,width:az,height:ax};
aF="50% 50% 0";aB.css({"-webkit-transform-origin":aF,"-moz-transform-origin":aF,"-ms-transform-origin":aF,"-o-transform-origin":aF,"transform-origin":aF});
return true;});};i=function(ao,an,aj,aq,am,ap,ai,al){var ak,ah;if(am==null){am=C;}if(ap==null){ap=p;}if(ai==null){ai=G;}if(al==null){al=I;}ak=new K;ak.type=(am?r.b2_staticBody:r.b2_dynamicBody);
ak.position.x=ao/Z;ak.position.y=an/Z;ah=new A;ah.density=ap;ah.friction=al;ah.restitution=ai;ah.shape=new z;ah.shape.SetAsBox(aj/Z,aq/Z);return J.CreateBody(ak).CreateFixture(ah);
};Q=function(ao,an,ah,am,ap,aj,al){var ak,ai;if(am==null){am=C;}if(ap==null){ap=p;}if(aj==null){aj=G;}if(al==null){al=I;}ak=new K;ak.type=(am?r.b2_staticBody:r.b2_dynamicBody);
ak.position.x=ao/Z;ak.position.y=an/Z;ai=new A;ai.density=ap;ai.friction=al;ai.restitution=aj;ai.shape=new M(ah/Z);return J.CreateBody(ak).CreateFixture(ai);
};O=function(){var ao,al,am,ak,ah,ai,ap,an,aj;ak=0;ao=J.m_bodyList;aj=[];while(ao){am=ao.m_fixtureList;while(am){if(am.m_userData){ap=Math.floor((am.m_body.m_xf.position.x*Z)-am.m_userData.width);
an=Math.floor((am.m_body.m_xf.position.y*Z)-am.m_userData.height);ah=Math.round(((am.m_body.m_sweep.a+E)%E)*H*100)/100;ai="rotate("+ah+"deg)";al={"-webkit-transform":ai,"-moz-transform":ai,"-ms-transform":ai,"-o-transform":ai,transform:ai,left:ap+"px",top:an+"px"};
am.m_userData.domObj.css(al);}am=am.m_next;}aj.push(ao=ao.m_next);}return aj;};T=function(){X();J.Step(2/60,8,3);O();if(af){J.DrawDebugData();}J.ClearForces();
return e.setTimeout(T,1000/30);};u=function(ap,ao,ah,ak){var ai,aj,al,am,an;if(ao==null){ao=p;}if(ah==null){ah=G;}if(ak==null){ak=I;}F=true;J=new y(new V(P,ab),true);
an=f(e).width();al=f(e).height();i(0,-1,f(e).width(),1,true,ao,ah,ak);i(f(e).width()+1,0,1,f(e.document).height(),true,ao,ah,ak);i(-1,0,1,f(e.document).height(),true,ao,ah,ak);
i(0,f(e.document).height()+1,f(e).width(),1,true,ao,ah,ak);am=D(c,N,o,B);if(af){aj=new x();ai=f("<canvas></canvas>");aj.SetSprite(ai[0].getContext("2d"));
aj.SetDrawScale(Z);aj.SetFillAlpha(0.3);aj.SetLineThickness(1);aj.SetFlags(x.e_shapeBit|x.e_jointBit);ai.css("position","absolute");ai.css("top",0);ai.css("left",0);
ai.css("border","1px solid green");ai.attr("width",f(e).width());ai.attr("height",f(c).height());J.SetDebugDraw(aj);f("body").append(ai);}return T();};
f.extend(f.fn,{box2d:function(aq){var al,aj,ao,ak,ah,ai,ap,am,an;ap=f.fn.box2d;ah=f.extend({},ap.default_options,aq);P=ah["x-velocity"];ab=ah["y-velocity"];
ao=ah.density;ai=ah.restitution;ak=ah.friction;am=ah.shape;an=ah["static"];aj=ah.debug;if(F===false){if(aj===true){af=true;}u(this,ao,ai,ak);}al=this.bodysnatch();
S(al,am,an,ao,ai,ak);return f(al);}});f.extend(f.fn.physics,{default_options:{"x-velocity":0,"y-velocity":0,density:p,restitution:G,friction:I,"static":C,shape:q,debug:af}});
}).call(this);})(jQuery,window,document);(function(f,d,a,g){function c(i){if(typeof console!=="undefined"){console.log(i);}}var b=true,e={checkOnlineStatus:function(){f.ajax({dataType:"script",url:"//ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js",success:e.queryLatLong,error:e.setOffline});
},setOffline:function(){c("boo, we're offline");b=!b;e.getLatLong();e.getWeather();},queryLatLong:function(){if(typeof geoip2!=="undefined"){geoip2.city(e.getLatLong,e.getLatLong);
}else{e.getLatLong();}setTimeout(e.getLatLong,7000);},getLatLong:function(i){if(typeof e.latitude==="undefined"){if(typeof i==="undefined"||typeof i.error!=="undefined"){var i={location:{},city:{names:{}}};
}e.latitude=i.location.latitude||40.7235;e.longitude=i.location.longitude||-73.8612;e.city=i.city.names.en||"Williamsburg";if(b){e.queryWeather();}}},queryWeather:function(){f.ajax({dataType:"jsonp",url:"https://api.forecast.io/forecast/84a181affa36ad15a04a60a792b3122a/"+e.latitude+","+e.longitude,data:{exclude:"minutely,hourly,daily,alerts,flags"},success:e.getWeather,error:e.getWeather});
},getWeather:function(i){if(typeof(i)==="undefined"||typeof(i.currently)==="undefined"){var i={currently:{}};}e.temperature=i.currently.temperature||64.43;
e.cloudCover=i.currently.cloudCover||0.17;e.humidity=i.currently.humidity||0.42;e.windSpeed=i.currently.windSpeed||6.31;e.windBearing=i.currently.windBearing||166;
e.currentInfo=!(typeof(i.offset)==="undefined");e.logWeatherInfo();if(!f("#circleContainer .circle").length){e.makeCircles();}},makeCircles:function(){var k=((e.windSpeed/30)*15)*((e.windBearing<180)?-1:1),v=500,j=7500,s,t=0,i=0,r=250,l=50;
function u(x){var B="circle-"+new Date().getTime();var C=Math.random();var z=Math.floor(C*((r-l)*((x>10)?10/x:1)))+l;var A=f(a.createElement("div")).attr({id:B,"class":"circle","data-box2d-shape":"circle"}).css({width:z,height:z,left:d.innerWidth-(275+(z/2)),opacity:(e.cloudCover>0.8)?0.2:1-e.cloudCover}).text("double click to select this circle");
f("body").append(A);i++;t+=Math.PI*Math.pow(z/2,2);var y=setTimeout(function(){clearTimeout(y);f("#"+B).box2d();f(".snatched").remove();},v+50);}function p(){var x=f(".faucet-knob");
x.addClass("faucet-transition").toggleClass("faucet-open");var y=setTimeout(function(){x.removeClass("faucet-transition");clearTimeout(y);},1300);}function o(){f("html").addClass("bubbles-ready");
f(".box2d-object").box2d({"x-velocity":k,"y-velocity":30,density:10,friction:0.8,restitution:0.7});f(".snatched").remove();var x=Math.floor(Math.random()*10)+5;
function y(){clearTimeout(s);u(x);if(f(".circle.bodysnatcher").length<x){s=setTimeout(y,v+100);}else{s=setTimeout(m,j);}n();}f(".faucet-knob, .faucet-knob-object").on("click.bouncingBubbles",function(){p();
if(f(".faucet-knob").hasClass("faucet-open")){s=setTimeout(y,1000);}else{clearTimeout(s);}});f("body").on("dblclick.bouncingBubbles",".circle",function(){var z=(e.temperature-32)/56;
if(f(this).hasClass("selected")){f(this).removeClass("selected").css("background-color","transparent");}else{f(this).addClass("selected").css("background-color",(e.temperature>88)?"rgb(255, 40, 0)":(e.temperature<32)?"rgb(0, 40, 255)":"rgb("+parseInt(z*255)+", 40, "+parseInt(255-(z*255))+")");
}});}function m(){clearTimeout(s);u(f(".circle.bodysnatcher").length);s=setTimeout(m,j);n();}function n(){if(i>=40||t/(d.innerWidth*d.innerHeight)>=0.35){clearTimeout(s);
f("html").removeClass("bubbles-ready");f(".faucet-knob, .faucet-knob-object").off("click.bouncingBubbles");var x=setTimeout(function(){p();clearTimeout(x);
},750);}}var q=new Image();q.onload=o;q.src="assets/images/circle_500.png";},logWeatherInfo:function(){var i=(e.currentInfo)?"is":"was";c(((e.currentInfo)?"The current":"On May 2nd, 2013")+" weather forecast for "+e.city+":\n   wind speed "+i+" "+e.windSpeed+"mph, bearing "+e.windBearing+"°\n   temparature "+i+" "+e.temperature+"°F\n   cloud cover "+i+" "+(e.cloudCover*100)+"%");
}};e.checkOnlineStatus();})(jQuery,window,document);